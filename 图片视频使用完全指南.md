# Directus å›¾ç‰‡å’Œè§†é¢‘ä½¿ç”¨å®Œå…¨æŒ‡å—

## âœ… å·²å®Œæˆçš„ä¿®å¤

`strategies` è¡¨çš„ `cover_image` å­—æ®µå·²æˆåŠŸé…ç½®ä¸ºæ”¯æŒå›¾ç‰‡ä¸Šä¼ ï¼

---

## ğŸ“– å¦‚ä½•ä½¿ç”¨å›¾ç‰‡åŠŸèƒ½

### æ–¹æ³• 1ï¼šåœ¨ Directus åå°ä¸Šä¼ å›¾ç‰‡

#### æ­¥éª¤ 1ï¼šä¸Šä¼ å›¾ç‰‡åˆ°æ–‡ä»¶åº“

1. æ‰“å¼€ Directus åå°ï¼šhttp://localhost:8055
2. åœ¨å·¦ä¾§èœå•æ æ‰¾åˆ° **"æ–‡ä»¶"** (File Library) å›¾æ ‡ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹å›¾æ ‡ï¼‰
3. ç‚¹å‡»å³ä¸Šè§’çš„ **"+ Upload Files"** æŒ‰é’®
4. é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶
   - æ”¯æŒæ ¼å¼ï¼šJPG, PNG, GIF, WebP, SVG ç­‰
   - å»ºè®®å°ºå¯¸ï¼š1200x630 (é€‚åˆåˆ†äº«é¢„è§ˆ)
   - å»ºè®®å¤§å°ï¼š< 2MBï¼ˆæ›´å¿«åŠ è½½ï¼‰

#### æ­¥éª¤ 2ï¼šåœ¨ Strategy ä¸­ä½¿ç”¨å›¾ç‰‡

1. è¿›å…¥ **Strategies** é›†åˆ
2. ç‚¹å‡»è¦ç¼–è¾‘çš„ç­–ç•¥ï¼ˆæˆ–åˆ›å»ºæ–°ç­–ç•¥ï¼‰
3. æ‰¾åˆ° **Cover Image** å­—æ®µ
4. ç‚¹å‡»å­—æ®µåŒºåŸŸï¼Œä¼šå¼¹å‡ºæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
5. æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š
   - **"ä»æ–‡ä»¶åº“é€‰æ‹©"**ï¼šé€‰æ‹©å·²ä¸Šä¼ çš„å›¾ç‰‡
   - **"ä¸Šä¼ æ–°æ–‡ä»¶"**ï¼šç›´æ¥ä¸Šä¼ æ–°å›¾ç‰‡
6. é€‰æ‹©å›¾ç‰‡åä¿å­˜

#### æ­¥éª¤ 3ï¼šåœ¨å‰ç«¯æ˜¾ç¤ºå›¾ç‰‡

å›¾ç‰‡ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨ç­–ç•¥è¯¦æƒ…é¡µçš„å°é¢ä½ç½®ã€‚

---

### æ–¹æ³• 2ï¼šé€šè¿‡è„šæœ¬æ‰¹é‡ä¸Šä¼ å›¾ç‰‡

å¦‚æœä½ éœ€è¦æ‰¹é‡ä¸ºç­–ç•¥æ·»åŠ å›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬ï¼š

```javascript
// upload-and-set-image.js
const axios = require('axios');
const FormData = require('form-data');
const fs = require('fs');

const DIRECTUS_URL = 'http://localhost:8055';

async function getAuthToken() {
  const response = await axios.post(`${DIRECTUS_URL}/auth/login`, {
    email: 'the_uk1@outlook.com',
    password: 'Mygcdjmyxzg2026!'
  });
  return response.data.data.access_token;
}

async function uploadImage(imagePath, token) {
  const formData = new FormData();
  formData.append('file', fs.createReadStream(imagePath));

  const response = await axios.post(
    `${DIRECTUS_URL}/files`,
    formData,
    {
      headers: {
        ...formData.getHeaders(),
        'Authorization': `Bearer ${token}`
      }
    }
  );

  return response.data.data.id; // è¿”å›æ–‡ä»¶ ID
}

async function setStrategyCoverImage(strategySlug, imageId, token) {
  // å…ˆæŸ¥è¯¢ç­–ç•¥ ID
  const strategyRes = await axios.get(
    `${DIRECTUS_URL}/items/strategies?filter[slug][_eq]=${strategySlug}&limit=1`,
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  );

  const strategyId = strategyRes.data.data[0].id;

  // æ›´æ–°å°é¢å›¾ç‰‡
  await axios.patch(
    `${DIRECTUS_URL}/items/strategies/${strategyId}`,
    { cover_image: imageId },
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  );

  console.log(`âœ… å·²ä¸ºç­–ç•¥ ${strategySlug} è®¾ç½®å°é¢å›¾ç‰‡`);
}

// ä½¿ç”¨ç¤ºä¾‹
async function main() {
  const token = await getAuthToken();

  // 1. ä¸Šä¼ å›¾ç‰‡
  const imageId = await uploadImage('./my-image.jpg', token);
  console.log(`å›¾ç‰‡å·²ä¸Šä¼ ï¼ŒID: ${imageId}`);

  // 2. è®¾ç½®ä¸ºç­–ç•¥å°é¢
  await setStrategyCoverImage('testnet-guide', imageId, token);
}

main();
```

---

## ğŸ¬ å¦‚ä½•ä½¿ç”¨è§†é¢‘

### é€‰é¡¹ 1ï¼šä¸Šä¼ åˆ° Directusï¼ˆå°è§†é¢‘ï¼‰

1. åœ¨ Directus æ–‡ä»¶åº“ä¸Šä¼ è§†é¢‘ï¼ˆæ”¯æŒ MP4, WebM ç­‰ï¼‰
2. åˆ›å»ºä¸€ä¸ªæ–°çš„å­—æ®µæ¥å­˜å‚¨è§†é¢‘ï¼ˆå¦‚æœéœ€è¦ï¼‰

**æ³¨æ„**ï¼šDirectus é€‚åˆå°è§†é¢‘ï¼ˆ< 50MBï¼‰ã€‚å¤§è§†é¢‘å»ºè®®ä½¿ç”¨å¤–éƒ¨æ‰˜ç®¡ã€‚

### é€‰é¡¹ 2ï¼šä½¿ç”¨å¤–éƒ¨è§†é¢‘é“¾æ¥ï¼ˆæ¨èï¼‰

å¯¹äºå¤§è§†é¢‘æˆ–é¢‘ç¹æ›´æ–°çš„è§†é¢‘ï¼Œå»ºè®®ä½¿ç”¨ï¼š

1. **YouTube**
   - ä¸Šä¼ åˆ° YouTube
   - è·å–åµŒå…¥é“¾æ¥
   - åœ¨ Content ä¸­ä½¿ç”¨ Markdown åµŒå…¥

2. **Vimeo**
   - ä¸“ä¸šè§†é¢‘æ‰˜ç®¡
   - æ›´å¥½çš„éšç§æ§åˆ¶

3. **Bç«™ï¼ˆBilibiliï¼‰**
   - é€‚åˆä¸­æ–‡å†…å®¹
   - è·å–åµŒå…¥ä»£ç 

#### åœ¨ Markdown å†…å®¹ä¸­åµŒå…¥è§†é¢‘

```markdown
## è§†é¢‘æ•™ç¨‹

<iframe width="560" height="315" src="https://www.youtube.com/embed/VIDEO_ID" frameborder="0" allowfullscreen></iframe>

æˆ–ä½¿ç”¨ Markdown é“¾æ¥ï¼š
[ç‚¹å‡»è§‚çœ‹è§†é¢‘æ•™ç¨‹](https://www.youtube.com/watch?v=VIDEO_ID)
```

---

## ğŸ¨ å›¾ç‰‡æœ€ä½³å®è·µ

### 1. å›¾ç‰‡å°ºå¯¸å»ºè®®

- **å°é¢å›¾ç‰‡**: 1200x630 pxï¼ˆ16:9 æ¯”ä¾‹ï¼‰
- **ç¼©ç•¥å›¾**: 600x400 px
- **å›¾æ ‡**: 300x300 pxï¼ˆæ­£æ–¹å½¢ï¼‰

### 2. å›¾ç‰‡æ ¼å¼é€‰æ‹©

- **ç…§ç‰‡ã€å¤æ‚å›¾åƒ**: JPGï¼ˆæ–‡ä»¶å°ï¼‰
- **é€æ˜èƒŒæ™¯ã€å›¾æ ‡**: PNG
- **åŠ¨ç”»**: GIF æˆ– WebP
- **çŸ¢é‡å›¾**: SVGï¼ˆé€‚åˆ Logoï¼‰

### 3. å›¾ç‰‡ä¼˜åŒ–

ä½¿ç”¨å·¥å…·å‹ç¼©å›¾ç‰‡ï¼š
- **åœ¨çº¿å·¥å…·**: TinyPNG, Squoosh
- **å‘½ä»¤è¡Œ**: ImageMagick, Sharp

```bash
# ä½¿ç”¨ ImageMagick ä¼˜åŒ–å›¾ç‰‡
convert input.jpg -quality 85 -resize 1200x630 output.jpg
```

### 4. æ–‡ä»¶å‘½åè§„èŒƒ

- ä½¿ç”¨è‹±æ–‡å’Œè¿å­—ç¬¦
- æè¿°æ€§å‘½å
- ä¾‹å¦‚ï¼š`uniswap-liquidity-mining-guide-cover.jpg`

---

## ğŸ”§ ä¸ºå…¶ä»–è¡¨æ·»åŠ å›¾ç‰‡å­—æ®µ

å¦‚æœä½ æƒ³ä¸º Newsã€Service Providers ç­‰å…¶ä»–è¡¨æ·»åŠ å›¾ç‰‡å­—æ®µï¼š

### è„šæœ¬æ–¹å¼ï¼ˆå¿«é€Ÿï¼‰

```javascript
// add-image-field.js
const axios = require('axios');

async function addImageField(collectionName, fieldName = 'cover_image') {
  const token = await getAuthToken();

  await axios.post(
    `http://localhost:8055/fields/${collectionName}`,
    {
      field: fieldName,
      type: 'uuid',
      schema: {
        is_nullable: true
      },
      meta: {
        interface: 'file-image',
        display: 'image',
        special: ['file'],
        width: 'full'
      }
    },
    {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    }
  );

  console.log(`âœ… å·²ä¸º ${collectionName} æ·»åŠ å›¾ç‰‡å­—æ®µ ${fieldName}`);
}

// ä½¿ç”¨
addImageField('news');
addImageField('service_providers');
```

### æ‰‹åŠ¨æ–¹å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰

1. è¿›å…¥ Directus è®¾ç½®ï¼ˆå·¦ä¸Šè§’é½¿è½®å›¾æ ‡ï¼‰
2. é€‰æ‹© **"Data Model"**
3. ç‚¹å‡»è¦æ·»åŠ å­—æ®µçš„è¡¨ï¼ˆå¦‚ Newsï¼‰
4. ç‚¹å‡» **"Create Field"** æŒ‰é’®
5. åœ¨å­—æ®µç±»å‹åˆ—è¡¨ä¸­é€‰æ‹© **"Image"**
6. è®¾ç½®å­—æ®µåç§°ï¼ˆå¦‚ `cover_image`ï¼‰
7. é…ç½®é€‰é¡¹ï¼š
   - **Interface**: File (Image)
   - **Display**: Image
   - **Nullable**: Yesï¼ˆå¯é€‰å­—æ®µï¼‰
8. ä¿å­˜

---

## ğŸ“¦ åœ¨å‰ç«¯æ˜¾ç¤ºå›¾ç‰‡

### è·å–å›¾ç‰‡ URL

Directus å›¾ç‰‡ URL æ ¼å¼ï¼š
```
http://localhost:8055/assets/{FILE_ID}
```

å¸¦å‚æ•°çš„å›¾ç‰‡å˜æ¢ï¼š
```
http://localhost:8055/assets/{FILE_ID}?width=800&height=600&fit=cover&quality=80
```

### åœ¨ Next.js ä¸­ä½¿ç”¨

```typescript
// åœ¨ Strategy ç»„ä»¶ä¸­
import Image from 'next/image';

export default function StrategyCard({ strategy }: { strategy: Strategy }) {
  const imageUrl = strategy.cover_image
    ? `http://localhost:8055/assets/${strategy.cover_image}`
    : '/placeholder.jpg';

  return (
    <div>
      <Image
        src={imageUrl}
        alt={strategy.title}
        width={1200}
        height={630}
        className="rounded-lg"
      />
    </div>
  );
}
```

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹æ¸…å•

- [x] âœ… ä¿®å¤ Strategies è¡¨çš„ cover_image å­—æ®µ
- [ ] ğŸ“¤ ä¸Šä¼ ç¬¬ä¸€å¼ å›¾ç‰‡åˆ°æ–‡ä»¶åº“
- [ ] ğŸ–¼ï¸ ä¸ºä¸€ä¸ªç­–ç•¥è®¾ç½®å°é¢å›¾ç‰‡
- [ ] ğŸ‘€ åœ¨å‰ç«¯æŸ¥çœ‹å›¾ç‰‡æ˜¾ç¤ºæ•ˆæœ
- [ ] ğŸ”§ æ ¹æ®éœ€è¦ä¸ºå…¶ä»–è¡¨æ·»åŠ å›¾ç‰‡å­—æ®µ
- [ ] ğŸ“¹ å¦‚æœéœ€è¦è§†é¢‘ï¼Œé€‰æ‹©æ‰˜ç®¡æ–¹æ¡ˆ

---

## â“ å¸¸è§é—®é¢˜

### Q: ä¸Šä¼ çš„å›¾ç‰‡åœ¨å“ªé‡Œå­˜å‚¨ï¼Ÿ
A: é»˜è®¤å­˜å‚¨åœ¨ Directus é¡¹ç›®çš„ `uploads` æ–‡ä»¶å¤¹ä¸­ã€‚

### Q: å¯ä»¥é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶å¤§å°å—ï¼Ÿ
A: å¯ä»¥åœ¨ Directus ç¯å¢ƒå˜é‡ä¸­è®¾ç½® `FILES_MAX_SIZE`ã€‚

### Q: å¦‚ä½•æ‰¹é‡ä¸Šä¼ å›¾ç‰‡ï¼Ÿ
A: åœ¨æ–‡ä»¶åº“ä¸­å¯ä»¥ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚

### Q: å›¾ç‰‡åŠ è½½å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ
A:
1. å‹ç¼©å›¾ç‰‡
2. ä½¿ç”¨ Directus çš„å›¾ç‰‡å˜æ¢å‚æ•°
3. è€ƒè™‘ä½¿ç”¨ CDN

### Q: å¯ä»¥ä½¿ç”¨å¤–éƒ¨å›¾ç‰‡é“¾æ¥å—ï¼Ÿ
A: å¯ä»¥ï¼åœ¨ Content ä¸­ç›´æ¥ä½¿ç”¨ Markdown å›¾ç‰‡è¯­æ³•ï¼š
```markdown
![å›¾ç‰‡æè¿°](https://example.com/image.jpg)
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å¯ä»¥ï¼š
1. åˆ·æ–° Directus åå°é¡µé¢
2. ç¼–è¾‘ä»»æ„ Strategy
3. ä¸Šä¼ å’Œè®¾ç½®å°é¢å›¾ç‰‡
4. åœ¨å‰ç«¯æŸ¥çœ‹æ•ˆæœ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ Directus æ–‡æ¡£ï¼š
https://docs.directus.io/reference/files.html
