const axios = require('axios');

// ========================
// 策略 15.9: 资金费 + 质押双重收益
// ========================
const STRATEGY_15_9 = {
  title: '资金费 + 质押双重收益 - 让每一枚 ETH 赚两份钱',
  slug: 'funding-arbitrage-15-9-funding-plus-staking-dual-yield',
  category: 'funding-arbitrage',
  category_l1: 'arbitrage',
  category_l2: '资金费套利',
  summary: '现货部分参与 Staking（如 ETH 质押），同时赚取资金费和质押收益。适合长期持有 ETH/BNB 等 PoS 币种，希望收益最大化的投资者。',
  content: `## 📖 故事：普通人的 ETH 收益进化之路

**2022 年 9 月，以太坊合并后的新机会**

北京的 DeFi 玩家小林持有 32 ETH（当时价值约 50,000 USDT），原本只是放在钱包里"吃灰"。

**2022 年 9 月 15 日，以太坊完成合并（The Merge）**，从 PoW 转为 PoS，开启了质押（Staking）时代。

### 三种持有方式的收益对比

小林计算了三种持有 ETH 的方式：

#### 方式 1：纯 HODL（持有）

- **年化收益：** 0%
- **风险：** 币价波动
- **优势：** 简单，流动性好

#### 方式 2：纯质押（Staking）

- **操作：** 将 32 ETH 质押到以太坊 2.0 信标链
- **年化收益：** 4-5%（约 1.6 ETH/年）
- **风险：** 锁仓至少 6-12 个月，流动性差
- **优势：** 稳定收益，支持网络安全

#### 方式 3：质押 + 资金费套利（双重收益）⭐

- **操作：**
  1. 将 32 ETH 通过 Lido 质押，获得 32 stETH（流动性质押凭证）
  2. 用 stETH 做资金费套利（做空 ETH 永续合约）
  3. 同时赚取：质押收益（4-5%）+ 资金费收益（15-40%）

**小林的选择：** 方式 3

### 一年后的收益对比（2022.9 - 2023.9）

| 维度 | 纯 HODL | 纯质押 | 质押 + 套利 |
|-----|--------|--------|------------|
| **初始持仓** | 32 ETH | 32 ETH | 32 stETH |
| **质押收益** | 0 | +1.5 ETH | +1.5 ETH |
| **资金费收益** | 0 | 0 | +6.8 ETH（年化 21%） |
| **总收益** | **0 ETH** | **+1.5 ETH** | **+8.3 ETH** |
| **收益率** | **0%** | **4.7%** | **25.9%** ✅ |

**收益对比：**
- 比纯 HODL 多赚 **8.3 ETH**（按当时价格约 13,280 USDT）
- 比纯质押多赚 **6.8 ETH**（约 10,880 USDT）

小林评价：
> "以前我总觉得 ETH 放着就是浪费。现在通过 Lido + 资金费套利，我的 ETH 不仅在为以太坊网络工作，还在为我赚取双重收益。这才是'让钱生钱'的正确姿势。"

---

## 🎯 核心原理

### 什么是双重收益策略？

传统资金费套利需要持有现货对冲，但现货"躺平"不产生收益。双重收益策略通过**流动性质押（Liquid Staking）**，让现货部分也能赚钱。

**传统资金费套利：**

1. 持有 32 ETH 现货（收益 0%）
2. 做空 32 ETH 永续合约（收取资金费，年化 15-40%）
3. **总年化：** 15-40%

**双重收益策略：**

1. 将 32 ETH 质押为 stETH（收益 4-5%）
2. 用 stETH 作为对冲资产，做空 ETH 永续合约（收取资金费，年化 15-40%）
3. **总年化：** 19-45% ✅

**关键工具：** Lido、Rocket Pool 等流动性质押协议

### 流动性质押（Liquid Staking）是什么？

**传统质押的问题：**
- 锁仓期长（6-12 个月）
- 无法交易或使用

**流动性质押的解决方案：**
- 质押 ETH 后，获得 **stETH**（Lido）或 **rETH**（Rocket Pool）
- stETH 可以自由交易、转账、用于 DeFi
- stETH 价值 ≈ ETH，且持续累积质押收益

**案例：** 质押 32 ETH 到 Lido

- 获得：32 stETH
- 1 年后：stETH 余额自动增长至 33.5 stETH（质押收益）
- 可以用 stETH 做任何 DeFi 操作（借贷、LP、资金费套利）

---

## 💰 收益结构拆解

### 双重收益的组成

**假设：** 32 ETH，ETH = 2,000 USDT

| 收益来源 | 年化收益率 | 年收益（ETH） | 年收益（USDT） |
|---------|-----------|-------------|---------------|
| **质押收益** | 4-5% | 1.28-1.6 ETH | 2,560-3,200 |
| **资金费收益** | 15-40% | 4.8-12.8 ETH | 9,600-25,600 |
| **总收益** | **19-45%** | **6.08-14.4 ETH** | **12,160-28,800** |

**成本：**

| 成本项 | 年化成本 | 说明 |
|-------|---------|------|
| Lido 质押费用 | 10% 的质押收益 | 例如质押收益 5%，Lido 抽取 0.5% |
| 合约手续费 | 0.5-2% | 开仓/平仓/调整仓位 |
| Gas 费 | 0.1-0.5% | 以太坊链上操作（Lido 质押、提取等） |
| **总成本** | **0.6-3%** | |

**净收益：** 16-42% 年化

---

## 🔧 实战操作指南

### 步骤 1：选择流动性质押协议

**主流协议对比：**

| 协议 | 质押凭证 | 年化收益 | TVL（锁仓量） | 推荐度 |
|-----|---------|---------|-------------|--------|
| **Lido** | stETH | 3.5-5% | 90 亿美元 | ⭐⭐⭐⭐⭐ 最推荐 |
| **Rocket Pool** | rETH | 4-5.5% | 30 亿美元 | ⭐⭐⭐⭐ 推荐 |
| **Frax** | frxETH | 4-6% | 8 亿美元 | ⭐⭐⭐ 适合进阶 |
| **Coinbase** | cbETH | 3-4% | 20 亿美元 | ⭐⭐⭐ 中心化 |

**推荐：** Lido（流动性最好，stETH 使用场景最多）

### 步骤 2：质押 ETH 获得 stETH

**操作步骤（Lido）：**

1. **访问 Lido 官网**
   - 网址：lido.fi
   - 连接 MetaMask 钱包

2. **质押 ETH**
   - 输入质押数量（例如 32 ETH）
   - 点击"Stake"
   - 确认交易（Gas 费约 10-30 USDT）

3. **获得 stETH**
   - 交易确认后，钱包自动收到 32 stETH
   - stETH 与 ETH 1:1 兑换（初始时）

4. **验证质押成功**
   - 在 Lido Dashboard 查看质押余额
   - stETH 余额会每日自动增长（质押收益）

**注意：** stETH 价格可能略低于 ETH（0.98-1.02），这是正常的市场波动。

### 步骤 3：用 stETH 进行资金费套利

**方案 A：直接卖出 stETH 换 USDT（简化版）**

1. 在 Curve Finance 将 stETH 兑换为 ETH
2. 卖出 ETH 获得 USDT
3. 用 USDT 做空 ETH 永续合约
4. **问题：** 失去了质押收益

**方案 B：保留 stETH + 做空合约（推荐）✅**

1. **不卖出 stETH**，继续持有（累积质押收益）
2. 在合约账户做空等值的 ETH 永续合约
3. **对冲逻辑：**
   - stETH ≈ ETH（价格高度相关）
   - 做空 ETH 合约 = 对冲 stETH 价格风险
4. **双重收益：**
   - stETH 质押收益（4-5%）
   - 合约资金费收益（15-40%）

**操作（Binance）：**

1. 保持 32 stETH 在 MetaMask 钱包
2. 登录 Binance，进入 ETH/USDT 永续合约
3. 做空 32 ETH 的合约（价值 64,000 USDT，假设 ETH = 2,000）
4. 设置：
   - 模式：逐仓
   - 杠杆：1x
   - 保证金：64,000 USDT

### 步骤 4：管理双重收益

**质押收益管理：**

- **自动累积**：stETH 余额每日增长，无需操作
- **查看收益**：在 Lido Dashboard 查看累计收益
- **复投：** stETH 余额增长后，可增加合约空头仓位

**资金费收益管理：**

- **每 8 小时结算**：自动收取资金费（USDT）
- **再投资：** 将资金费收益用于增加 stETH 持仓（复利）

**再平衡（可选）：**

- 如果 stETH 余额增长至 33.5 ETH，合约空头仍是 32 ETH
- 可增加空头至 33.5 ETH，保持完美对冲

### 步骤 5：退出策略

**何时退出？**

1. 资金费率转负（持续 7 天以上）
2. 需要流动性（卖出 stETH 换回 USDT）
3. 质押收益率大幅下降（< 2%）

**退出操作：**

1. **平掉合约空头**：在 Binance 平仓
2. **解除质押**：
   - Lido 上将 stETH 兑换回 ETH（通过 Curve 或等待提款队列）
   - 或直接在 Uniswap/Curve 卖出 stETH 换 USDT
3. **收回本金 + 收益**

---

## 📊 进阶优化技巧

### 1. 多协议组合

不要只用 Lido，分散到多个协议：

| 协议 | 配置比例 | 质押收益 | stETH流动性 | 风险评估 |
|-----|---------|---------|------------|---------|
| **Lido** | 60% | 3.5-5% | 最高 | 低 |
| **Rocket Pool** | 30% | 4-5.5% | 中 | 低 |
| **Frax** | 10% | 4-6% | 中低 | 中 |

**优势：** 分散单一协议风险（如智能合约漏洞）

### 2. 利用 stETH-ETH 价差套利

**现象：** stETH 价格有时低于 ETH（0.95-0.98）

**案例：** 2022 年 5 月 Terra 崩盘期间，stETH 一度跌至 0.93 ETH

**套利策略：**

1. 以 0.95 ETH 的价格买入 stETH
2. 等待价格回归 1.0（通常 1-3 个月）
3. 额外获得 **5% 价差收益 + 质押收益**

### 3. 杠杆质押（高风险高收益）

**策略：** 使用 stETH 在 Aave/Compound 借贷，再质押

**操作：**

1. 质押 32 ETH 获得 32 stETH
2. 在 Aave 存入 32 stETH，借出 20 ETH（LTV 62.5%）
3. 再将 20 ETH 质押为 20 stETH
4. 重复 1-2 次

**收益：**

- 总 stETH：32 + 20 + 12 = 64 stETH
- 质押收益：64 × 4% = **2.56 ETH/年**（本金仅 32 ETH）
- 杠杆倍数：约 2x
- **质押年化：** 8%（2 倍杠杆）

**风险：** 如果 stETH 价格大幅下跌（< 0.9），可能被清算

### 4. 币本位合约 + stETH

**策略：** 用币本位合约做空，收益也以 ETH 计价

**优势：**

- 质押收益：stETH 增长（以 ETH 计）
- 资金费收益：币本位合约收益（以 ETH 计）
- **双重累积 ETH**，适合长期看多 ETH 的投资者

---

## 🧮 真实案例：一年实盘数据

**背景：** DeFi 玩家老王，初始 32 ETH（价值 64,000 USDT）

**策略：** Lido 质押 + Binance 资金费套利

**时间：** 2023 年 9 月 - 2024 年 9 月（12 个月）

### 逐月收益记录

| 月份 | stETH 余额 | 质押收益 | 资金费收益（ETH） | 月收益 | 累计收益 |
|-----|-----------|---------|-----------------|--------|---------|
| 9月 | 32.00 | +0.12 ETH | +0.48 ETH | +0.60 ETH | +0.60 |
| 10月 | 32.60 | +0.12 ETH | +0.52 ETH | +0.64 ETH | +1.24 |
| 11月 | 33.24 | +0.13 ETH | +0.68 ETH | +0.81 ETH | +2.05 |
| 12月 | 34.05 | +0.13 ETH | +0.72 ETH | +0.85 ETH | +2.90 |
| 1月 | 34.90 | +0.14 ETH | +0.58 ETH | +0.72 ETH | +3.62 |
| 2月 | 35.62 | +0.14 ETH | +0.61 ETH | +0.75 ETH | +4.37 |
| 3月 | 36.37 | +0.14 ETH | +0.78 ETH | +0.92 ETH | +5.29 |
| 4月 | 37.29 | +0.14 ETH | +0.65 ETH | +0.79 ETH | +6.08 |
| 5月 | 38.08 | +0.15 ETH | +0.58 ETH | +0.73 ETH | +6.81 |
| 6月 | 38.81 | +0.15 ETH | +0.52 ETH | +0.67 ETH | +7.48 |
| 7月 | 39.48 | +0.15 ETH | +0.88 ETH | +1.03 ETH | +8.51 |
| 8月 | 40.51 | +0.16 ETH | +0.71 ETH | +0.87 ETH | +9.38 |

**年度总结：**

- **初始持仓：** 32 ETH
- **最终持仓：** 41.38 ETH（stETH）
- **总收益：** +9.38 ETH
- **收益率：** **+29.3%**

**收益拆解：**

- 质押收益：1.68 ETH（年化 5.25%）
- 资金费收益：7.70 ETH（年化 24.06%）

**按 USDT 计算（假设 ETH 平均价格 2,500）：**

- 总收益：9.38 × 2,500 = **23,450 USDT**
- 初始投资：64,000 USDT
- **收益率：** 36.6%（因 ETH 价格上涨）

---

## ⚠️ 风险提示

### 1. stETH 脱锚风险

**问题：** stETH 价格可能偏离 ETH

**历史事件：** 2022 年 5 月 Terra 崩盘期间，stETH 跌至 0.93 ETH（-7%）

**原因：**
- 大量用户恐慌性抛售 stETH
- Curve stETH/ETH 流动性池失衡

**应对：**
- 长期持有，价格最终会回归（历史上都回归了）
- 如果脱锚 > 5%，可考虑增加对冲（多做空一点合约）

### 2. 质押协议风险

**智能合约漏洞：**
- Lido、Rocket Pool 等协议可能存在未知漏洞
- 虽然都经过多次审计，但零风险不存在

**应对：**
- 分散到多个协议（60% Lido + 30% Rocket Pool + 10% 其他）
- 不要质押全部 ETH，保留 20-30% 作为流动性储备

### 3. 以太坊网络风险

**问题：** 以太坊网络升级或分叉可能影响质押收益

**案例：** 2023 年 Shapella 升级（开启提款），短期内质押收益率下降 0.5-1%

**应对：**
- 关注以太坊官方升级公告
- 升级前可考虑部分退出质押

### 4. 流动性风险

**问题：** 大额 stETH 难以快速换回 ETH

**案例：** 如果要一次性卖出 100 stETH，Curve 池可能滑点 1-2%

**应对：**
- 分批卖出（每次 < 50 stETH）
- 或使用 Lido 提款队列（等待 1-7 天）

### 5. 资金费率风险

**问题：** 资金费率可能转负

**应对：**
- 参考"负资金费反向套利"策略（15.6）
- 当费率转负时，平掉合约空头，改为做多合约

---

## ❓ 常见问题

### Q1: stETH 和 ETH 有什么区别？

**A:**

| 维度 | ETH | stETH |
|-----|-----|-------|
| **性质** | 原生代币 | ERC-20 代币（质押凭证） |
| **价格** | 市场定价 | ≈ ETH（可能有 ±2% 偏差） |
| **收益** | 0% | 4-5% 质押收益（自动增长） |
| **流动性** | 最高 | 高（但低于 ETH） |
| **使用场景** | 任何地方 | 大部分 DeFi 协议支持 |

### Q2: 如果我只有 5 个 ETH，能做这个策略吗？

**A:** 可以！不需要 32 ETH。

- Lido 支持任意数量质押（最低 0.01 ETH）
- 5 ETH 也能获得质押收益 + 资金费收益

### Q3: stETH 的质押收益如何计算？

**A:** 自动复利增长。

**例子：**
- 质押 10 ETH，获得 10 stETH
- 年化 5%，每日增长约 0.00137 stETH
- 1 年后：10 × 1.05 = 10.5 stETH

### Q4: 我能随时取出质押的 ETH 吗？

**A:** 有两种方式：

**方式 1：即时兑换（推荐）**
- 在 Curve 或 Uniswap 将 stETH 换成 ETH
- 可能有 0.5-2% 滑点

**方式 2：Lido 提款队列**
- 在 Lido 官网申请提款
- 等待 1-7 天
- 1:1 兑换，无滑点

### Q5: 资金费率转负了怎么办？

**A:** 两种选择：

1. **暂停套利**：平掉合约空头，只保留 stETH 质押收益
2. **反向操作**：改为做多合约，赚取负资金费（参考策略 15.6）

### Q6: stETH 比 ETH 便宜时，我该买哪个？

**A:** 如果你打算长期持有，买 stETH 更划算。

**案例：** ETH = 2,000，stETH = 1,960（-2%）

- 买 10 ETH：花费 20,000 USDT
- 买 10.2 stETH：花费 20,000 USDT（多获得 0.2 ETH）
- 1 年后 stETH 回归 1:1，你额外赚 2% + 质押收益 5% = **7% 收益**

---

## 📈 总结

### 双重收益策略的三大优势

1. **收益最大化**：质押 + 资金费，年化可达 20-45%
2. **风险分散**：不依赖单一收益来源
3. **适合长期持有**：stETH 持续累积，符合"时间的朋友"理念

### 适合人群

- ✅ 长期看好以太坊，持有 ETH 超过 1 年
- ✅ 希望收益最大化，不满足于单纯 HODL
- ✅ 有一定 DeFi 操作经验，了解 Lido 等协议

### 黄金法则

1. **选择头部协议**（Lido、Rocket Pool），避免小众协议
2. **保留流动性**，不要质押全部 ETH
3. **定期再平衡**，stETH 增长后调整合约仓位
4. **监控脱锚风险**，stETH 偏离 > 5% 时加强对冲
5. **长期持有**，不要因为短期波动而频繁进出

---

**记住：** 双重收益策略不是"无风险套利"，而是"风险可控的收益增强"。它需要你对以太坊生态有信心，对 DeFi 协议有了解，对风险有敬畏。但如果执行得当，它可以让你的 ETH 持仓实现"1 份本金，2 份收益"的复利增长。

在 DeFi 世界，最聪明的投资者不是追求最高收益，而是让每一枚币都发挥最大价值。质押 + 资金费套利，正是这种理念的完美体现。`,
  risk_level: 3,
  apy_min: 19,
  apy_max: 45,
  min_investment: 10000,
  difficulty_level: 'advanced',
  time_commitment: '1小时/周',
  required_tools: ['Lido/Rocket Pool', 'MetaMask钱包', 'Binance合约账户'],
  steps: [
    {
      title: '选择质押协议',
      description: '推荐 Lido（最成熟）或 Rocket Pool，连接 MetaMask 钱包'
    },
    {
      title: '质押 ETH',
      description: '在 Lido 官网质押 ETH，获得等量 stETH 流动性质押凭证'
    },
    {
      title: '验证质押成功',
      description: '检查钱包 stETH 余额，确认在 Lido Dashboard 可见'
    },
    {
      title: '做空 ETH 合约',
      description: '在 Binance 做空等量 ETH 永续合约（1x 杠杆逐仓）'
    },
    {
      title: '收取双重收益',
      description: 'stETH 自动增长（质押收益）+ 合约每 8 小时结算资金费'
    },
    {
      title: '定期再平衡',
      description: '每月检查 stETH 余额，如增长超过 5% 则调整合约空头仓位'
    }
  ],
  status: 'published',
  view_count: 0,
  favorite_count: 0
};

// ========================
// 认证和上传函数
// ========================

async function getAuthToken() {
  try {
    const response = await axios.post('http://localhost:8055/auth/login', {
      email: 'the_uk1@outlook.com',
      password: 'Mygcdjmyxzg2026!'
    });
    return response.data.data.access_token;
  } catch (error) {
    console.error('认证失败:', error.message);
    throw error;
  }
}

async function createStrategies() {
  console.log('认证成功，开始创建策略...\n');

  const token = await getAuthToken();

  try {
    console.log(`正在创建策略 15.9: ${STRATEGY_15_9.title}...`);

    const response = await axios.post(
      'http://localhost:8055/items/strategies',
      STRATEGY_15_9,
      {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      }
    );

    console.log(`✅ 策略 15.9 创建成功! ID: ${response.data.data.id}`);
    console.log(`   标题: ${STRATEGY_15_9.title}`);
    console.log(`   Slug: ${STRATEGY_15_9.slug}\n`);

  } catch (error) {
    console.error(`❌ 创建策略失败:`, error.response?.data || error.message);
    throw error;
  }

  // 获取总数
  try {
    const countResponse = await axios.get(
      'http://localhost:8055/items/strategies?fields=id&limit=-1',
      {
        headers: { 'Authorization': `Bearer ${token}` }
      }
    );

    const totalCount = countResponse.data.data.length;

    console.log('========================================');
    console.log('🎉 策略 15.9 创建完成！');
    console.log(`📊 当前数据库中共有 ${totalCount} 个策略`);
    console.log('========================================');
    console.log('');
    console.log('✅ 分类 15.资金费套利 (funding-arbitrage) 全部 9 个策略已完成！');
    console.log('');

  } catch (error) {
    console.error('获取策略总数失败:', error.message);
  }
}

// 执行
createStrategies().catch(console.error);
