// 策略 33.5 & 33.6: 衍生品策略 (Derivatives Strategies) - 波动率策略 (Volatility Strategies)
// category_l1: derivatives
// category: volatility
// category_l2: volatility

const axios = require('axios');

/**
 * 33.5 Straddle 跨式期权持有
 *
 * 一级分类: 衍生品策略 (Derivatives Strategies)
 * category_l1: derivatives
 * category: volatility
 * category_l2: volatility
 *
 * 核心：在你预期“会有大波动，但不确定方向”的重大事件前，
 *       买入同一执行价、同一到期日的看涨期权和看跌期权（跨式 Straddle），
 *       只要事件之后价格向任一方向走出足够幅度，就有机会覆盖权利金并实现盈利。
 */
const STRATEGY_33_5 = {
  title:
    'Straddle 跨式期权持有 - 在重大事件前押注“大波动”，不纠结涨还是跌',
  slug: 'straddle-event-volatility-long',
  summary:
    'Straddle（跨式期权持有）是一种典型的“做多波动率”策略：在同一标的、同一执行价和同一到期日上，同时买入看涨期权和看跌期权，构建一个在价格向任一方向大幅变动时均可获利的仓位。它非常适用于重大事件前（例如监管决议、链上升级、宏观数据公布、项目代币解锁、ETF 批准/否决等）你确信“波动会很大，但方向说不准”的场景。该策略的核心在于：严格控制权利金成本、选择合适的执行价与到期日，并对“实际波动是否足以覆盖隐含波动率定价”保持警惕。',
  category: 'volatility',
  category_l1: 'derivatives',
  category_l2: 'volatility',
  risk_level: 4,
  apy_min: 15,
  apy_max: 120,
  min_investment: 2000,
  time_commitment:
    '需要在事件前设计与建仓，在事件窗口内关注波动与盈亏情况，到期前做出平仓或持有决策',
  status: 'published',
  content: `# 33.5 Straddle 跨式期权持有 - 在重大事件前押注“大波动”，不纠结涨还是跌

---

## 一、策略一句话说明

当你确信：

- 接下来会有一个 **能显著改变市场情绪的重大事件**；  
- 价格大概率会出现 **剧烈波动**，但你 **无法确定方向**；  

与其勉强选方向赌涨跌，不如直接用：

> **Straddle（跨式期权）**：  
> 同一执行价、同一到期日同时买入 Call 和 Put，  
> 押注“波动本身足够大”，而不是押注方向。

只要事件后，标的价格向任一方向走出足够幅度，你就有机会覆盖两边权利金并实现净盈利。

---

## 二、适用场景：什么时候考虑用 Straddle？

可在玩法卡片中直接列出典型场景，让用户一眼对号入座：

1. **宏观级大事件**  
   - FOMC 议息会议、美联储利率决议  
   - CPI / PPI / 非农就业等重要经济数据公布  
   - 美国/欧盟等监管机构对加密 ETF、期货、现货的批准/否决  

2. **链上/协议级大事件**

   - 公链重大升级（硬分叉、合并、性能优化）  
   - 关键项目的主网上线 / Token 解锁 / 代币经济模型调整  
   - 对某个 DeFi 协议安全性或治理有重大影响的投票  

3. **市场情绪节点**

   - 长时间盘整后的“方向选择”时刻  
   - 市场对某个利好/利空消息分歧巨大，  
     有人看暴涨，有人看暴跌，  
     但几乎没人看“继续睡觉”。

在这些场景中，传统方向交易者需要站队：  
要么做多，要么做空。

而使用 Straddle 的玩家则在说：

> “我只关心你动得够不够大，  
>  至于向上还是向下，随你。”

---

## 三、结构拆解：什么是 Straddle 跨式期权？

以 BTC 为例，假设：

- 当前现货价格：60,000 USD  
- 你预期一周后有重大事件  
- 你选择一个近期到期（例如 7 天后）的期权合约  

### 1️⃣ 经典平值跨式（ATM Straddle）

构造方式：

- 买入 1 张 **看涨期权 Call**，执行价 K = 60,000，7 天后到期；  
- 买入 1 张 **看跌期权 Put**，执行价 K = 60,000，7 天后到期；  

两者执行价相同、到期日相同，只是方向相反。

### 2️⃣ 成本与盈亏特征

- 成本：  
  - 你需要支付 Call 权利金 + Put 权利金的总和；  
  - 这是你的最大亏损（如果到期时价格恰好在执行价附近且波动不够大）。  

- 盈利条件：  
  - 只要到期时价格 **远远高于执行价** 或 **远远低于执行价**，  
  - 超出的那一边期权（Call 或 Put）将深度实值，  
  - 其内在价值足以覆盖另一边损失和总权利金成本，  
  - 你就实现净盈利。  

盈亏图大致呈现为一个 “V 字结构”：

- 价格在执行价附近：亏损接近最大值（即总权利金）；  
- 价格远离执行价：盈利越来越多，理论上无上限（取决于价格极端程度）。  

可以在玩法文案中用一句话总结：

> “跨式 = 用权利金买一张‘大波动门票’，  
>  门票价格是已知上限，  
>  只要波动足够大，这张门票的价值就会被放大。”

---

## 四、用户视角的决策要点：四个关键问题

在设计 Straddle 玩法时，可以把决策拆成四个简单问题，让用户逐个回答：

### Q1：事件的时间窗口有多长？

- 是在某个具体时间点（例如公布当日）？  
- 还是一个几天到一周的模糊区间？  

这将决定你选择 **多长到期时间的期权**：

- 如果事件在 3 天内，可能选择 7 天期权  
- 如果事件在 7-10 天内，可能选择 14 天期权  

不要为了省权利金选择过短到期而使自己被动——  
事件提前/延后一点点，都可能导致“门票过期”。

---

### Q2：当前隐含波动率处于什么水平？

Straddle 是典型“做多波动率”的策略。  
如果当前隐含波动率已经被炒得非常高：

- 你的权利金会非常昂贵；  
- 未来必须出现 **比市场预期更大的波动** 才能赚钱；  
- 否则，即便事件后走势剧烈，  
  也可能只是“兑现预期”并没有超过隐含波动率定价。

因此，需要提醒用户：

> 在隐含波动率已经极高时盲目买 Straddle，  
> 很容易变成“帮别人接盘波动率”的最后一棒。

---

### Q3：你愿意为这张“波动门票”付出多少预算？

Straddle 最大亏损 = 支付的总权利金。

可以在卡片里给用户一个简单规则：

- 单次事件 Straddle 总成本不超过总资金的 3-5%；  
- 即使连续几次失败，也不至于重创整个账户；  
- 将它当作“重大事件彩票 + 波动率教育费用”。

---

### Q4：你是要持有到期，还是打算“事件后择机平仓”？

Straddle 并不一定要持有到期。  
许多专业玩家会选择：

- 在事件发生后，  
- 一旦波动率与价格出现明显反应，  
- 就择机平掉整个组合或只平部分腿，  
- 用已实现收益对冲剩余时间价值风险。

对用户而言，可以给出两种风格：

1. **“赌到底”型**：持有到期，看最终结算价格  
2. **“事件交易”型**：在事件发生当天或之后几天内择机退出

两种方式各有优劣：

- 前者更简单，但容易被时间价值拖死；  
- 后者更灵活，但对执行能力要求更高。

---

## 五、Straddle 的典型错误用法（必须在玩法中提醒）

为了避免用户误会这是“必赚玩法”，需要列出常见坑：

1. **在没有重大事件的平静期乱买 Straddle**  
   - 波动率不高、事件不明确时，  
   - 买 Straddle 常常只是在慢慢流失权利金。

2. **只看到历史波动，不看隐含波动率**  
   - 你看到过去一个月价格波动很大，  
     于是认为未来也一定会大波动；  
   - 但期权价格里早已写了这份预期，  
     你买的是“已经很贵的波动率”。

3. **用过大的杠杆 + 过多 Straddle 仓位**  
   - 把 Straddle 当成“绝对安全”的波动玩法，  
     用极高的资金比例去押注，  
     一旦事件“低于预期”或价格选择在中枢附近收敛，  
     权利金损耗会让账户损失非常难看。

---

## 六、实战教学示例（概念化，非实际报价）

假设：

- 标的：BTC  
- 现货价格：60,000  
- 一周后有重大监管决议  

你选择：

- 到期时间：7 天后  
- 执行价：60,000  
- 买入：  
  - 1 张 Call（权利金 1,700）  
  - 1 张 Put（权利金 1,600）  
- 总成本：3,300 USDT  

在这 7 天内：

- 若 BTC 在决议前后暴涨到 68,000：  
  - Call 深度实值，内在价值 ~8,000，  
  - Put 基本归零，  
  - 净利润 ≈ 8,000 - 3,300 = 4,700（忽略手续费）。  

- 若 BTC 暴跌到 52,000：  
  - Put 深度实值，内在价值 ~8,000，  
  - Call 归零，  
  - 净利润同理。  

- 若 BTC 到期仍在 60,000 附近 ±1,000 波动：  
  - Call 与 Put 内在价值有限  
  - 抵不住两边权利金，  
  - 你接近亏掉 3,300 的全部或大部分。

在玩法文案里要突出：  
**“大波动 + 超过市场预期” 是 Straddle 盈利的关键。**

---

## 七、示意性的参数与风控模板（可在前端做可视化）

\`\`\`javascript
const STRADDLE_CONFIG_TEMPLATE = {
  underlying: 'BTC',              // 标的
  currentPrice: 60000,            // 当前价格（仅用于展示）
  expiryDays: 7,                  // 到期时间（天）
  strikePriceMode: 'ATM',         // 执行价模式：ATM / OTM / 自定义
  strikePrice: 60000,             // 执行价（若为自定义，可显式设置）
  callPremium: 1700,              // Call 权利金（示意）
  putPremium: 1600,               // Put 权利金（示意）
  maxLoss: 3300,                  // 最大亏损 = Call + Put
  expectedMovePercent: 0.15,      // 你预期事件带来的价格波动幅度（如 15%）
  ivCurrent: 0.85,                // 当前隐含波动率（示意）
  ivPercentile1Y: 0.7,            // 过去一年中的 IV 百分位位置（示意）
  budgetRatio: 0.05               // 对总资金的最大比例，例如 5%
};
\`\`\`

你可以在前端用这个模板生成：

- 最大亏损提醒  
- 价格需要变动多少才能打平的可视化  
- IV 当前位置（相对过去历史）的热度图  

让用户更直观地看到：  
“这张 Straddle 门票到底贵不贵？”  
“我要赌多大的波动才可能赚？”

---

## 八、Straddle 在玩法体系中的标签与定位

在你的平台中，可以给 33.5 这张玩法卡片添加以下标签：

- 「事件波动玩法」  
- 「做多波动率」  
- 「方向中性但对波动敏感」  
- 「适合有宏观/新闻预判，但方向难以判断的玩家」

用一句话总结给用户：

> “当你只知道‘要下暴雨’，  
>  却完全不确定风会往哪边刮时，  
>  跨式期权就是那把专门吃暴风雨的伞。”

`
};

/**
 * 33.6 Vega 对冲策略
 *
 * 一级分类: 衍生品策略 (Derivatives Strategies)
 * category_l1: derivatives
 * category: volatility
 * category_l2: volatility
 *
 * 核心：通过多个期限、多个执行价、多个标的的期权组合，
 *       调整或对冲整个组合的 Vega 暴露，使自己不再暴露在“隐含波动率变化”的方向性风险上，
 *       或者刻意打造“纯粹交易波动率变化”的结构（对价格方向和时间价值相对不敏感）。
 */
const STRATEGY_33_6 = {
  title:
    'Vega 对冲策略 - 用多腿期权组合管理“隐含波动率风险”的专业玩法',
  slug: 'vega-hedging-multi-option-combo',
  summary:
    'Vega 对冲策略，是围绕期权中的 Vega 希腊值设计的一类进阶波动率玩法：通过叠加不同到期日、不同执行价、不同标的（如 BTC/ETH）的期权头寸，将组合的 Vega 暴露放大、缩小甚至中和，从而达到“只交易价格方向”“只交易时间价值”或“只交易波动率变化”的细分目标。对已经在卖方策略（如卖出期权、结构化产品）中暴露大量 Vega 风险的玩家尤为重要，可以用专门的 Vega 对冲腿来降低在隐含波动率剧烈变化时的 PnL 摇摆；同时，也可刻意构建接近 Delta 中性、Theta 中性但 Vega 显著的组合，纯粹押注未来隐含波动率的上升或下降。',
  category: 'volatility',
  category_l1: 'derivatives',
  category_l2: 'volatility',
  risk_level: 4,
  apy_min: 10,
  apy_max: 80,
  min_investment: 3000,
  time_commitment:
    '适合有一定期权组合基础的玩家，需要定期（天/周级别）检查组合希腊值并根据市场波动动态调仓',
  status: 'published',
  content: `# 33.6 Vega 对冲策略 - 用多腿期权组合管理“隐含波动率风险”的专业玩法

---

## 一、策略一句话说明

在期权世界里，价格方向不是唯一的风险，  
**“隐含波动率本身怎么变”** 也是一个巨大变量。

> Vega 对冲策略，就是通过多个到期日、多个执行价、多个品种的期权组合，  
> - 把你的 Vega 暴露调小、对冲，  
> - 或者刻意放大为“纯多/纯空波动率”的仓位，  
> 让你在期权卖方、结构化产品或复杂组合中，  
> 不再被隐含波动率的剧烈变化牵着鼻子走。

对你的玩法库来说，可以把它定位为：

- “期权组合层面的风险管理工具”  
- “为复杂衍生品策略服务的波动率安全垫”  
- 也是高阶玩家用来构建“纯波动率交易仓位”的核心技术。

---

## 二、先用用户听得懂的话解释：什么是 Vega？

不必讲太多数学公式，可以这样概括给用户：

- Delta：告诉你，**价格** 每变动一点，你的仓位盈亏会怎么变；  
- Theta：告诉你，**时间流逝** 会让你的仓位每天亏多少或赚多少时间价值；  
- Vega：告诉你，**市场对未来波动的预期（隐含波动率）** 每变化 1 个单位，你的仓位会怎么变。

可以用一句高度概括的话给用户：

> Vega 是“隐含波动率的杠杆系数”。  
> 你的 Vega 越大，  
> 市场对未来波动的预期每改一点，  
> 你的 PnL 摇摆就越厉害。

---

## 三、为什么要做 Vega 对冲？

### 1️⃣ 你可能“无意间”暴露了大量 Vega 风险

很多策略（尤其是卖方策略）本身就暗含巨大 Vega：

- 卖出大量短期期权换取权利金（如“卖保险”策略）；  
- 做结构化产品的卖方：  
  - 提供“保底 + 浮动收益”给别人；  
  - 自己作为对手方，其实是在卖波动率；  
- 在多腿策略中，叠加了许多 Vega 方向一致的腿。

只要隐含波动率突然暴涨（例如黑天鹅、监管事件、链上黑客）：

- 你卖出的那些期权价格会被重新抬高；  
- 即便标的价格还没怎么动，  
  你的组合浮亏也会非常难看。

### 2️⃣ 你也可以刻意构造“纯粹交易波动率”的 Vega 仓位

反过来说：

- 如果你看好“未来隐含波动率会持续上升”，  
  可以构建 Delta 近似中性、Theta 控制在可接受范围内的组合，  
  但保留显著的 Vega 多头暴露；  

- 如果你认为“当前隐含波动率被严重高估”，  
  可以构建一个 Vega 空头仓位，  
  押注未来波动率收缩带来的 PnL 收益。

这就是所谓 **Vega Trading**：  
不赌价格方向，只赌波动率本身的 re-pricing。

---

## 四、用户能理解的三种 Vega 对冲使用场景

为了让 Vega 对冲不显得“过于学院派”，可以从三个具体场景切入：

### 场景 A：你是期权卖方，需要“买一点 Vega 防身”

比如你：

- 长期在卖近月 OTM 期权收权利金；  
- 主要赚钱来源是时间价值衰减和“绝大多数时间什么都没发生”；  

你的问题是：

- 一旦隐含波动率短时间飙升，  
- 你卖出的这些期权价格会猛涨，  
- 即便最后价格没到执行价，  
  中途的浮亏也会让你的风控极其难受。

解决思路：

- 用一部分长期、深度 OTM 的长 Vega 头寸，  
  作为对冲腿；  
- 当隐含波动率整体抬升时，  
  这些长 Vega 头寸会升值，  
  部分抵消你短 Vega 卖方仓位的浮亏。

你可以在卡片中写成：

> “卖保险的同时，  
>  自己悄悄买一份再保险。”

---

### 场景 B：你已经有复杂组合，希望“去掉 Vega 噪音”

当你在做某种特定结构（比如 Calendar Spread、Gamma Scalping 等）时：

- 你真正想交易的，可能是价格方向或者时间衰减；  
- Vega 的剧烈波动会制造很多“你不想要的噪音”。

例如：

- 你在做一个对冲好的 Gamma Scalping 策略，  
  主要精力在处理 Delta 和 Theta；  
- 但每次隐含波动率大幅变化时，  
  你的期权组合价值都会有一大块被 Vega 摇摆；  
- 你可能希望用一腿或几腿额外头寸，  
  把整体 Vega 拉低或接近零。

这样，你的盈亏曲线就更纯粹地反映 “方向 + 时间 + 波动实现情况”，  
而不是被预期波动的重新定价拖来拖去。

---

### 场景 C：你对隐含波动率本身有强观点，希望放大 Vega

如果你已经有一套成熟的波动率研究框架：

- 你知道哪些时段隐含波动率会长期偏高或偏低；  
- 你能识别出“IV 远高于历史 realized vol”的错误定价；  
- 想要做一笔“做多/做空波动率”而不是做价格方向的交易。

这时，你可以：

- 构建一个 Delta 接近 0、Theta 尽量为 0（或小幅受控负值/正值）的组合；  
- 刻意让 Vega 大幅为正（long Vega）或为负（short Vega）；  
- 这样，隐含波动率每动一点，  
  你的 PnL 会有非常直观的反馈。

这就是更“纯粹的 Vega 交易”。

---

## 五、概念层面的 Vega 对冲方法示意

为了方便在玩法卡里解释，可以提供若干概念化操作方式（不涉及公式推导）：

### 1️⃣ 跨期限对冲：短期卖方 + 长期买方

例如，你手上有：

- 大量短期期权空头（短 Vega）；  

你可以：

- 用部分资金买入同一标的的长期期权多头（长 Vega）；  
- 通过合适的张数配比，让整体 Vega 不至于裸奔。

### 2️⃣ 跨标的对冲：BTC Vega vs ETH Vega

如果你在某个标的上卖出了很多 Vega：

- 比如大量 ETH 期权空头；  

而你认为：

- 整个加密市场的隐含波动率会整体抬升/下行，  
- 但不同标的之间有相互联动；  

你可以在相关性较高的另一个标的（比如 BTC）上构建反向 Vega：

- 长 Vega 对冲 ETH 上的短 Vega，  
- 或者反之。  

这就类似“跨品种 Vega Spread”。

### 3️⃣ 同一到期、多执行价组合的局部 Vega 调整

在更细粒度层面，你可以：

- 对某一段价格区间上的 Vega 暴露进行雕刻：  
  - 在某些执行价上增加 Vega 多头，  
  - 在另一些执行价上增加 Vega 空头；  
- 形成一条“Vega 分布曲线”，  
  使组合对特定价格区间的隐含波动率变化更敏感或更迟钝。

这些内容在玩法文案中不必写得太技术，只要传达一个信息：

> “Vega 不一定非要全关或全开，  
>  你可以像调 EQ 一样，  
>  在不同到期日和执行价上进行细致的增减。”

---

## 六、简化版“Vega 组合检查器”概念（教学用）

你可以在开发时用一个类来表示组合的简化 Greeks：

\`\`\`javascript
class OptionPosition {
  constructor({ symbol, expiry, strike, type, size, delta, gamma, theta, vega }) {
    this.symbol = symbol;  // 标的，如 BTC/ETH
    this.expiry = expiry;  // 到期日
    this.strike = strike;  // 执行价
    this.type = type;      // 'call' or 'put'
    this.size = size;      // 张数，正为多头，负为空头
    this.delta = delta;    // 每张期权的 Delta
    this.gamma = gamma;    // 每张期权的 Gamma
    this.theta = theta;    // 每张期权的 Theta
    this.vega = vega;      // 每张期权的 Vega
  }
}

class PortfolioGreeks {
  constructor() {
    this.positions = [];
  }

  addPosition(pos) {
    this.positions.push(pos);
  }

  get netGreeks() {
    return this.positions.reduce(
      (acc, p) => {
        acc.delta += p.delta * p.size;
        acc.gamma += p.gamma * p.size;
        acc.theta += p.theta * p.size;
        acc.vega += p.vega * p.size;
        return acc;
      },
      { delta: 0, gamma: 0, theta: 0, vega: 0 }
    );
  }

  /**
   * 判断当前组合是否需要进行 Vega 对冲
   * 简化逻辑：若 |Vega| 远大于 |Delta| 或 |Theta| 的若干倍，则提示
   */
  checkVegaRisk({ vegaThresholdAbs = 100, vegaToDeltaRatio = 3 }) {
    const { delta, theta, vega } = this.netGreeks;
    const absVega = Math.abs(vega);
    const absDelta = Math.abs(delta);

    const warnings = [];

    if (absVega > vegaThresholdAbs) {
      warnings.push('组合的绝对 Vega 暴露较大，隐含波动率变化将显著影响 PnL。');
    }

    if (absDelta > 0 && absVega / absDelta > vegaToDeltaRatio) {
      warnings.push('组合 Vega 相对 Delta 过大，你的仓位更像是在交易波动率，而非价格方向。');
    }

    return {
      delta,
      theta,
      vega,
      warnings
    };
  }
}
\`\`\`

在前端，你可以把这类检查结果做成一个简单的提示卡：

- 显示组合当前 Delta/Gamma/Theta/Vega；  
- 用颜色标注 Vega 是否“过大”；  
- 给出建议：“是否考虑使用 Vega 对冲腿降低隐含波动率风险”。

---

## 七、Vega 对冲实际操作中的注意事项

在文案里，需要诚实告诉用户：

1. **对冲不是免费午餐**

- 每一条对冲腿都会带来新的成本：  
  - 权利金、点差、滑点、手续费；  
- 过度对冲可能把本来的策略收益全部吃掉，  
  甚至变成负收益。

2. **Vega 对冲永远是动态的**

- 组合的 Greeks 会随着价格、时间、波动率变化而改变；  
- 今天 Vega = 0，不代表明天还等于 0；  
- 对冲意味着你要接受“不断调整”的现实。

3. **不能只看 Vega，忽略 Delta 和 Theta**

- 有些所谓“Vega 对冲”实际会引入很大的 Delta 或 Theta；  
- 所以在执行 Vega 对冲时，需要同时看：  
  - Delta 是否仍在你可接受范围内；  
  - Theta 是否被扭曲成你不想要的方向。

4. **流动性与执行细节**

- 某些远期、深度 OTM 的期权流动性差；  
- 用它们做 Vega 对冲，可能在理论上可行，  
  但实盘中存在严重滑点和对手不对称问题。

---

## 八、用户级别分层建议：谁适合学 Vega 对冲？

在玩法卡里可以明确告知用户：

- **更适合以下玩家：**

  1. 已经在使用多腿期权策略的进阶玩家；  
  2. 有卖方策略（如 Covered Call、Put Selling、结构化产品）的半专业玩家；  
  3. 愿意使用工具或脚本查看 Greeks，并做出调整决策的人。

- **暂时不适合：**

  1. 期权基础还停留在“买涨买跌”的新手；  
  2. 无法接受组合需要不断调仓、无法长期盯盘的人；  
  3. 把期权当“彩票”，只追求一次性暴利的人。

同时，可以建议用户：

> 在没有任何实战经验之前，  
> 先用纸面模拟或小仓位做 1-2 个月的 Vega 管理练习，  
> 把“隐含波动率变化对组合的影响”体验完整，  
> 再逐步加大规模。

---

## 九、实战 Checklist（Vega 对冲版）

### 执行前

- [ ] 你能否大致说清楚：  
  - 组合当前的主要收益来源是哪几个：方向 / 时间 / 波动率？  
- [ ] 你是否已经从交易所或工具中获取了当前组合的 Delta / Theta / Vega？  
- [ ] 你对隐含波动率未来的判断是：  
  - 偏多？偏空？还是只想降低整体敏感度？  
- [ ] 你是否清楚本次 Vega 对冲的预算与可承受成本？

### 执行中

- [ ] 每增加一条对冲腿后，重新计算组合 Greeks；  
- [ ] 避免通过 Vega 对冲引入巨大 Delta/Theta；  
- [ ] 优先使用流动性良好的到期日和执行价，降低交易 frictions。

### 执行后

- [ ] 定期检查：  
  - Vega 是否真的下降或被中和？  
  - PnL 波动是否变得更可控？  
- [ ] 在市场环境发生显著变化（事件、政策、链上黑天鹅）时，重新评估：  
  - 是否需要减弱或增强 Vega 对冲力度？  
- [ ] 反思：  
  - 哪些对冲腿是“必要的”，哪些是“多余的”？  
  - 有没有更简单的组合方式实现同样的 Vega 目标？

---

## 十、小结：Vega 对冲在你的玩法体系中的位置

你可以在平台上，用下面这个定位来描述 33.6：

- 它不是一个“单独拿出来就赚钱”的简单玩法；  
- 它更像是 **给复杂期权/衍生品策略加装的一套“减震系统”**；  
- 对已经在卖方策略或结构化策略中承担大量 Vega 风险的玩家来说，  
  是必修课，而不是选修课。

可以在卡片结尾给用户一句总结：

> “如果说 Straddle、日历价差、蝶式是玩波动率的武器，  
>  那 Vega 对冲就是你在战斗中保护自己不被反噬的盾牌。  
>  只有当你既会挥刀，又会举盾，  
>  才算真正踏入了波动率交易者的门槛。”

`
};

/**
 * 上传 33.5 & 33.6 策略到 Directus
 *（结构参考 31.1 & 31.2 模板：同样提供 uploadStrategies 辅助函数，方便直接在 Node 环境执行）
 */
async function uploadStrategies() {
  const DIRECTUS_URL = 'http://localhost:8055';

  console.log(
    '开始上传策略 33.5 (Straddle 跨式期权持有) 和 33.6 (Vega 对冲策略)...\n'
  );

  try {
    // 获取新的管理员令牌（保持与现有脚本风格一致）
    const { execSync } = require('child_process');
    const tokenOutput = execSync('./get-new-directus-token.sh').toString();
    const tokenMatch = tokenOutput.match(/DIRECTUS_ADMIN_TOKEN=(.+)/);

    if (!tokenMatch) {
      throw new Error('Failed to get admin token');
    }

    const ADMIN_TOKEN = tokenMatch[1].trim();

    const headers = {
      Authorization: `Bearer ${ADMIN_TOKEN}`,
      'Content-Type': 'application/json'
    };

    console.log('上传策略 33.5: Straddle 跨式期权持有...');
    await axios.post(`${DIRECTUS_URL}/items/strategies`, STRATEGY_33_5, {
      headers
    });
    console.log('✅ 策略 33.5 上传成功\\n');

    console.log('上传策略 33.6: Vega 对冲策略...');
    await axios.post(`${DIRECTUS_URL}/items/strategies`, STRATEGY_33_6, {
      headers
    });
    console.log('✅ 策略 33.6 上传成功\\n');

    const response = await axios.get(
      `${DIRECTUS_URL}/items/strategies?limit=1&meta=total_count`,
      { headers }
    );
    console.log(
      `✅ 数据库中现有策略总数: ${response.data.meta.total_count}`
    );
  } catch (error) {
    console.error('❌ 上传失败:', error.response?.data || error.message);
    process.exit(1);
  }
}

// 若要在 Node 中直接执行本文件把策略写入 Directus，请确保有 get-new-directus-token.sh ，然后运行：

uploadStrategies();
