# Directus æ’è¡Œæ¦œç®¡ç†é…ç½®æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Directus ç®¡ç†åå°é…ç½®æ’è¡Œæ¦œç›¸å…³çš„å­—æ®µã€æƒé™å’Œè§†å›¾ã€‚

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### å‰ææ¡ä»¶
- âœ… Directus å·²ç»è¿è¡Œ (http://localhost:8055)
- âœ… æ•°æ®åº“è¿ç§»å·²å®Œæˆ (strategies è¡¨å·²æ·»åŠ æ–°å­—æ®µ)
- âœ… æœ‰ç®¡ç†å‘˜æƒé™è´¦å·

### ç™»å½•ä¿¡æ¯
- URL: http://localhost:8055
- é‚®ç®±: the_uk1@outlook.com
- å¯†ç : Mygcdjmyxzg2026!

---

## ğŸ”§ é…ç½®æ­¥éª¤

### Step 1: è¿è¡Œè‡ªåŠ¨é…ç½®è„šæœ¬

```bash
node configure-leaderboard-directus.js
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨é…ç½®å­—æ®µçš„å…ƒæ•°æ®,åŒ…æ‹¬:
- å­—æ®µæ˜¾ç¤ºæ–¹å¼
- å­—æ®µå›¾æ ‡
- åªè¯»/å¯ç¼–è¾‘è®¾ç½®
- å­—æ®µè¯´æ˜

---

### Step 2: é…ç½®æ•°æ®æ¨¡å‹

#### 2.1 è¿›å…¥æ•°æ®æ¨¡å‹è®¾ç½®
1. ç™»å½• Directus
2. ç‚¹å‡»å³ä¸Šè§’ **Settings** (é½¿è½®å›¾æ ‡)
3. è¿›å…¥ **Data Model**
4. é€‰æ‹© **strategies** é›†åˆ

#### 2.2 åˆ›å»ºå­—æ®µåˆ†ç»„ "æ’è¡Œæ¦œ"

1. åœ¨å­—æ®µåˆ—è¡¨ä¸­,ç‚¹å‡» **New Field Group**
2. è®¾ç½®åˆ†ç»„åç§°: `æ’è¡Œæ¦œ` / `Leaderboard`
3. è®¾ç½®å›¾æ ‡: é€‰æ‹© `trophy` æˆ– `trending_up`
4. ä¿å­˜åˆ†ç»„

#### 2.3 æ•´ç†å­—æ®µåˆ°åˆ†ç»„

å°†ä»¥ä¸‹å­—æ®µæ‹–å…¥ "æ’è¡Œæ¦œ" åˆ†ç»„:
- `hotness_score` - çƒ­åº¦åˆ†
- `share_count` - åˆ†äº«æ•°
- `comment_count` - è¯„è®ºæ•°
- `featured_order` - ç²¾é€‰æ’åº
- `last_hotness_update` - æœ€åæ›´æ–°æ—¶é—´

åŒæ—¶å°†ç›¸å…³å­—æ®µä¹Ÿåˆ†ç»„:
- `view_count` - æµè§ˆé‡ (å¯èƒ½åœ¨å…¶ä»–åˆ†ç»„)
- `bookmark_count` - æ”¶è—æ•° (å¯èƒ½åœ¨å…¶ä»–åˆ†ç»„)
- `is_featured` - æ˜¯å¦ç²¾é€‰ (å¯èƒ½åœ¨å…¶ä»–åˆ†ç»„)

#### 2.4 å­—æ®µè¯¦ç»†é…ç½®

##### hotness_score (çƒ­åº¦åˆ†)
```
ç±»å‹: Decimal
æ¥å£: Input
æ˜¾ç¤º: Formatted Value
é€‰é¡¹:
  - å°æ•°ä½: 2
  - åç¼€: " åˆ†"
  - å›¾æ ‡: trending_up
  - åªè¯»: âœ… (ç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—)
è¯´æ˜: çƒ­åº¦è¯„åˆ† - ç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—
```

##### share_count (åˆ†äº«æ•°)
```
ç±»å‹: Integer
æ¥å£: Input
æ˜¾ç¤º: Formatted Value
é€‰é¡¹:
  - å ä½ç¬¦: 0
  - å›¾æ ‡: share
  - åªè¯»: âŒ (å¯æ‰‹åŠ¨ä¿®æ”¹)
è¯´æ˜: åˆ†äº«æ¬¡æ•° - å¯æ‰‹åŠ¨ä¿®æ”¹æˆ–ç”±ç³»ç»Ÿæ›´æ–°
```

##### comment_count (è¯„è®ºæ•°)
```
ç±»å‹: Integer
æ¥å£: Input
æ˜¾ç¤º: Formatted Value
é€‰é¡¹:
  - å ä½ç¬¦: 0
  - å›¾æ ‡: comment
  - åªè¯»: âŒ
è¯´æ˜: è¯„è®ºæ•° - å¯æ‰‹åŠ¨ä¿®æ”¹æˆ–ç”±ç³»ç»Ÿæ›´æ–°
```

##### featured_order (ç²¾é€‰æ’åº)
```
ç±»å‹: Integer
æ¥å£: Input
æ˜¾ç¤º: Formatted Value
é€‰é¡¹:
  - å ä½ç¬¦: "ç•™ç©ºåˆ™ä¸æ˜¾ç¤ºåœ¨ç²¾é€‰æ¦œ"
  - æœ€å°å€¼: 1
  - å›¾æ ‡: filter_1
  - åªè¯»: âŒ
è¯´æ˜: ç¼–è¾‘ç²¾é€‰æ’åº - æ•°å­—è¶Šå°è¶Šé å‰
æç¤º: ä»…åœ¨ is_featured=true æ—¶ç”Ÿæ•ˆ
```

##### last_hotness_update (æœ€åæ›´æ–°æ—¶é—´)
```
ç±»å‹: Timestamp
æ¥å£: Datetime
æ˜¾ç¤º: Datetime (ç›¸å¯¹æ—¶é—´)
é€‰é¡¹:
  - å›¾æ ‡: access_time
  - åªè¯»: âœ…
è¯´æ˜: æœ€åçƒ­åº¦æ›´æ–°æ—¶é—´ - ç”±å®šæ—¶ä»»åŠ¡æ›´æ–°
```

---

### Step 3: é…ç½®åˆ—è¡¨è§†å›¾

#### 3.1 è‡ªå®šä¹‰åˆ—è¡¨æ˜¾ç¤º

1. è¿›å…¥ **strategies** é›†åˆçš„å†…å®¹é¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’ **å¸ƒå±€é€‰é¡¹** (Layout Options)
3. é€‰æ‹© **Table Layout**
4. ç‚¹å‡» **è‡ªå®šä¹‰åˆ—** (Customize Columns)

#### 3.2 æ·»åŠ ä»¥ä¸‹åˆ— (æŒ‰é¡ºåº)

```
âœ… title (æ ‡é¢˜)
âœ… category (åˆ†ç±»)
âœ… hotness_score (çƒ­åº¦åˆ†) â­ é‡è¦
âœ… view_count (æµè§ˆé‡)
âœ… bookmark_count (æ”¶è—æ•°)
âœ… is_featured (æ˜¯å¦ç²¾é€‰)
âœ… featured_order (ç²¾é€‰æ’åº)
âœ… status (çŠ¶æ€)
âœ… published_at (å‘å¸ƒæ—¶é—´)
```

#### 3.3 è®¾ç½®åˆ—å®½åº¦

```
title: 300px (å®½)
category: 150px
hotness_score: 120px (åŠ ç²—æ˜¾ç¤º)
view_count: 100px
bookmark_count: 100px
is_featured: 80px (ä½¿ç”¨å‹¾é€‰æ¡†)
featured_order: 100px
status: 100px
published_at: 180px
```

#### 3.4 è®¾ç½®é»˜è®¤æ’åº

1. ç‚¹å‡» **æ’åº** (Sort) æŒ‰é’®
2. æ·»åŠ æ’åºè§„åˆ™:
   - **ä¸»æ’åº**: `hotness_score` - é™åº (DESC) â¬‡ï¸
   - **å‰¯æ’åº**: `view_count` - é™åº (DESC) â¬‡ï¸
3. ä¿å­˜æ’åºè®¾ç½®

---

### Step 4: åˆ›å»ºå¿«é€Ÿç­›é€‰å™¨

#### 4.1 æ·»åŠ é¢„è®¾ç­›é€‰å™¨

1. ç‚¹å‡» **ç­›é€‰å™¨** (Filter) æŒ‰é’®
2. ç‚¹å‡» **ä¿å­˜ä¸ºé¢„è®¾** (Save as Preset)

#### 4.2 åˆ›å»ºä»¥ä¸‹é¢„è®¾ç­›é€‰å™¨

##### é¢„è®¾ 1: ç²¾é€‰ç­–ç•¥ â­
```
åç§°: ç²¾é€‰ç­–ç•¥
å›¾æ ‡: star
ç­›é€‰æ¡ä»¶:
  - is_featured = true
  - status = published
æ’åº:
  - featured_order ASC
  - hotness_score DESC
```

##### é¢„è®¾ 2: é«˜çƒ­åº¦ç­–ç•¥ ğŸ”¥
```
åç§°: é«˜çƒ­åº¦ç­–ç•¥
å›¾æ ‡: trending_up
ç­›é€‰æ¡ä»¶:
  - hotness_score >= 100
  - status = published
æ’åº:
  - hotness_score DESC
```

##### é¢„è®¾ 3: å¾…è®¾ç½®ç²¾é€‰é¡ºåº
```
åç§°: å¾…è®¾ç½®ç²¾é€‰é¡ºåº
å›¾æ ‡: warning
ç­›é€‰æ¡ä»¶:
  - is_featured = true
  - featured_order is null
æ’åº:
  - created_at DESC
```

##### é¢„è®¾ 4: ä»Šæ—¥å‘å¸ƒ
```
åç§°: ä»Šæ—¥å‘å¸ƒ
å›¾æ ‡: today
ç­›é€‰æ¡ä»¶:
  - published_at >= [today]
  - status = published
æ’åº:
  - published_at DESC
```

---

### Step 5: é…ç½®æƒé™

#### 5.1 Public è§’è‰²æƒé™

1. è¿›å…¥ **Settings â†’ Access Control â†’ Public**
2. æ‰¾åˆ° **strategies** é›†åˆ
3. è®¾ç½®æƒé™:

```
è¯»å– (Read): âœ… å…è®¸
  - ç­›é€‰æ¡ä»¶: status = "published"
  - å…è®¸å­—æ®µ:
    âœ… id, title, slug, summary, content, category
    âœ… risk_level, apy_min, apy_max
    âœ… view_count, bookmark_count
    âœ… hotness_score â­
    âœ… share_count, comment_count
    âœ… is_featured, featured_order
    âœ… published_at, created_at

åˆ›å»º (Create): âŒ ç¦æ­¢
æ›´æ–° (Update): âŒ ç¦æ­¢
åˆ é™¤ (Delete): âŒ ç¦æ­¢
```

#### 5.2 Admin è§’è‰²æƒé™

1. è¿›å…¥ **Settings â†’ Access Control â†’ Administrator**
2. ç¡®ä¿å¯¹ **strategies** æœ‰å®Œå…¨æƒé™:

```
è¯»å–: âœ… å…¨éƒ¨
åˆ›å»º: âœ… å…¨éƒ¨
æ›´æ–°: âœ… å…¨éƒ¨
åˆ é™¤: âœ… å…¨éƒ¨
```

---

### Step 6: è®¾ç½®ç¼–è¾‘ç²¾é€‰ç­–ç•¥

#### 6.1 æ‰¹é‡è®¾ç½®ç²¾é€‰

1. åœ¨ç­–ç•¥åˆ—è¡¨ä¸­,å‹¾é€‰è¦ç²¾é€‰çš„ç­–ç•¥
2. ç‚¹å‡» **æ‰¹é‡ç¼–è¾‘** (Batch Edit)
3. è®¾ç½®:
   ```
   is_featured: true
   ```
4. ä¿å­˜

#### 6.2 è®¾ç½®ç²¾é€‰é¡ºåº

æ–¹æ³•1: å•ä¸ªç¼–è¾‘
1. æ‰“å¼€ä¸€ä¸ªç²¾é€‰ç­–ç•¥
2. åœ¨ "æ’è¡Œæ¦œ" åˆ†ç»„ä¸­æ‰¾åˆ° `featured_order`
3. è¾“å…¥æ•°å­— (1, 2, 3...)
4. ä¿å­˜

æ–¹æ³•2: æ‰¹é‡ç¼–è¾‘
1. ä½¿ç”¨é¢„è®¾ç­›é€‰å™¨ "ç²¾é€‰ç­–ç•¥"
2. é€ä¸ªè®¾ç½® `featured_order`
3. å»ºè®®é¡ºåº:
   ```
   æœ€é‡è¦çš„ç­–ç•¥: 1
   æ¬¡é‡è¦çš„ç­–ç•¥: 2, 3, 4...
   ä¸€èˆ¬ç²¾é€‰ç­–ç•¥: 10+
   ```

#### 6.3 éªŒè¯ç²¾é€‰æ¦œ

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000/leaderboard
2. åˆ‡æ¢åˆ° "ç²¾é€‰æ¦œ" Tab
3. æ£€æŸ¥ç­–ç•¥æ˜¯å¦æŒ‰ `featured_order` æ’åº

---

### Step 7: æ‰‹åŠ¨æ›´æ–°çƒ­åº¦åˆ† (å¯é€‰)

å¦‚æœéœ€è¦ç«‹å³é‡æ–°è®¡ç®—çƒ­åº¦åˆ†:

#### æ–¹æ³•1: é€šè¿‡ SQL (Supabase)
```sql
-- æ›´æ–°æ‰€æœ‰ç­–ç•¥çš„çƒ­åº¦åˆ†
UPDATE strategies
SET hotness_score = (
  COALESCE(view_count, 0) * 0.3 +
  COALESCE(bookmark_count, 0) * 2.0 +
  COALESCE(comment_count, 0) * 1.5 +
  COALESCE(share_count, 0) * 3.0
),
last_hotness_update = NOW()
WHERE status = 'published';
```

#### æ–¹æ³•2: é€šè¿‡è„šæœ¬
åˆ›å»º `update-hotness.js`:
```javascript
const { createClient } = require('@supabase/supabase-js');

const supabase = createClient(
  'https://cujpgrzjmmttysphjknu.supabase.co',
  'SERVICE_ROLE_KEY'
);

// è°ƒç”¨æ•°æ®åº“å‡½æ•°
await supabase.rpc('update_all_hotness_scores');
```

---

## ğŸ“Š æ•°æ®ç»´æŠ¤

### å®šæœŸæ£€æŸ¥

å»ºè®®æ¯å‘¨æ£€æŸ¥ä»¥ä¸‹å†…å®¹:

#### 1. çƒ­åº¦åˆ†æ›´æ–°
```sql
SELECT
  title,
  hotness_score,
  last_hotness_update,
  NOW() - last_hotness_update AS hours_since_update
FROM strategies
WHERE status = 'published'
ORDER BY hotness_score DESC
LIMIT 20;
```

#### 2. ç²¾é€‰ç­–ç•¥çŠ¶æ€
```sql
SELECT
  title,
  is_featured,
  featured_order,
  hotness_score
FROM strategies
WHERE is_featured = true
ORDER BY featured_order ASC NULLS LAST;
```

#### 3. æµè§ˆé‡ Top 10
```sql
SELECT
  title,
  view_count,
  bookmark_count,
  hotness_score
FROM strategies
WHERE status = 'published'
ORDER BY view_count DESC
LIMIT 10;
```

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### ç¼–è¾‘ç²¾é€‰æ¦œç­–ç•¥

1. **é€‰æ‹©æ ‡å‡†**:
   - å†…å®¹è´¨é‡é«˜
   - æ•°æ®å‡†ç¡®
   - é€‚åˆæ–°æ‰‹
   - å›æŠ¥ç¨³å®š
   - é£é™©å¯æ§

2. **ç²¾é€‰æ•°é‡**:
   - å»ºè®®ä¿æŒ 10-15 ä¸ªç²¾é€‰ç­–ç•¥
   - å®šæœŸæ›´æ–° (æ¯æœˆè‡³å°‘ä¸€æ¬¡)

3. **æ’åºç­–ç•¥**:
   - 1-3: æœ€æ¨èçš„æ ¸å¿ƒç­–ç•¥
   - 4-7: ä¼˜è´¨è¡¥å……ç­–ç•¥
   - 8-15: å¤šæ ·åŒ–é€‰æ‹©

### çƒ­åº¦åˆ†ç®¡ç†

1. **ç†è§£çƒ­åº¦åˆ†**:
   ```
   hotness_score = (
     view_count Ã— 0.3 +      // æµè§ˆæƒé‡ä½
     bookmark_count Ã— 2.0 +  // æ”¶è—æƒé‡é«˜
     comment_count Ã— 1.5 +   // è¯„è®ºæƒé‡ä¸­
     share_count Ã— 3.0       // åˆ†äº«æƒé‡æœ€é«˜
   ) Ã— decay_factor          // æ—¶é—´è¡°å‡
   ```

2. **æå‡çƒ­åº¦åˆ†çš„æ–¹æ³•**:
   - æé«˜å†…å®¹è´¨é‡ â†’ å¢åŠ æ”¶è—
   - é¼“åŠ±åˆ†äº« â†’ å¢åŠ åˆ†äº«æ•°
   - äº’åŠ¨è®¨è®º â†’ å¢åŠ è¯„è®º

3. **å¼‚å¸¸çƒ­åº¦å¤„ç†**:
   - å¦‚æœå‘ç°åˆ·æ¦œè¡Œä¸º,å¯æ‰‹åŠ¨è°ƒæ•´
   - è®¾ç½® `hotness_score` ä¸ºåˆç†å€¼

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: çƒ­åº¦åˆ†ä¸æ›´æ–°æ€ä¹ˆåŠ?
**A**: çƒ­åº¦åˆ†éœ€è¦å®šæ—¶ä»»åŠ¡æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰é…ç½®å®šæ—¶ä»»åŠ¡,å¯ä»¥æ‰‹åŠ¨æ‰§è¡ŒSQLæ›´æ–°ã€‚

### Q2: ç²¾é€‰æ¦œä¸ºç©º?
**A**: æ£€æŸ¥æ˜¯å¦æœ‰ç­–ç•¥çš„ `is_featured = true`ã€‚å¦‚æœæœ‰,å†æ£€æŸ¥ `featured_order` æ˜¯å¦è®¾ç½®ã€‚

### Q3: å¦‚ä½•ä¸´æ—¶ç½®é¡¶æŸä¸ªç­–ç•¥?
**A**:
- æ–¹æ³•1: è®¾ç½® `is_featured = true`, `featured_order = 1`
- æ–¹æ³•2: æ‰‹åŠ¨æé«˜ `hotness_score` åˆ°å¾ˆé«˜çš„å€¼ (å¦‚ 9999)

### Q4: å¯ä»¥éšè—æŸäº›å­—æ®µå—?
**A**: åœ¨å­—æ®µé…ç½®ä¸­è®¾ç½® `hidden = true`,è¯¥å­—æ®µå°†åªåœ¨ç¼–è¾‘æ—¶å¯è§,åˆ—è¡¨ä¸­ä¸æ˜¾ç¤ºã€‚

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] è¿è¡Œäº†è‡ªåŠ¨é…ç½®è„šæœ¬
- [ ] åˆ›å»ºäº† "æ’è¡Œæ¦œ" å­—æ®µåˆ†ç»„
- [ ] é…ç½®äº†æ‰€æœ‰æ’è¡Œæ¦œå­—æ®µçš„æ˜¾ç¤ºæ–¹å¼
- [ ] è®¾ç½®äº†åˆ—è¡¨è§†å›¾çš„åˆ—å’Œæ’åº
- [ ] åˆ›å»ºäº†å¿«é€Ÿç­›é€‰å™¨é¢„è®¾
- [ ] é…ç½®äº† Public è§’è‰²çš„è¯»å–æƒé™
- [ ] è®¾ç½®äº†è‡³å°‘ 5 ä¸ªç²¾é€‰ç­–ç•¥
- [ ] ä¸ºç²¾é€‰ç­–ç•¥è®¾ç½®äº† featured_order
- [ ] éªŒè¯äº†æ’è¡Œæ¦œé¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] æµ‹è¯•äº†å„ä¸ªæ¦œå•çš„åˆ‡æ¢

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æŸ¥çœ‹:
- [LEADERBOARD-SYSTEM-DESIGN.md](LEADERBOARD-SYSTEM-DESIGN.md) - ç³»ç»Ÿè®¾è®¡æ–‡æ¡£
- [LEADERBOARD-COMPLETED.md](LEADERBOARD-COMPLETED.md) - å®ŒæˆæŠ¥å‘Š
- Directus å®˜æ–¹æ–‡æ¡£: https://docs.directus.io

---

**ğŸ‰ é…ç½®å®Œæˆå,æ’è¡Œæ¦œç³»ç»Ÿå³å¯å®Œå…¨è¿ä½œ!**
