# å¼€å‘è¿›åº¦æ€»ç»“ - æ–¹æ¡ˆ Aï¼šå®Œå–„æ ¸å¿ƒåŠŸèƒ½

## ğŸ“… æ›´æ–°æ—¶é—´
2025-10-22

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æœåŠ¡å•†åŠŸèƒ½æ¸…ç†
- âœ… åˆ é™¤ `/app/providers` é¡µé¢å’Œç»„ä»¶
- âœ… åˆ é™¤ `/components/providers` ç»„ä»¶
- âœ… åˆ é™¤ç›¸å…³è„šæœ¬ (`add-sample-providers.js`, `check-provider-fields.js`)
- âœ… æ›´æ–° `lib/directus.ts` ç§»é™¤ ServiceProvider ç±»å‹å’Œå‡½æ•°
- âœ… åœ¨æ–‡æ¡£ä¸­æ³¨é‡ŠæœåŠ¡å•†ç›¸å…³å†…å®¹

### 2. Supabase è®¤è¯ç³»ç»Ÿ â­

#### 2.1 è®¤è¯åŸºç¡€è®¾æ–½
- âœ… åˆ›å»º Supabase æµè§ˆå™¨å®¢æˆ·ç«¯ (`lib/supabase/client.ts`)
- âœ… åˆ›å»º Supabase æœåŠ¡ç«¯å®¢æˆ·ç«¯ (`lib/supabase/server.ts`)
- âœ… é…ç½®è®¤è¯ä¸­é—´ä»¶ (`lib/supabase/middleware.ts` + `middleware.ts`)
- âœ… åˆ›å»º `useAuth` React Hook (`hooks/useAuth.ts`)

#### 2.2 å¤šç§ç™»å½•æ–¹å¼
å·²æ›´æ–°ç™»å½•é¡µé¢ `/auth/login` æ”¯æŒï¼š
- âœ… **é‚®ç®±å¯†ç ç™»å½•**
- âœ… **Magic Link (æ— å¯†ç ç™»å½•)**
- âœ… **Google OAuth ç™»å½•** (å·²åœ¨ Supabase é…ç½®)
- â¸ï¸ **Twitter OAuth ç™»å½•** (æš‚ç¼“é…ç½®)
- ğŸ”œ **Web3 é’±åŒ…ç™»å½•** (å¾…å®ç°)

#### 2.3 OAuth å›è°ƒå¤„ç†
- âœ… åˆ›å»º `/auth/callback` è·¯ç”±å¤„ç† OAuth å›è°ƒ

### 3. ç”¨æˆ·äº¤äº’ç³»ç»Ÿ â­

#### 3.1 æ•°æ®åº“ Schema
å·²åˆ›å»ºå®Œæ•´çš„ç”¨æˆ·äº¤äº’æ•°æ®åº“ç»“æ„ (`create-user-interactions-schema.sql`):

**è¡¨ç»“æ„ï¼š**
- âœ… `user_interactions` - ç”¨æˆ·äº¤äº’è®°å½•è¡¨
  - æ”¯æŒï¼šç‚¹èµ (like)ã€æ”¶è— (favorite)ã€å…³æ³¨ (follow)ã€æµè§ˆ (view)
  - å†…å®¹ç±»å‹ï¼šç­–ç•¥ (strategy)ã€èµ„è®¯ (news)
  - å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤äº¤äº’
  
- âœ… `user_profiles` - ç”¨æˆ·èµ„æ–™æ‰©å±•è¡¨
  - ç”¨æˆ·åã€å¤´åƒã€ç®€ä»‹
  - ç¤¾äº¤é“¾æ¥ (Twitter, Telegram, ç½‘ç«™)
  - ç”¨æˆ·ç­‰çº§å’Œç»éªŒå€¼
  - è´¡çŒ®ç»Ÿè®¡

**è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼š**
- âœ… è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³è§¦å‘å™¨
- âœ… æ–°ç”¨æˆ·è‡ªåŠ¨åˆ›å»ºèµ„æ–™è§¦å‘å™¨
- âœ… å®Œæ•´çš„ RLS (è¡Œçº§å®‰å…¨) ç­–ç•¥
- âœ… çƒ­é—¨å†…å®¹è§†å›¾ (`popular_strategies`)

#### 3.2 äº¤äº’ API
åˆ›å»ºå®Œæ•´çš„äº¤äº’ API (`/api/interactions`):
- âœ… `GET` - è·å–å†…å®¹çš„äº¤äº’ç»Ÿè®¡å’Œç”¨æˆ·äº¤äº’çŠ¶æ€
- âœ… `POST` - æ·»åŠ äº¤äº’ (ç‚¹èµ/æ”¶è—)
- âœ… `DELETE` - ç§»é™¤äº¤äº’

#### 3.3 äº¤äº’ç»„ä»¶
- âœ… `InteractionButtons` ç»„ä»¶
  - ç‚¹èµæŒ‰é’® (å¸¦æ•°é‡æ˜¾ç¤º)
  - æ”¶è—æŒ‰é’® (å¸¦æ•°é‡æ˜¾ç¤º)
  - æµè§ˆæ¬¡æ•°æ˜¾ç¤º (åªè¯»)
  - æœªç™»å½•ç”¨æˆ·å¼•å¯¼è‡³ç™»å½•é¡µ
  - å®æ—¶çŠ¶æ€æ›´æ–°
  - Toast æç¤ºæ¶ˆæ¯

### 4. ç”¨æˆ·ç•Œé¢æ›´æ–°

#### 4.1 Header ç»„ä»¶
- âœ… å·²é›†æˆç”¨æˆ·è®¤è¯çŠ¶æ€
- âœ… ç”¨æˆ·ä¸‹æ‹‰èœå•
  - ä¸ªäººä¸»é¡µ
  - æˆ‘çš„æ”¶è—
  - è®¾ç½®
  - é€€å‡ºç™»å½•
- âœ… æœªç™»å½•ç”¨æˆ·æ˜¾ç¤ºç™»å½•/æ³¨å†ŒæŒ‰é’®
- âœ… ç§»åŠ¨ç«¯å“åº”å¼èœå•

#### 4.2 ç”¨æˆ·èœå•ç»„ä»¶
- âœ… `UserMenu` ç»„ä»¶ (ç‹¬ç«‹)
- âœ… å¤´åƒæ˜¾ç¤º
- âœ… ç”¨æˆ·ä¿¡æ¯å±•ç¤º

### 5. è¯„è®ºç³»ç»Ÿ â­
- âœ… å®‰è£… Giscus React åŒ…
- âœ… åˆ›å»º `Comments` ç»„ä»¶
- âœ… æ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢
- âœ… ä¸­æ–‡ç•Œé¢

---

## ğŸ”§ é…ç½®è¦æ±‚

### Supabase æ•°æ®åº“
**éœ€è¦æ‰§è¡Œçš„ SQL:**
```bash
# åœ¨ Supabase Dashboard â†’ SQL Editor ä¸­æ‰§è¡Œ
/Users/m1/PlayNew_0.3/create-user-interactions-schema.sql
```

### Supabase Auth é…ç½®
**å·²å®Œæˆ:**
- âœ… Google OAuth (å·²é…ç½®)

**å¾…é…ç½®:**
- â¸ï¸ Twitter OAuth (ç”¨æˆ·é€‰æ‹©æš‚ç¼“)

### Giscus é…ç½®
**å¾…é…ç½® (å¯é€‰):**
éœ€è¦åœ¨ `.env.local` ä¸­é…ç½®:
```env
NEXT_PUBLIC_GISCUS_REPO=your-username/your-repo
NEXT_PUBLIC_GISCUS_REPO_ID=your-repo-id
NEXT_PUBLIC_GISCUS_CATEGORY_ID=your-category-id
```

å¦‚æœä¸é…ç½®ï¼Œè¯„è®ºåŠŸèƒ½å°†æ˜¾ç¤ºå ä½ç¬¦ã€‚

---

## ğŸ“¦ å·²å®‰è£…çš„ä¾èµ–

```json
{
  "@supabase/ssr": "latest",
  "@supabase/supabase-js": "latest",
  "@giscus/react": "latest",
  "sonner": "latest" // Toast é€šçŸ¥åº“
}
```

---

## ğŸ“ æ–°å¢æ–‡ä»¶åˆ—è¡¨

### è®¤è¯ç›¸å…³
```
frontend/
â”œâ”€â”€ lib/supabase/
â”‚   â”œâ”€â”€ client.ts          # Supabase æµè§ˆå™¨å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ server.ts          # Supabase æœåŠ¡ç«¯å®¢æˆ·ç«¯
â”‚   â””â”€â”€ middleware.ts      # è®¤è¯ä¸­é—´ä»¶è¾…åŠ©å‡½æ•°
â”œâ”€â”€ middleware.ts          # Next.js ä¸­é—´ä»¶ (session åˆ·æ–°)
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useAuth.ts         # è®¤è¯ Hook
â””â”€â”€ app/auth/callback/
    â””â”€â”€ route.ts           # OAuth å›è°ƒå¤„ç†
```

### äº¤äº’ç³»ç»Ÿ
```
frontend/
â”œâ”€â”€ app/api/interactions/
â”‚   â””â”€â”€ route.ts           # äº¤äº’ API (GET/POST/DELETE)
â””â”€â”€ components/shared/
    â”œâ”€â”€ InteractionButtons.tsx    # äº¤äº’æŒ‰é’®ç»„ä»¶
    â”œâ”€â”€ UserMenu.tsx             # ç”¨æˆ·èœå•ç»„ä»¶
    â””â”€â”€ Comments.tsx             # Giscus è¯„è®ºç»„ä»¶
```

### æ•°æ®åº“
```
create-user-interactions-schema.sql  # ç”¨æˆ·äº¤äº’æ•°æ®åº“ Schema
```

---

## ğŸ¯ å½“å‰çŠ¶æ€

### å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½
1. âœ… **ç”¨æˆ·æ³¨å†Œ/ç™»å½•**
   - Google OAuth ç™»å½•
   - é‚®ç®±å¯†ç ç™»å½•
   - Magic Link ç™»å½•

2. âœ… **ç”¨æˆ·è®¤è¯çŠ¶æ€**
   - Header æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
   - ç”¨æˆ·ä¸‹æ‹‰èœå•
   - ç™»å‡ºåŠŸèƒ½

3. âœ… **äº¤äº’ API**
   - å®Œæ•´çš„åç«¯ API å·²å°±ç»ª
   - RLS ç­–ç•¥ä¿æŠ¤æ•°æ®å®‰å…¨

4. âœ… **äº¤äº’ç»„ä»¶**
   - å¯å¤ç”¨çš„äº¤äº’æŒ‰é’®
   - å®æ—¶çŠ¶æ€æ›´æ–°

5. âœ… **è¯„è®ºç³»ç»Ÿ**
   - Giscus ç»„ä»¶å·²åˆ›å»º
   - å¾…é›†æˆåˆ°é¡µé¢

### å¾…é›†æˆåˆ°é¡µé¢
1. â³ **ç­–ç•¥è¯¦æƒ…é¡µ**
   - éœ€è¦æ·»åŠ /æ›´æ–° `InteractionButtons`
   - éœ€è¦æ·»åŠ  `Comments` ç»„ä»¶

2. â³ **èµ„è®¯è¯¦æƒ…é¡µ**
   - éœ€è¦æ·»åŠ  `InteractionButtons`
   - éœ€è¦æ·»åŠ  `Comments` ç»„ä»¶

3. â³ **ä¸ªäººä¸­å¿ƒé¡µé¢**
   - éœ€è¦å®ç°ç”¨æˆ·èµ„æ–™å±•ç¤º
   - éœ€è¦å®ç°èµ„æ–™ç¼–è¾‘åŠŸèƒ½

4. â³ **æ”¶è—å¤¹é¡µé¢**
   - éœ€è¦ä»æ•°æ®åº“è·å–ç”¨æˆ·æ”¶è—
   - éœ€è¦å±•ç¤ºæ”¶è—çš„ç­–ç•¥å’Œèµ„è®¯

---

## ğŸš€ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### Phase 1: é›†æˆå·²å¼€å‘åŠŸèƒ½ (1-2å¤©)
1. **é¡µé¢é›†æˆ**
   - [ ] åœ¨ç­–ç•¥è¯¦æƒ…é¡µæ·»åŠ  `InteractionButtons`
   - [ ] åœ¨èµ„è®¯è¯¦æƒ…é¡µæ·»åŠ  `InteractionButtons`
   - [ ] åœ¨ç­–ç•¥è¯¦æƒ…é¡µæ·»åŠ  `Comments`
   - [ ] åœ¨èµ„è®¯è¯¦æƒ…é¡µæ·»åŠ  `Comments`

2. **ä¸ªäººä¸­å¿ƒå¼€å‘**
   - [ ] ç”¨æˆ·èµ„æ–™å±•ç¤º
   - [ ] ç”¨æˆ·èµ„æ–™ç¼–è¾‘
   - [ ] ç”¨æˆ·ç»Ÿè®¡æ•°æ®

3. **æ”¶è—å¤¹å¼€å‘**
   - [ ] è·å–ç”¨æˆ·æ”¶è—åˆ—è¡¨
   - [ ] æ”¶è—å†…å®¹å±•ç¤º
   - [ ] å–æ¶ˆæ”¶è—åŠŸèƒ½

### Phase 2: Web3 é’±åŒ…ç™»å½• (å¯é€‰, 2-3å¤©)
- [ ] å®‰è£… Web3 ç›¸å…³åº“ (wagmi, viem, RainbowKit)
- [ ] é›†æˆ Supabase Web3 Provider
- [ ] æ·»åŠ é’±åŒ…è¿æ¥æŒ‰é’®
- [ ] å®ç°é’±åŒ…ç­¾åç™»å½•

### Phase 3: ç”¨æˆ·ä½“éªŒä¼˜åŒ– (1-2å¤©)
- [ ] æ·»åŠ åŠ è½½çŠ¶æ€
- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
- [ ] æ·»åŠ é”™è¯¯å¤„ç†
- [ ] æ€§èƒ½ä¼˜åŒ–

### Phase 4: æµ‹è¯•å’Œä¿®å¤ (1å¤©)
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] ä¿®å¤å‘ç°çš„é—®é¢˜
- [ ] æ–‡æ¡£æ›´æ–°

---

## ğŸ’¡ ä½¿ç”¨è¯´æ˜

### å¦‚ä½•æµ‹è¯•è®¤è¯åŠŸèƒ½

1. **å¯åŠ¨æœåŠ¡**
```bash
# åç«¯ (Directus + Meilisearch)
docker-compose up -d

# å‰ç«¯
cd frontend && npm run dev
```

2. **è®¿é—®ç™»å½•é¡µ**
```
http://localhost:3001/auth/login
```

3. **å°è¯•ç™»å½•æ–¹å¼**
- ä½¿ç”¨ Google è´¦å·ç™»å½•
- æˆ–åˆ›å»ºæ–°è´¦å· (é‚®ç®±å¯†ç )
- æˆ–ä½¿ç”¨ Magic Link

### å¦‚ä½•ä½¿ç”¨äº¤äº’åŠŸèƒ½

1. **ç™»å½•åè®¿é—®ä»»æ„ç­–ç•¥é¡µé¢**
```
http://localhost:3001/strategies/[ä»»æ„ç­–ç•¥slug]
```

2. **ç‚¹å‡»ç‚¹èµæˆ–æ”¶è—æŒ‰é’®**
   - æœªç™»å½•ä¼šå¼•å¯¼è‡³ç™»å½•é¡µ
   - ç™»å½•åå¯ä»¥æ­£å¸¸ç‚¹èµ/æ”¶è—

3. **æŸ¥çœ‹æˆ‘çš„æ”¶è—**
```
http://localhost:3001/favorites
```

---

## ğŸ“ é‡è¦è¯´æ˜

### æ•°æ®åº“ Schema æ‰§è¡Œ
**éå¸¸é‡è¦ï¼š** å¿…é¡»å…ˆåœ¨ Supabase ä¸­æ‰§è¡Œ `create-user-interactions-schema.sql` æ‰èƒ½ä½¿ç”¨äº¤äº’åŠŸèƒ½ï¼

æ­¥éª¤ï¼š
1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ SQL Editor
4. å¤åˆ¶ `create-user-interactions-schema.sql` å†…å®¹
5. æ‰§è¡Œ SQL
6. ç¡®è®¤æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸ

### ç¯å¢ƒå˜é‡æ£€æŸ¥
ç¡®ä¿ `.env.local` åŒ…å«ï¼š
```env
# Supabase (å·²é…ç½®)
NEXT_PUBLIC_SUPABASE_URL=https://cujpgrzjmmttysphjknu.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# Giscus (å¯é€‰)
NEXT_PUBLIC_GISCUS_REPO=
NEXT_PUBLIC_GISCUS_REPO_ID=
NEXT_PUBLIC_GISCUS_CATEGORY_ID=
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

æš‚æ— 

---

## ğŸ‰ æˆæœå±•ç¤º

### åŠŸèƒ½æ¼”ç¤ºè§†é¢‘/æˆªå›¾ä½ç½®
```
/Users/m1/PlayNew_0.3/screenshots/
(å¾…æ·»åŠ )
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. [Supabase æ–‡æ¡£](https://supabase.com/docs)
2. [Next.js æ–‡æ¡£](https://nextjs.org/docs)
3. [Giscus æ–‡æ¡£](https://giscus.app/zh-CN)

---

**æœ€åæ›´æ–°**: 2025-10-22
**å¼€å‘è€…**: Claude + ç”¨æˆ·åä½œ
**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¾…é¡µé¢é›†æˆ
