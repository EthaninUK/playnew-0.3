# Web3 å……å€¼åŠŸèƒ½ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

å……å€¼å¯¹è¯æ¡†å¡åœ¨"åŠ è½½æ”¯ä»˜ä¿¡æ¯..."çŠ¶æ€,æ— æ³•æ˜¾ç¤ºé“¾å’Œä»£å¸é€‰æ‹©é€‰é¡¹ã€‚

## æ ¹æœ¬åŸå› 

Web3 æ”¯ä»˜ç³»ç»Ÿéœ€è¦ä» Directus æ•°æ®åº“è¯»å–é…ç½®æ•°æ® (é“¾é…ç½®ã€ä»£å¸é…ç½®ã€å®šä»·é…ç½®),ä½†è¿™äº›è¡¨ä¹‹å‰è¿˜æ²¡æœ‰åˆ›å»ºã€‚

---

## âœ… å·²å®Œæˆçš„ä¿®å¤æ­¥éª¤

### 1. åˆ›å»º Web3 é…ç½®è¡¨ âœ…

å·²åœ¨ Directus æ•°æ®åº“ä¸­åˆ›å»º 3 ä¸ªé…ç½®è¡¨:

| è¡¨å | ç”¨é€” | è®°å½•æ•° |
|------|------|--------|
| `web3_system_config` | é“¾é…ç½® (Ethereum, Polygon, Base) | 3 æ¡ |
| `web3_supported_tokens` | ä»£å¸é…ç½® (ETH, USDC, USDT, MATIC) | 8 æ¡ |
| `web3_pricing_config` | å®šä»·å’Œå……å€¼é…ç½® | 5 æ¡ |

**æ‰§è¡Œçš„è„šæœ¬**: `setup-web3-config-simple.js`

### 2. é…ç½®å…¬å¼€è®¿é—®æƒé™ âœ…

å·²ä¸ºä¸Šè¿° 3 ä¸ªè¡¨é…ç½®äº† Public policy çš„è¯»å–æƒé™,å…è®¸å‰ç«¯ API æ— éœ€è®¤è¯å³å¯è¯»å–é…ç½®ã€‚

**æ‰§è¡Œçš„è„šæœ¬**: `configure-web3-permissions-fixed.js`

**éªŒè¯ç»“æœ**:
- âœ… `web3_system_config` - å¯å…¬å¼€è®¿é—®
- âœ… `web3_pricing_config` - å¯å…¬å¼€è®¿é—®
- âœ… `web3_supported_tokens` - å¯å…¬å¼€è®¿é—®

### 3. æ’å…¥åˆå§‹é…ç½®æ•°æ® âœ…

#### é“¾é…ç½®
- **Ethereum** (Chain ID: 1)
  - RPC: https://eth.public-rpc.com
  - ç¡®è®¤æ•°: 3
  - æ”¶æ¬¾é’±åŒ…: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb`

- **Polygon** (Chain ID: 137)
  - RPC: https://polygon-rpc.com
  - ç¡®è®¤æ•°: 10
  - æ”¶æ¬¾é’±åŒ…: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb`

- **Base** (Chain ID: 8453)
  - RPC: https://mainnet.base.org
  - ç¡®è®¤æ•°: 3
  - æ”¶æ¬¾é’±åŒ…: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb`

#### ä»£å¸é…ç½®

| é“¾ | ä»£å¸ | åˆçº¦åœ°å€ | æ¨è |
|---|------|----------|------|
| Ethereum | ETH | (åŸç”Ÿä»£å¸) | â­ |
| Ethereum | USDC | 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 | â­ |
| Ethereum | USDT | 0xdAC17F958D2ee523a2206206994597C13D831ec7 | |
| Polygon | MATIC | (åŸç”Ÿä»£å¸) | â­ |
| Polygon | USDC | 0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174 | â­ |
| Polygon | USDT | 0xc2132D05D31c914a87C6611C10748AEb04B58e8F | |
| Base | ETH | (åŸç”Ÿä»£å¸) | â­ |
| Base | USDC | 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913 | â­ |

#### å……å€¼é…ç½®

| å……å€¼é‡‘é¢ | æ¯”ä¾‹ | å¥–åŠ± |
|----------|------|------|
| $1-$9 | 1 USD = 100 PP | 0% |
| $10-$49 | 1 USD = 100 PP | +10% |
| $50-$99 | 1 USD = 100 PP | +20% |
| $100+ | 1 USD = 100 PP | +30% |

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1: åˆ·æ–°æµè§ˆå™¨é¡µé¢ (æ¨è)

1. åœ¨æµè§ˆå™¨ä¸­å®Œå…¨åˆ·æ–°é¡µé¢ (Cmd+Shift+R æˆ– Ctrl+Shift+R)
2. é‡æ–°ç‚¹å‡»å……å€¼æŒ‰é’®
3. è¾“å…¥å……å€¼é‡‘é¢ (ä¾‹å¦‚ $200)
4. ç‚¹å‡»"ä½¿ç”¨åŠ å¯†è´§å¸æ”¯ä»˜"
5. ç°åœ¨åº”è¯¥èƒ½çœ‹åˆ°é“¾å’Œä»£å¸é€‰æ‹©ç•Œé¢äº†

### æ–¹å¼ 2: é‡å¯ Next.js å¼€å‘æœåŠ¡å™¨

å¦‚æœåˆ·æ–°é¡µé¢åä»ç„¶å¡ä½,å¯ä»¥é‡å¯å‰ç«¯æœåŠ¡:

```bash
# åœæ­¢å½“å‰çš„ Next.js è¿›ç¨‹
pkill -f "next dev"

# é‡æ–°å¯åŠ¨
cd /Users/m1/PlayNew_0.3/frontend
npm run dev
```

ç­‰å¾…ç¼–è¯‘å®Œæˆå,å†æ¬¡å°è¯•å……å€¼æµç¨‹ã€‚

---

## ğŸ§ª æµ‹è¯•å……å€¼æµç¨‹

### å®Œæ•´æµ‹è¯•æ­¥éª¤

1. **ç™»å½•è´¦å·**
   - è®¿é—® http://localhost:3000
   - ç‚¹å‡»å³ä¸Šè§’"ç™»å½•"æŒ‰é’®
   - ä½¿ç”¨è´¦å·ç™»å½•

2. **æŸ¥çœ‹ä½™é¢**
   - ç™»å½•å,å¯¼èˆªæ åº”è¯¥æ˜¾ç¤º PlayPass ä½™é¢æŒ‰é’®
   - ç‚¹å‡»ä½™é¢æŒ‰é’®,æŸ¥çœ‹ä¸‹æ‹‰èœå•

3. **ç‚¹å‡»å……å€¼**
   - åœ¨ä½™é¢ä¸‹æ‹‰èœå•ä¸­ç‚¹å‡»"å……å€¼"æŒ‰é’®
   - å……å€¼å¯¹è¯æ¡†åº”è¯¥å¼¹å‡º

4. **é€‰æ‹©å……å€¼é‡‘é¢**
   - è¾“å…¥é‡‘é¢æˆ–ç‚¹å‡»å¿«æ·é‡‘é¢ ($10, $50, $100, $200)
   - æŸ¥çœ‹è®¡ç®—çš„ PP æ•°é‡å’Œå¥–åŠ±:
     - $10 â†’ 1,100 PP (åŸºç¡€ 1,000 + å¥–åŠ± 100)
     - $50 â†’ 6,000 PP (åŸºç¡€ 5,000 + å¥–åŠ± 1,000)
     - $100 â†’ 13,000 PP (åŸºç¡€ 10,000 + å¥–åŠ± 3,000)
     - $200 â†’ 26,000 PP (åŸºç¡€ 20,000 + å¥–åŠ± 6,000)

5. **é€‰æ‹© Web3 æ”¯ä»˜**
   - ç‚¹å‡»"ä½¿ç”¨åŠ å¯†è´§å¸æ”¯ä»˜"æŒ‰é’®
   - **é‡è¦**: å¯¹è¯æ¡†åº”è¯¥ä»"åŠ è½½æ”¯ä»˜ä¿¡æ¯..."å˜ä¸ºæ˜¾ç¤ºé“¾é€‰æ‹©

6. **é€‰æ‹©åŒºå—é“¾ç½‘ç»œ**
   - åº”è¯¥çœ‹åˆ° 3 ä¸ªé“¾é€‰é¡¹:
     - Ethereum (ä»¥å¤ªåŠä¸»ç½‘)
     - Polygon (Polygon ä¸»ç½‘)
     - Base (Base ä¸»ç½‘)

7. **é€‰æ‹©æ”¯ä»˜ä»£å¸**
   - é€‰æ‹©é“¾å,åº”è¯¥çœ‹åˆ°è¯¥é“¾ä¸Šæ”¯æŒçš„ä»£å¸
   - ä¾‹å¦‚é€‰æ‹© Polygon å,ä¼šçœ‹åˆ°:
     - â­ MATIC (åŸç”Ÿä»£å¸)
     - â­ USDC (ç¨³å®šå¸)
     - USDT (ç¨³å®šå¸)

8. **æŸ¥çœ‹æ”¯ä»˜é‡‘é¢**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—éœ€è¦æ”¯ä»˜çš„ä»£å¸æ•°é‡
   - ä¾‹å¦‚ $200 å……å€¼:
     - USDC: 200 USDC
     - MATIC: ~400 MATIC (å‡è®¾ MATIC ä»·æ ¼ $0.50)
     - ETH: ~0.0667 ETH (å‡è®¾ ETH ä»·æ ¼ $3000)

---

## âš ï¸ é‡è¦æç¤º

### 1. æ”¶æ¬¾é’±åŒ…åœ°å€

å½“å‰é…ç½®çš„é’±åŒ…åœ°å€æ˜¯ **ç¤ºä¾‹åœ°å€**:
```
0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
```

**åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰,è¯·åŠ¡å¿…åœ¨ Directus åå°ä¿®æ”¹ä¸ºæ‚¨çš„çœŸå®é’±åŒ…åœ°å€!**

ä¿®æ”¹æ–¹æ³•:
1. è®¿é—® http://localhost:8055
2. ç™»å½• Directus (the_uk1@outlook.com / Mygcdjmyxzg2026!)
3. è¿›å…¥ Content -> web3_system_config
4. ç¼–è¾‘æ¯æ¡é“¾é…ç½®
5. ä¿®æ”¹ `platform_wallet_address` å­—æ®µ

### 2. RPC èŠ‚ç‚¹é…ç½®

å½“å‰ä½¿ç”¨å…è´¹çš„å…¬å…± RPC èŠ‚ç‚¹,å¯èƒ½å­˜åœ¨:
- é€Ÿåº¦è¾ƒæ…¢
- è¯·æ±‚é™åˆ¶
- ç¨³å®šæ€§é—®é¢˜

**å»ºè®®ç”Ÿäº§ç¯å¢ƒé…ç½®å•†ä¸š RPC èŠ‚ç‚¹**:
- Alchemy: https://www.alchemy.com/
- Infura: https://www.infura.io/
- QuickNode: https://www.quicknode.com/

ä¿®æ”¹æ–¹æ³• (åœ¨ Directus åå°):
1. æ‰¾åˆ°å¯¹åº”é“¾çš„é…ç½®
2. ä¿®æ”¹ `rpc_url` å­—æ®µ
3. è®¾ç½® `rpc_provider` ä¸º 'alchemy', 'infura', æˆ– 'custom'
4. å¦‚æœéœ€è¦,å¡«å†™ `rpc_api_key`

### 3. ä»£å¸ä»·æ ¼

å½“å‰ä»£å¸ä»·æ ¼æ˜¯ **ç¡¬ç¼–ç ** çš„æµ‹è¯•ä»·æ ¼:
- ETH: $3,000
- MATIC: $0.50
- USDC/USDT: $1.00

**ç”Ÿäº§ç¯å¢ƒåº”é›†æˆå®æ—¶ä»·æ ¼ API**:
- CoinGecko API
- CoinMarketCap API
- Chainlink Price Feeds

ä¿®æ”¹ä½ç½®: `/Users/m1/PlayNew_0.3/frontend/lib/web3/config-helper.ts` ç¬¬ 309-324 è¡Œ

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: å¯¹è¯æ¡†ä»ç„¶å¡åœ¨"åŠ è½½æ”¯ä»˜ä¿¡æ¯..."

**å¯èƒ½åŸå› **:
- Next.js API è·¯ç”±é¦–æ¬¡ç¼–è¯‘è¾ƒæ…¢
- æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„ä»£ç 

**è§£å†³æ–¹æ³•**:
```bash
# 1. å®Œå…¨åˆ·æ–°æµè§ˆå™¨ (æ¸…é™¤ç¼“å­˜)
Cmd+Shift+R (Mac) æˆ– Ctrl+Shift+R (Windows)

# 2. é‡å¯ Next.js
pkill -f "next dev"
cd /Users/m1/PlayNew_0.3/frontend
npm run dev

# 3. ç­‰å¾…ç¼–è¯‘å®Œæˆ (çœ‹åˆ° "Ready" æç¤º)
# 4. é‡æ–°æµ‹è¯•
```

### é—®é¢˜ 2: æ— æ³•è¿æ¥é’±åŒ…

**å¯èƒ½åŸå› **:
- æœªå®‰è£… MetaMask æˆ–å…¶ä»–é’±åŒ…æ’ä»¶
- é’±åŒ…æœªè§£é”
- ç½‘ç»œä¸åŒ¹é…

**è§£å†³æ–¹æ³•**:
1. å®‰è£… MetaMask: https://metamask.io/
2. åˆ›å»ºæˆ–å¯¼å…¥é’±åŒ…
3. ç¡®ä¿é’±åŒ…å·²è§£é”
4. åˆ‡æ¢åˆ°æ­£ç¡®çš„ç½‘ç»œ (Ethereum/Polygon/Base)

### é—®é¢˜ 3: æ”¯ä»˜é‡‘é¢è®¡ç®—ä¸å‡†ç¡®

**å¯èƒ½åŸå› **:
- ä»£å¸ä»·æ ¼æœªå®æ—¶æ›´æ–° (ä½¿ç”¨çš„æ˜¯ç¡¬ç¼–ç ä»·æ ¼)

**ä¸´æ—¶è§£å†³æ–¹æ³•**:
- æ‰‹åŠ¨ä¿®æ”¹ `frontend/lib/web3/config-helper.ts` ä¸­çš„ä»·æ ¼
- æˆ–æ¥å—æµ‹è¯•ä»·æ ¼,ä»…ç”¨äºåŠŸèƒ½æµ‹è¯•

**é•¿æœŸè§£å†³æ–¹æ³•**:
- é›†æˆ CoinGecko ç­‰å®æ—¶ä»·æ ¼ API

### é—®é¢˜ 4: è¡¨ä¸å­˜åœ¨æˆ–æƒé™é”™è¯¯

**éªŒè¯é…ç½®**:
```bash
# è¿è¡ŒéªŒè¯è„šæœ¬
node test-web3-api-simple.js
```

åº”è¯¥çœ‹åˆ°:
- âœ… é“¾é…ç½®å¯è®¿é—®: 3 æ¡è®°å½•
- âœ… ä»£å¸é…ç½®å¯è®¿é—®: 8 æ¡è®°å½•
- âœ… å……å€¼é…ç½®å¯è®¿é—®: 5 æ¡è®°å½•

å¦‚æœä¸æ˜¯,é‡æ–°è¿è¡Œ:
```bash
node setup-web3-config-simple.js
node configure-web3-permissions-fixed.js
```

---

## ğŸ“‹ ç›¸å…³æ–‡ä»¶

### å·²åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

1. **æ•°æ®åº“è¡¨åˆ›å»º**
   - `setup-web3-config-simple.js` - åˆ›å»º Web3 é…ç½®è¡¨å¹¶æ’å…¥æ•°æ®

2. **æƒé™é…ç½®**
   - `configure-web3-permissions-fixed.js` - é…ç½® Directus å…¬å¼€è®¿é—®æƒé™

3. **æµ‹è¯•è„šæœ¬**
   - `test-web3-api-simple.js` - éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®

4. **SQL è„šæœ¬** (å¯é€‰,å·²è¢« JS è„šæœ¬æ›¿ä»£)
   - `sql/001_create_web3_config_in_directus.sql`
   - `sql/002_create_web3_payments_in_supabase.sql`

### å‰ç«¯ç»„ä»¶ (Phase 3)

1. **æ ¸å¿ƒç»„ä»¶**
   - `frontend/components/web3/Web3PaymentDialog.tsx` - Web3 æ”¯ä»˜å¯¹è¯æ¡†
   - `frontend/components/web3/RechargeDialog.tsx` - å……å€¼å¯¹è¯æ¡†
   - `frontend/components/web3/BalanceDisplay.tsx` - ä½™é¢æ˜¾ç¤ºç»„ä»¶
   - `frontend/components/web3/PaywallWrapper.tsx` - å†…å®¹ä»˜è´¹å¢™ç»„ä»¶

2. **é›†æˆä½ç½®**
   - `frontend/components/shared/Header.tsx` - å·²é›†æˆ BalanceDisplay

3. **API è·¯ç”±**
   - `frontend/app/api/web3/payment-info/route.ts` - è·å–æ”¯ä»˜ä¿¡æ¯
   - `frontend/app/api/web3/check-access/route.ts` - æ£€æŸ¥è®¿é—®æƒé™
   - `frontend/app/api/web3/verify-transaction/route.ts` - éªŒè¯äº¤æ˜“
   - `frontend/app/api/web3/recharge-credits/route.ts` - å……å€¼ç§¯åˆ†

4. **è¾…åŠ©åº“**
   - `frontend/lib/web3/config-helper.ts` - é…ç½®è¯»å–å’Œä»·æ ¼è®¡ç®—
   - `frontend/lib/web3/verify-helper.ts` - äº¤æ˜“éªŒè¯

### æ–‡æ¡£

1. **é›†æˆæŒ‡å—**
   - `WEB3-INTEGRATION-GUIDE.md` - è¯¦ç»†çš„é›†æˆæ­¥éª¤å’Œé…ç½®è¯´æ˜

2. **Phase 3 å®ŒæˆæŠ¥å‘Š**
   - `PHASE3-FRONTEND-COMPONENTS-COMPLETE.md` - ç»„ä»¶æ–‡æ¡£å’Œç”¨æˆ·æµç¨‹

3. **æµ‹è¯•æŠ¥å‘Š**
   - `PHASE3-INTEGRATION-TEST-RESULTS.md` - å¯¼èˆªæ é›†æˆæµ‹è¯•ç»“æœ

4. **æœ¬æ–‡æ¡£**
   - `WEB3-PAYMENT-FIX-SUMMARY.md` - å……å€¼åŠŸèƒ½ä¿®å¤æ€»ç»“

---

## âœ… éªŒè¯æ¸…å•

æµ‹è¯•å‰è¯·ç¡®è®¤:

- [ ] Directus æœåŠ¡è¿è¡Œä¸­ (http://localhost:8055)
- [ ] Next.js å‰ç«¯è¿è¡Œä¸­ (http://localhost:3000)
- [ ] Web3 é…ç½®è¡¨å·²åˆ›å»º (è¿è¡Œ `node test-web3-api-simple.js` éªŒè¯)
- [ ] æƒé™å·²é…ç½® (æ‰€æœ‰è¡¨å¯å…¬å¼€è®¿é—®)
- [ ] æµè§ˆå™¨å·²æ¸…é™¤ç¼“å­˜
- [ ] å·²ç™»å½•è´¦å·

æµ‹è¯•å®Œæˆååº”çœ‹åˆ°:

- [ ] å¯¼èˆªæ æ˜¾ç¤º PlayPass ä½™é¢æŒ‰é’®
- [ ] ç‚¹å‡»ä½™é¢æŒ‰é’®æ˜¾ç¤ºä¸‹æ‹‰èœå•
- [ ] å……å€¼å¯¹è¯æ¡†æ­£å¸¸æ‰“å¼€
- [ ] è¾“å…¥é‡‘é¢å PP è®¡ç®—æ­£ç¡®
- [ ] ç‚¹å‡»"ä½¿ç”¨åŠ å¯†è´§å¸æ”¯ä»˜"åæ˜¾ç¤ºé“¾é€‰æ‹©
- [ ] é€‰æ‹©é“¾åæ˜¾ç¤ºä»£å¸åˆ—è¡¨
- [ ] ä»£å¸ä»·æ ¼è®¡ç®—æ­£ç¡®

---

## ğŸ“ éœ€è¦å¸®åŠ©?

å¦‚æœé‡åˆ°é—®é¢˜:

1. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**
   - æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) -> Console
   - Next.js ç»ˆç«¯è¾“å‡º
   - Directus æ—¥å¿— (`docker-compose logs directus`)

2. **è¿è¡Œè¯Šæ–­è„šæœ¬**
   ```bash
   node test-web3-api-simple.js
   ```

3. **æ£€æŸ¥æ•°æ®åº“**
   - è®¿é—® http://localhost:8055
   - ç™»å½• Directus
   - æŸ¥çœ‹ Content -> web3_* è¡¨

4. **é‡å¯æ‰€æœ‰æœåŠ¡**
   ```bash
   # é‡å¯ Directus
   docker-compose restart directus

   # é‡å¯ Next.js
   pkill -f "next dev"
   cd frontend && npm run dev
   ```

---

**æœ€åæ›´æ–°**: 2025-11-22
**çŠ¶æ€**: âœ… å·²ä¿®å¤,ç­‰å¾…æµ‹è¯•éªŒè¯
