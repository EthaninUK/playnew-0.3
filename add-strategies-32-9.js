// ç­–ç•¥ 32.9: è¡ç”Ÿå“ç­–ç•¥ (Derivatives Strategies) - Gamma åšå¸‚å•† / æ³¢åŠ¨ç‡äº¤æ˜“

const axios = require('axios');

/**
 * 32.9 Gamma åšå¸‚å•†ç­–ç•¥
 *
 * ä¸€çº§åˆ†ç±»: è¡ç”Ÿå“ç­–ç•¥ (Derivatives Strategies)
 * category_l1: derivatives
 * category: options-selling
 * category_l2: options-selling
 *
 * æ ¸å¿ƒæ€æƒ³ï¼š
 * - ä»¥â€œGamma ä¸ºä¸»è§’â€çš„æœŸæƒåšå¸‚/ç›˜ä¸­å¯¹å†²ç­–ç•¥ï¼›
 * - é â€œæŒç»­ä¹°å…¥/å–å‡ºæ ‡çš„ + ç®¡ç†æœŸæƒåº“å­˜â€åœ¨éœ‡è¡ä¸­â€œé«˜å–ä½ä¹°â€ï¼›
 * - å¯¹æ³¢åŠ¨ç‡æœ‰ç³»ç»Ÿåˆ¤æ–­ï¼Œå¯¹ Delta / Gamma / Vega æœ‰æ˜ç¡®é£æ§ã€‚
 */
const STRATEGY_32_9 = {
  title: 'Gamma åšå¸‚å•†ç­–ç•¥ - åˆ©ç”¨ Gamma å¯¹å†²ä¸æ³¢åŠ¨ç‡è¯¯å·®çš„ä¸“ä¸šçº§æœŸæƒç©æ³•',
  slug: 'gamma-market-making-and-vol-trading',
  summary:
    'Gamma åšå¸‚å•†ç­–ç•¥ï¼Œæ˜¯ä»åšå¸‚å•†è§†è§’å‡ºå‘çš„æœŸæƒäº¤æ˜“æ–¹æ³•ï¼šé€šè¿‡æŒæœ‰ä¸€å®šæ–¹å‘çš„ Gammaï¼ˆé€šå¸¸æ˜¯ Long Gammaã€Short Vegaï¼‰å¹¶å¯¹æ ‡çš„è¿›è¡Œé¢‘ç¹ Delta å¯¹å†²ï¼Œåœ¨éœ‡è¡å¸‚ä¸­å®ç°â€œé«˜å–ä½ä¹°â€çš„ç³»ç»ŸåŒ–æ”¶ç›Šã€‚åŒæ—¶ç»“åˆå¯¹éšå«æ³¢åŠ¨ç‡ï¼ˆIVï¼‰çš„åˆ¤æ–­ï¼Œä½ä½ä¹°æ³¢åŠ¨ã€é«˜ä½å–æ³¢åŠ¨ï¼Œèµšå–æ³¢åŠ¨ç‡é£é™©æº¢ä»·ã€‚è¯¥ç­–ç•¥æ˜¯ä¸“ä¸šæœŸæƒåšå¸‚å•†çš„æ ¸å¿ƒæ­¦å™¨ä¹‹ä¸€ï¼Œå¯¹é£æ§ã€æ‰§è¡Œä¸åŸºç¡€è®¾æ–½è¦æ±‚æé«˜ï¼Œä¸é€‚åˆå®Œå…¨æ–°æ‰‹ã€‚',
  category: 'options-selling',
  category_l1: 'derivatives',
  category_l2: 'options-selling',
  risk_level: 5,
  apy_min: 15,
  apy_max: 120,
  min_investment: 10000,
  time_commitment:
    'éœ€è¦ä¸­é«˜é¢‘ç›‘æ§ï¼ˆåˆ†é’Ÿçº§ï¼‰ï¼Œé€‚åˆæœ‰è‡ªåŠ¨åŒ–äº¤æ˜“åŸºç¡€çš„ä¸­é«˜é˜¶ç©å®¶æˆ–å°å‹é‡åŒ–å›¢é˜Ÿ',
  status: 'published',
  content: `# 32.9 Gamma åšå¸‚å•†ç­–ç•¥ - åˆ©ç”¨ Gamma å¯¹å†²ä¸æ³¢åŠ¨ç‡è¯¯å·®çš„ä¸“ä¸šçº§æœŸæƒç©æ³•

> âš ï¸ é«˜çº§ç­–ç•¥è­¦å‘Š  
> - Gamma åšå¸‚æœ¬è´¨ä¸Šæ˜¯**æœŸæƒåšå¸‚ + æ³¢åŠ¨ç‡äº¤æ˜“**ï¼Œå¹¶ä¸æ˜¯ç®€å•â€œä¹°æœŸæƒ/å–æœŸæƒâ€ï¼›  
> - éœ€è¦ç†è§£ Delta/Gamma/Vega/Theta ç­‰å¸Œè…Šå­—æ¯çš„å«ä¹‰ä¸ç›¸äº’ä½œç”¨ï¼›  
> - å¼ºä¾èµ–è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿä¸ç¨³å®š APIï¼Œå¯¹æ‰‹åŠ¨ç©å®¶æä¸å‹å¥½ï¼›  
> - åœ¨æç«¯è¡Œæƒ…å’ŒæµåŠ¨æ€§å±æœºæ—¶ï¼Œè‹¥é£æ§ä¸ä¸¥ï¼Œå¯èƒ½å¿«é€Ÿå‡ºç°å¤§é¢äºæŸã€‚  

---

## ğŸ’° ç­–ç•¥æ¦‚è§ˆ

| ç»´åº¦              | å†…å®¹è¯´æ˜ |
|-------------------|----------|
| **æ ‡çš„**          | BTCã€ETH ç­‰æ‹¥æœ‰æˆç†ŸæœŸæƒå¸‚åœºä¸æœŸè´§å¸‚åœºçš„èµ„äº§ |
| **ç­–ç•¥è§’è‰²**      | ä¼ªåšå¸‚å•† / åŠä¸“ä¸šåšå¸‚å•†ï¼ˆä¸ä¸€å®šæ˜¯å®˜æ–¹ MMï¼Œä½†è¡Œä¸ºç±»ä¼¼ï¼‰ |
| **ä»“ä½ç»“æ„**      | æœŸæƒå¤šç©ºç»„åˆ + æ ‡çš„ç°è´§/æœŸè´§å¯¹å†²å¤´å¯¸ |
| **æ”¶ç›Šæ¥æº**      | Gamma Scalpingï¼ˆé«˜å–ä½ä¹°ï¼‰ã€IV è¯¯å·®äº¤æ˜“ï¼ˆä½ä¹°é«˜å–æ³¢åŠ¨ï¼‰ã€Bid-Ask Spread |
| **ä¸»è¦é£é™©**      | Gamma é£é™©ã€Vega é£é™©ã€å°¾éƒ¨è·³ç©ºã€æµåŠ¨æ€§ç¼ºå¤±ã€æŠ€æœ¯/ç³»ç»Ÿé£é™© |
| **é€‚ç”¨ç¯å¢ƒ**      | æ ‡çš„å…·æœ‰ä¸€å®šæ³¢åŠ¨ï¼ˆä½†éæç«¯ï¼‰ã€æœŸæƒå¸‚åœºæµåŠ¨æ€§å°šå¯ã€IV å­˜åœ¨é«˜ä½æ³¢åŠ¨å‘¨æœŸ |

---

## ğŸ“– åœºæ™¯æ•…äº‹ï¼šä»â€œæŠ¼æ–¹å‘â€åˆ°â€œåšæ³¢åŠ¨ä¸æµåŠ¨æ€§çš„ç”Ÿæ„â€

å¤§éƒ¨åˆ†æœŸæƒç©å®¶æœ€å¼€å§‹çš„æ€è·¯æ˜¯ï¼š

- â€œæˆ‘è§‰å¾— BTC ä¼šæ¶¨ â†’ ä¹° Callâ€  
- â€œæˆ‘è§‰å¾— BTC ä¼šè·Œ â†’ ä¹° Putâ€  
- â€œæˆ‘è§‰å¾—æ³¢åŠ¨ä¼šå˜å¤§/å˜å° â†’ ä¹°/å– Straddle / Strangleâ€

Gamma åšå¸‚å•†çš„è§†è§’å´å®Œå…¨ä¸åŒï¼š

> â€œæˆ‘ä¸æ‰§ç€äº BTC å…·ä½“è¦æ¶¨è¿˜æ˜¯è¦è·Œï¼Œ  
>  æˆ‘æ›´åœ¨æ„ï¼š  
>  - æ³¢åŠ¨ç‡æ˜¯ä¸æ˜¯è¢«é”™ä»·äº†ï¼Ÿ  
>  - å¸‚åœºç»™å‡ºçš„ Gamma ä»·æ ¼æ˜¯å¦åˆ’ç®—ï¼Ÿ  
>  - åœ¨è¿™ä¸ªæ³¢åŠ¨æ°´å¹³ä¸‹ï¼Œæˆ‘èƒ½å¦é€šè¿‡æ—¥å†…é«˜å–ä½ä¹°æ ‡çš„ï¼Œ  
>    æŠŠ Gamma å˜æˆç°é‡‘æµï¼Ÿâ€

æ¢å¥è¯è¯´ï¼š

1. åšå¸‚å•†é€šè¿‡åœ¨æœŸæƒä¸Šå»ºç«‹ä¸€ä¸ª**ç»“æ„åŒ–å¤´å¯¸**ï¼ˆé€šå¸¸æ˜¯ Long Gammaã€Short Vega æˆ–æ›´ä¸­æ€§ç»„åˆï¼‰ï¼›  
2. ç„¶åæ ¹æ®æ ‡çš„ä»·æ ¼çš„æ¯æ¬¡æ³¢åŠ¨ï¼Œ  
   - å½“ä»·æ ¼ä¸Šè¡Œæ—¶ï¼šå–å‡ºä¸€éƒ¨åˆ†æ ‡çš„ï¼ˆå¯¹å†² Deltaï¼‰ï¼›  
   - å½“ä»·æ ¼ä¸‹è¡Œæ—¶ï¼šä¹°å…¥ä¸€éƒ¨åˆ†æ ‡çš„ï¼›  
3. åœ¨éœ‡è¡è¿‡ç¨‹ä¸­ï¼Œè¿™ç§â€œé«˜å–ä½ä¹°â€çš„æ“ä½œä¼šä¸æ–­é”å®šå°é¢åˆ©æ¶¦ï¼›  
4. åŒæ—¶ï¼Œåšå¸‚å•†ä¼šå¯†åˆ‡å…³æ³¨ IVï¼š  
   - åœ¨ IV ç›¸å¯¹ä¾¿å®œæ—¶ï¼Œå¤šæŒ Gammaï¼ˆä¹°æœŸæƒæˆ–æ„å»º Long Gamma ç»“æ„ï¼‰ï¼›  
   - åœ¨ IV ç›¸å¯¹æ˜‚è´µæ—¶ï¼Œå‡å°‘æˆ–å¯¹å†² Gammaï¼Œç”šè‡³è½¬ä¸º Short Volã€‚  

> æ•´ä½“ç›®æ ‡ï¼š  
> - æŠŠâ€œä»·æ ¼åœ¨åŒºé—´å†…ä¹±æ™ƒâ€è½¬åŒ–ä¸ºç³»ç»ŸåŒ–ç°é‡‘æµï¼›  
> - æŠŠâ€œæ³¢åŠ¨ç‡é«˜ä½é”™ä»·â€è½¬åŒ–ä¸ºæ³¢åŠ¨ç‡ Alphaã€‚  

---

## ğŸ§  æ ¸å¿ƒæ¦‚å¿µï¼šGamma åšå¸‚ä¸ Gamma Scalping

### 1ï¸âƒ£ Long Gamma / Short Gamma çš„ç›´è§‰

- **Long Gammaï¼ˆé€šå¸¸å¯¹åº” Long Optionsï¼‰**  
  - ä»·æ ¼æ¶¨ï¼šDelta å˜å¤§ â†’ å˜å¾—æ›´å¤šå¤´ï¼›  
  - ä»·æ ¼è·Œï¼šDelta å˜å°ç”šè‡³è½¬ç©º â†’ å˜å¾—æ›´ç©ºå¤´ï¼›  
  - å³ï¼šä»·æ ¼è¶Šèµ°ï¼Œä½ çš„æ–¹å‘æš´éœ²è¶Šå¤§ï¼ˆé¡ºåŠ¿åŠ ä»“çš„å€¾å‘ï¼‰ã€‚  

- **Short Gammaï¼ˆé€šå¸¸å¯¹åº” Short Optionsï¼‰**  
  - ä»·æ ¼æ¶¨ï¼šDelta é€æ¸è½¬ç©ºï¼Œå®¹æ˜“è¢«é€¼ä»“ï¼›  
  - ä»·æ ¼è·Œï¼šDelta é€æ¸è½¬å¤šï¼ŒåŒæ ·å®¹æ˜“è¢«åå‘æ‰“è„¸ï¼›  
  - å³ï¼šä»·æ ¼è¶ŠåŠ¨ï¼Œä½ è¶Šå®¹æ˜“ç«™é”™é˜Ÿï¼Œéœ€è¦ä¸æ–­åŠ ä¿è¯é‡‘ã€‚  

Gamma åšå¸‚å•†é€šå¸¸å¸Œæœ›ï¼š

- åœ¨**æ³¢åŠ¨ç‡åˆç†æˆ–åä½**æ—¶ï¼ŒæŒæœ‰é€‚é‡ **Long Gamma**ï¼›  
- é€šè¿‡é¢‘ç¹å¯¹å†² Delta â†’ æŠŠ Gamma æ›éœ²è½¬åŒ–ä¸ºâ€œé«˜å–ä½ä¹°â€çš„äº¤æ˜“æ”¶ç›Šï¼›  
- åŒæ—¶é€šè¿‡è°ƒæ•´ Vega æš´éœ²ï¼ˆä¾‹å¦‚æ­é…å–å‡ºå…¶å®ƒæœŸæƒï¼‰æ§åˆ¶æ•´ä½“æ³¢åŠ¨ç‡é£é™©ã€‚

---

### 2ï¸âƒ£ Gamma Scalping çš„æ“ä½œé€»è¾‘ï¼ˆç®€åŒ–æè¿°ï¼‰

å‡è®¾ï¼š

- ä½ å»ºäº†ä¸€ä¸ª Long Gamma ç»„åˆï¼Œæ•´ä½“ Delta åˆå§‹ä¸º 0ï¼›  
- BTC å½“å‰ä»·æ ¼ä¸º 60,000 USDTï¼›  

å½“ä»·æ ¼å°å¹…æ³¢åŠ¨æ—¶ï¼š

1. BTC æ¶¨åˆ° 61,000ï¼š  
   - ä½ çš„ç»„åˆ Delta ä» 0 å˜æˆ +0.2ï¼ˆç¤ºæ„ï¼‰ï¼›  
   - ä½ ä¸ºäº†ç»´æŒ Delta ä¸­æ€§ï¼Œ**å–å‡º 0.2 BTC**ï¼ˆåšç©ºæ ‡çš„ï¼‰ï¼›  

2. BTC å›è½åˆ° 59,000ï¼š  
   - ä½ çš„ç»„åˆ Delta ä» 0 å˜æˆ -0.2ï¼›  
   - ä½ ä¸ºäº†ç»´æŒ Delta ä¸­æ€§ï¼Œ**ä¹°å…¥ 0.2 BTC**ï¼ˆå¹³ç©ºå¹¶åå‘åšå¤šï¼‰ï¼›  

å¦‚æœè¿™ç§ä¸Šä¸‹æ¥å›çš„éœ‡è¡åå¤å‘ç”Ÿï¼š

- ä½ æ¯æ¬¡éƒ½æ˜¯ï¼š  
  - ä¸Šæ¶¨æ—¶å–å‡º/ä¸‹è·Œæ—¶ä¹°å› â†’ é«˜å–ä½ä¹°ï¼›  
- è¿™äº›é¢‘ç¹çš„å°é¢è·åˆ©ï¼Œ  
  å°±æ˜¯ Gamma Scalping çš„**æ–¹å‘å¤–æ”¶ç›Š**ã€‚  

ä½ æœ€ç»ˆçš„ç›ˆäº =

> Gamma Scalping ç›ˆäº  
> + æœŸæƒ Thetaï¼ˆæ—¶é—´ä»·å€¼è¡°å‡ï¼‰  
> + Vega æš´éœ²å¸¦æ¥çš„ IV å˜åŒ–æ”¶ç›Šæˆ–æŸå¤±  

ç»„åˆçš„ç»†èŠ‚è®¾è®¡ï¼Œ  
å†³å®šäº†ä½ æ›´åƒâ€œä¹°æ³¢åŠ¨è¿˜æ˜¯å–æ³¢åŠ¨â€ã€‚

---

## ğŸ§© ç­–ç•¥ç»“æ„ï¼šä¸€ä¸ªæç®€ Gamma åšå¸‚æ¡†æ¶ï¼ˆæ¦‚å¿µå±‚é¢ï¼‰

> è¿™æ˜¯ä¸€ä¸ªâ€œæ•™å­¦ç‰ˆâ€æ¡†æ¶ï¼Œç°å®ä¸­ä¼šå¤æ‚å¾ˆå¤šã€‚  
> ä½†ä½ å¯ä»¥ç”¨å®ƒåšè®¤çŸ¥å’Œä»£ç æ¨¡æ¿çš„èµ·ç‚¹ã€‚

### ç›®æ ‡ï¼š

- ä»¥ BTC ä¸ºä¾‹ï¼Œæ„å»ºä¸€ä¸ª Long Gamma / Slight Short Vega çš„ç»„åˆï¼›  
- å¯¹ BTC æ°¸ç»­åˆçº¦è¿›è¡Œ Delta å¯¹å†²ï¼›  
- åœ¨ä»·æ ¼éœ‡è¡ä¸­ï¼Œé€šè¿‡è‡ªåŠ¨åŒ– Gamma Scalping è·å–é¢å¤–æ”¶ç›Šã€‚

### å…·ä½“æ¨¡å—ï¼š

1. **æœŸæƒç»„åˆæ„å»ºæ¨¡å—ï¼ˆOptions Portfolio Builderï¼‰**  
   - å†³å®šç”¨å“ªäº› Call/Putï¼ˆå“ªä¸€åˆ°æœŸæ—¥ã€å“ªä¸€æ‰§è¡Œä»·ï¼‰ï¼›  
   - å½¢æˆåˆå§‹ Long Gamma çš„ç»„åˆï¼ˆä¾‹å¦‚ä¹°è¿‘æœˆ ATM Straddleï¼Œæˆ–è€…æ›´å¤æ‚ç»“æ„ï¼‰ï¼›  

2. **å®æ—¶å¸Œè…Šå€¼è®¡ç®—æ¨¡å—ï¼ˆGreeks Engineï¼‰**  
   - å®æ—¶è®¡ç®—ï¼š  
     - ç»„åˆçš„ Deltaã€Gammaã€Vegaã€Thetaï¼›  
   - ä¸ºåç»­é£æ§å’Œå¯¹å†²æä¾›åŸºç¡€æ•°æ®ã€‚  

3. **Delta å¯¹å†²æ¨¡å—ï¼ˆDelta Hedging Engineï¼‰**  
   - è®¾ç½® Delta é˜ˆå€¼ï¼šä¾‹å¦‚å½“ |Delta| > 0.1 * Notional æ—¶æ‰§è¡Œå¯¹å†²ï¼›  
   - å¯¹å†²å·¥å…·ï¼šBTC æ°¸ç»­åˆçº¦ / ç°è´§ï¼›  
   - æ¯æ¬¡å¯¹å†²éƒ½è®°å½•æˆäº¤ä»·æ ¼ï¼Œä¸ºåç»­ç»©æ•ˆåˆ†æä½¿ç”¨ã€‚  

4. **é£é™©æ§åˆ¶æ¨¡å—ï¼ˆRisk Managerï¼‰**  
   - é™åˆ¶ï¼šæœ€å¤§ä»“ä½ã€æœ€å¤§ Vega æš´éœ²ã€æœ€å¤§æ—¥å†…äºæŸã€æœ€å¤§å›æ’¤ï¼›  
   - é‡åˆ°æç«¯æ³¢åŠ¨ã€æµåŠ¨æ€§å¡Œé™·æ—¶ï¼Œé€æ­¥å‡ä»“ç”šè‡³å¹³æ‰æœŸæƒç»„åˆã€‚  

5. **æ³¢åŠ¨ç‡è§†è§’æ¨¡å—ï¼ˆIV Regime Detectorï¼‰**  
   - æ ¹æ®å†å²/å®æ—¶æ•°æ®ï¼Œåˆ¤æ–­å½“å‰ IV æ˜¯â€œé«˜/ä¸­/ä½â€ï¼›  
   - å†³å®šå½“å‰æ˜¯å¦é€‚åˆæŒæœ‰å¤§é‡ Gammaï¼Œæˆ–åº”è¯¥å‡ä»“ã€‚  

---

## ğŸ› ï¸ ç®€æ˜“ Gamma åšå¸‚ç­–ç•¥æ¨¡å‹ï¼ˆä¼ªä»£ç çº§ç¤ºæ„ï¼‰

> ä¸‹é¢è¿™ä¸ªç±»æ˜¯â€œæ¦‚å¿µå‹ä¼ªä»£ç â€ï¼Œä½ å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•æˆçœŸå®ç­–ç•¥ã€‚  
> - ç”¨æç®€é€»è¾‘æ¨¡æ‹Ÿï¼š  
>   - Gamma å¯¼è‡´çš„ Delta å˜åŒ–  
>   - å¯¹å†²äº¤æ˜“  
>   - ä»¥åŠç®€å•çš„ Gamma Scalping ç»Ÿè®¡ã€‚  

\`\`\`javascript
class GammaMarketMakingToy {
  /**
   * @param {number} initialSpot        åˆå§‹æ ‡çš„ä»·æ ¼
   * @param {number} positionGamma      ç»„åˆæ€» Gammaï¼ˆç›¸å¯¹å•ä½ï¼Œç¤ºæ„å€¼ï¼‰
   * @param {number} positionDelta      åˆå§‹ Deltaï¼ˆé€šå¸¸æ¥è¿‘ 0ï¼‰
   * @param {number} notional           åä¹‰æœ¬é‡‘ï¼Œç”¨äºä¼°ç®—ç›ˆäºè§„æ¨¡
   * @param {number} hedgeThreshold     è§¦å‘å¯¹å†²çš„ Delta é˜ˆå€¼ï¼ˆç»å¯¹å€¼ï¼‰
   */
  constructor({
    initialSpot,
    positionGamma,
    positionDelta,
    notional,
    hedgeThreshold
  }) {
    this.spot = initialSpot;
    this.gamma = positionGamma;
    this.delta = positionDelta;
    this.notional = notional;
    this.hedgeThreshold = hedgeThreshold;

    this.hedgeTrades = []; // è®°å½•æ‰€æœ‰å¯¹å†²æ“ä½œ
    this.cumulativePnL = 0; // ç®€åŒ–çš„ Gamma Scalping ç´¯ç§¯æ”¶ç›Š
  }

  /**
   * æ¨¡æ‹Ÿä¸€æ¬¡ä»·æ ¼è·³åŠ¨ï¼ˆä¾‹å¦‚æ¥è‡ªè¡Œæƒ…æ¨é€ï¼‰
   * @param {number} newSpot æ–°çš„æ ‡çš„ä»·æ ¼
   */
  onPriceUpdate(newSpot) {
    const oldSpot = this.spot;
    const dS = newSpot - oldSpot;

    // 1. æ ¹æ® Gamma ä¼°ç®— Delta çš„å˜åŒ–ï¼ˆæç®€çº¿æ€§è¿‘ä¼¼ï¼‰
    const dDelta = this.gamma * dS;
    this.delta += dDelta;
    this.spot = newSpot;

    // 2. åˆ¤æ–­æ˜¯å¦éœ€è¦å¯¹å†²
    if (Math.abs(this.delta) >= this.hedgeThreshold) {
      // è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ°¸ç»­åˆçº¦å¯¹å†² Delta
      const hedgeSize = -this.delta; // ç›®æ ‡æ˜¯æŠŠ Delta æ‹‰å› 0
      // è®°å½•è¿™æ¬¡å¯¹å†²æ“ä½œï¼š
      this.hedgeTrades.push({
        hedgeSize,
        price: newSpot,
        timestamp: Date.now()
      });

      // 3. ç®€åŒ–ï¼šä»¥â€œå¹³ä»“æ—¶â€çš„ä»·å·®æ¥ä¼°ç®— Gamma Scalping æ”¶ç›Š
      //    å…·ä½“é€»è¾‘ä¼šè§†ä½ å¦‚ä½•å›æµ‹è€Œå®šï¼Œè¿™é‡Œåªåšç¤ºæ„ï¼š
      //    - è‹¥ä¹‹å‰æœ‰å¯¹å†²è®°å½•ï¼Œæˆ‘ä»¬å‡è®¾æœ€è¿‘çš„ä¸€æ¬¡åå‘å¯¹å†²å¸¦æ¥æ”¶ç›Šã€‚
      if (this.hedgeTrades.length >= 2) {
        const last = this.hedgeTrades[this.hedgeTrades.length - 2];
        const curr = this.hedgeTrades[this.hedgeTrades.length - 1];

        // è‹¥ä¸¤æ¬¡ hedge Size ç¬¦å·ç›¸åï¼Œåˆ™è§†ä¸ºâ€œé«˜å–ä½ä¹°â€æˆ–â€œä½ä¹°é«˜å–â€çš„ä¸€è½®
        if (last.hedgeSize * curr.hedgeSize < 0) {
          const roundTripSize = Math.min(
            Math.abs(last.hedgeSize),
            Math.abs(curr.hedgeSize)
          );
          // ç²—ç³™ä¼°ç®—ï¼šç”¨ä»·æ ¼å·® * äº¤æ˜“é‡
          const priceDiff = curr.price - last.price;
          const pnl = -priceDiff * roundTripSize; // æ–¹å‘æ ¹æ®ä¹°å–å…³ç³»ç•¥åšå¤„ç†

          this.cumulativePnL += pnl;
        }
      }

      // 4. å¯¹å†²å®Œæˆåï¼ŒæŠŠ Delta è®¾å› 0ï¼ˆç†æƒ³ä¸­æ€§ï¼‰
      this.delta = 0;
    }
  }

  /**
   * æ‰“å°å½“å‰ç®€åŒ–çŠ¶æ€
   */
  report() {
    console.log('ğŸ“Š Gamma åšå¸‚ç®€åŒ–æ¨¡å‹çŠ¶æ€:');
    console.log(\`- å½“å‰æ ‡çš„ä»·æ ¼: \${this.spot}\`);
    console.log(\`- å½“å‰ Delta: \${this.delta.toFixed(4)}\`);
    console.log(\`- ç»„åˆ Gamma(ç¤ºæ„): \${this.gamma}\`);
    console.log(
      \`- ç´¯è®¡ Gamma Scalping PnL(ç¤ºæ„): \${this.cumulativePnL.toFixed(2)}\`
    );
    console.log(\`- å¯¹å†²æ¬¡æ•°: \${this.hedgeTrades.length}\`);
  }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼ˆä¼ªæ•°æ®ï¼‰ï¼š
// const toy = new GammaMarketMakingToy({
//   initialSpot: 60000,
//   positionGamma: 0.0002, // çº¯ç¤ºæ„
//   positionDelta: 0,
//   notional: 100000,
//   hedgeThreshold: 0.2
// });
// [60500, 59500, 61000, 59000, 60200].forEach((p) => toy.onPriceUpdate(p));
// toy.report();
\`\`\`

> çœŸå®ç­–ç•¥ä¸­ï¼š  
> - Gamma ä¸æ˜¯å¸¸æ•°ï¼Œè€Œæ˜¯éšä»·æ ¼å’Œæ—¶é—´å˜åŒ–çš„å‡½æ•°ï¼›  
> - æœŸæƒæ—¶é—´ä»·å€¼ï¼ˆThetaï¼‰å’Œæ³¢åŠ¨ç‡å˜åŒ–ï¼ˆVegaï¼‰ä¼šæ˜¾è‘—å½±å“æ€» PnLï¼›  
> - ä¸Šé¢åªæ˜¯å¸®åŠ©ä½ æ„Ÿå—â€œä»·æ ¼ä¸Šä¸‹æ³¢åŠ¨ â†’ å¯¹å†² â†’ Gamma Scalpingâ€çš„ç²—ç•¥è¿‡ç¨‹ã€‚  

---

## ğŸ“Š Gamma åšå¸‚é£é™©é…ç½®ç¤ºä¾‹

\`\`\`javascript
const GAMMA_MM_RISK_CONFIG = {
  MAX_GAMMA_NOTIONAL: 500_000,   // Gamma å¯¹åº”çš„æœ€å¤§åä¹‰æ•å£
  MAX_VEGA_NOTIONAL: 300_000,    // Vega å¯¹åº”çš„æœ€å¤§åä¹‰æ•å£ï¼ˆé˜²æ­¢è¿‡åº¦æš´éœ²æ³¢åŠ¨ç‡ï¼‰
  MAX_DAILY_LOSS: 20_000,        // å•æ—¥æœ€å¤§å…è®¸äºæŸï¼Œè¶…å‡ºç«‹å³å‡ä»“/å¹³ä»“
  MAX_INTRADAY_DRAWDOWN: 10_000, // æ—¥å†…æœ€å¤§å›æ’¤ï¼Œè§¦å‘é£æ§ä¿æŠ¤
  DELTA_HEDGE_THRESHOLD: 0.1,    // Delta è¶…å‡ºå¤šå°‘æ¯”ä¾‹æ—¶ï¼Œè§¦å‘å¯¹å†²
  HEDGE_COOLDOWN_MS: 5000,       // å¯¹å†²ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼Œé˜²æ­¢è¿‡åº¦é¢‘ç¹ï¼Œåƒæ‰‹ç»­è´¹
  STOP_TRADING_ON_VOL_SPIKE: true, // IV ç¬é—´æš´æ¶¨æ—¶æš‚åœæ–°å»ºä»“ä½
  USE_MULTI_VENUE_LIQUIDITY: true  // ä¼˜å…ˆå¤šäº¤æ˜“æ‰€æŠ¥ä»·ï¼Œå‡å°‘æ»‘ç‚¹
};
\`\`\`

---

## ğŸ¯ å®æˆ˜ Checklistï¼ˆ32.9ï¼‰

### 1ï¸âƒ£ åŸºç¡€èƒ½åŠ›å‡†å¤‡

- [ ] ä½ å·²ç»ç†Ÿæ‚‰æœŸæƒå®šä»·çš„åŸºæœ¬é€»è¾‘ï¼ˆå“ªæ€•æ˜¯ Black-Scholes çš„ç›´è§‰ç‰ˆæœ¬ï¼‰ï¼›  
- [ ] ä½ ç†è§£ Delta/Gamma/Vega/Theta çš„å«ä¹‰ä¸å¤§è‡´å½±å“æ–¹å‘ï¼›  
- [ ] ä½ æœ‰è°ƒç”¨äº¤æ˜“æ‰€ APIã€å¤„ç†å®æ—¶è¡Œæƒ…ä¸æ’®åˆçš„åŸºç¡€èƒ½åŠ›ã€‚

### 2ï¸âƒ£ äº¤æ˜“ç¯å¢ƒä¸å·¥å…·

- [ ] é€‰æ‹©å…·å¤‡ï¼š  
  - ç¨³å®š APIï¼ˆWebSocket + RESTï¼‰  
  - æ·±åº¦å¤Ÿç”¨çš„æœŸæƒ/æœŸè´§å¸‚åœº  
  çš„å¹³å°ï¼ˆå¦‚ Deribit ç­‰ï¼‰ï¼›  
- [ ] éƒ¨ç½²ä¸€ä¸ªå¯ 7x24 è¿è¡Œçš„ç¯å¢ƒï¼š  
  - äº‘æœåŠ¡å™¨ / è‡ªæœ‰æœºæˆ¿  
  - å®Œæ•´çš„æ—¥å¿—ä¸ç›‘æ§ï¼›  
- [ ] å‡†å¤‡ï¼š  
  - å›æµ‹å¼•æ“ï¼ˆè‡³å°‘èƒ½åšåŸºç¡€å›æ”¾ä¸ç»Ÿè®¡ï¼‰  
  - å®ç›˜å¼•æ“ï¼ˆå¤„ç†è®¢å•ã€é£æ§ã€é‡å¯æ¢å¤ï¼‰ã€‚

### 3ï¸âƒ£ ç­–ç•¥å‚æ•°è®¾è®¡

- [ ] å†³å®š Gamma æ–¹å‘å€¾å‘ï¼š  
  - å Long Gammaï¼ˆæ›´å¤šä¾èµ– Gamma Scalpingï¼‰  
  - å Short Gammaï¼ˆæ›´åƒä¼ ç»Ÿåšå¸‚ï¼Œå¿…é¡»ä¸¥æ§é£é™©ï¼‰ï¼›  
- [ ] è®¾å®šï¼š  
  - æœ€å¤§å•åˆçº¦ä»“ä½  
  - æœ€å¤§ç»„åˆ Gamma/Vega  
  - Delta å¯¹å†²é˜ˆå€¼ä¸è§¦å‘é¢‘ç‡ï¼›  
- [ ] è®¾ç½®å…¨å±€ Kill-Switchï¼š  
  - å•æ—¥äºæŸ/å›æ’¤è¶…è¿‡æŸå€¼æ—¶å¹³æ‰æœŸæƒåº“å­˜å¹¶åœæ­¢ç­–ç•¥ã€‚  

### 4ï¸âƒ£ æ³¢åŠ¨ç‡è§†è§’å’Œä»“ä½èŠ‚å¥

- [ ] åœ¨ IV æé«˜ & æç«¯äº‹ä»¶å¯†é›†æ—¶ï¼š  
  - è°¨æ…åŠ ä»“ Long Gammaï¼Œé¿å…â€œä¾¿å®œä¹°åˆ°é£é™©â€ï¼›  
- [ ] åœ¨ IV æä½ä¸”å¸‚åœºæç«¯å¹³é™æ—¶ï¼š  
  - å°å¿ƒâ€œè¡¨é¢é£å¹³æµªé™ä¸‹çš„é»‘å¤©é¹…â€ï¼›  
- [ ] æ›´åçˆ±åœ¨ï¼š  
  - IV å±…ä¸­åé«˜ä½†éæç«¯ï¼›  
  - å¸‚åœºä»å•è¾¹è¶‹åŠ¿è½¬å‘éœ‡è¡é˜¶æ®µæ—¶ï¼Œ  
  å»éƒ¨ç½² Gamma åšå¸‚ä»“ä½ã€‚

### 5ï¸âƒ£ å¤ç›˜ä¸æŒ‡æ ‡ä½“ç³»

- [ ] é™¤äº†çº¯ PnLï¼Œä½ è¿˜åº”é‡ç‚¹å…³æ³¨ï¼š  
  - Gamma Scalping æ”¶ç›Šå æ¯”  
  - Delta å¯¹å†²æˆæœ¬ï¼ˆæ‰‹ç»­è´¹ + æ»‘ç‚¹ï¼‰  
  - Vega æ›éœ²å¸¦æ¥çš„é•¿æœŸæ³¢åŠ¨æ”¶ç›Š/æŸå¤±  
  - åœ¨æç«¯è¡Œæƒ…/é»‘å¤©é¹…æ—¶çš„ç­–ç•¥è¡¨ç°ï¼›  
- [ ] æ ¹æ®è¿™äº›æ•°æ®ä¸æ–­è°ƒæ•´ï¼š  
  - Hedge é˜ˆå€¼  
  - Gamma è§„æ¨¡  
  - æ³¢åŠ¨ç‡è§†è§’å‚æ•°ï¼ˆå¦‚ IV åˆ†ä½æ•°é˜ˆå€¼ï¼‰ã€‚

---

## âœ… å°ç»“ï¼šGamma åšå¸‚å•†ç­–ç•¥åœ¨ä½ çš„ç­–ç•¥åº“ä¸­çš„å®šä½

åœ¨ã€Œè¡ç”Ÿå“ç­–ç•¥ (Derivatives Strategies)ã€è¿™ä¸€å¤§ç±»ä¸­ï¼š

- 32.1 - 32.8 æ›´å¤šæ˜¯**ç»“æ„åŒ–æ–¹å‘/å–æ–¹/åŒºé—´ç­–ç•¥**ï¼›  
- 32.9 Gamma åšå¸‚å•†ç­–ç•¥ï¼Œåˆ™ä»£è¡¨äº†ä¸€ç§ï¼š  
  - æ›´æ¥è¿‘ä¸“ä¸šåšå¸‚æœºæ„çš„æ€è·¯ï¼›  
  - å°†â€œä»·æ ¼æ³¢åŠ¨ + æ³¢åŠ¨ç‡çš„é”™ä»·â€  
    ä½œä¸ºä¸»è¦è·åˆ©æ¥æºçš„é«˜çº§ç©æ³•ã€‚

ä½ å¯ä»¥æŠŠå®ƒæ ‡è®°ä¸ºï¼š

> ã€Œé«˜å¤æ‚åº¦ã€é«˜è¦æ±‚ã€é«˜æ½œåœ¨å›æŠ¥ï¼Œä¹Ÿæœ‰é«˜çˆ†ç‚¸é£é™©ã€  
> çš„**æ³¢åŠ¨ç‡åšå¸‚æ¨¡å—**ã€‚  

æ›´å®é™…çš„å»ºè®®æ˜¯ï¼š

- ä¸è¦ä¸€å¼€å§‹å°±â€œå…¨åŠŸèƒ½ä¸Šçº¿ Gamma åšå¸‚ç³»ç»Ÿâ€ï¼›  
- å¯ä»¥å…ˆï¼š  
  - ç”¨æç®€ Long Gamma + æ‰‹åŠ¨ï¼ˆæˆ–åŠè‡ªåŠ¨ï¼‰Delta å¯¹å†²åšå®éªŒï¼›  
  - å†é€æ­¥å¼•å…¥æ›´å¤æ‚çš„åº“å­˜ç®¡ç†ä¸è‡ªåŠ¨åŒ–é€»è¾‘ï¼›  
- æ¯ä¸€æ­¥éƒ½ä»¥**å¯æ§ä»“ä½ + å¯æ‰¿å—å›æ’¤**ä¸ºå‰æï¼Œ  
  è®©ç­–ç•¥ä»â€œç©å…·æ¨¡å‹â€è¿›åŒ–æˆâ€œæˆç†Ÿç”Ÿäº§æ¨¡å—â€ã€‚  

---

`
};

/**
 * ä¸Šä¼  32.9 Gamma åšå¸‚å•†ç­–ç•¥ åˆ° Directus
 */
async function uploadStrategies() {
  const DIRECTUS_URL = 'http://localhost:8055';

  console.log(
    'å¼€å§‹ä¸Šä¼ ç­–ç•¥ 32.9 (Gamma åšå¸‚å•†ç­–ç•¥ - Gamma Market Making & Vol Trading)...\\n'
  );

  try {
    const { execSync } = require('child_process');
    const tokenOutput = execSync('./get-new-directus-token.sh').toString();
    const tokenMatch = tokenOutput.match(/DIRECTUS_ADMIN_TOKEN=(.+)/);

    if (!tokenMatch) {
      throw new Error('Failed to get admin token');
    }

    const ADMIN_TOKEN = tokenMatch[1].trim();

    const headers = {
      Authorization: `Bearer ${ADMIN_TOKEN}`,
      'Content-Type': 'application/json'
    };

    console.log('ä¸Šä¼ ç­–ç•¥ 32.9: Gamma åšå¸‚å•†ç­–ç•¥...');
    await axios.post(`${DIRECTUS_URL}/items/strategies`, STRATEGY_32_9, {
      headers
    });
    console.log('âœ… ç­–ç•¥ 32.9 ä¸Šä¼ æˆåŠŸ\\n');

    const response = await axios.get(
      `${DIRECTUS_URL}/items/strategies?limit=1&meta=total_count`,
      { headers }
    );
    console.log(
      `âœ… æ•°æ®åº“ä¸­ç°æœ‰ç­–ç•¥æ€»æ•°: ${response.data.meta.total_count}`
    );
  } catch (error) {
    console.error('âŒ ä¸Šä¼ å¤±è´¥:', error.response?.data || error.message);
    process.exit(1);
  }
}

// è‹¥è¦åœ¨ Node ä¸­ç›´æ¥æ‰§è¡Œæœ¬æ–‡ä»¶å†™å…¥ç­–ç•¥ï¼Œè¯·å–æ¶ˆä¸‹é¢ä¸€è¡Œæ³¨é‡Šï¼š
uploadStrategies();
