{
  "name": "Telegram å…«å¦é‡‡é›†å™¨ - å®Œå…¨å…è´¹",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "channel_post",
          "message"
        ],
        "additionalFields": {}
      },
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [250, 300],
      "webhookId": "telegram-gossip-webhook",
      "credentials": {
        "telegramApi": {
          "id": "PLACEHOLDER",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// è§£æ Telegram æ¶ˆæ¯\nconst message = $input.first().json.message || $input.first().json.channel_post;\n\nif (!message || !message.text) {\n  return [];\n}\n\nconst text = message.text;\nconst chat = message.chat;\nconst from = message.from || {};\n\n// å…«å¦å…³é”®è¯æ£€æµ‹\nconst gossipKeywords = [\n  // ä¸­æ–‡\n  'ä¼ é—»', 'çˆ†æ–™', 'æ®æ‚‰', 'æ¶ˆæ¯', 'å†…å¹•',\n  'è·‘è·¯', 'å·æ¬¾', 'æš´é›·', 'å´©ç›˜',\n  'è¢«æ•', 'è°ƒæŸ¥', 'è¯‰è®¼',\n  'é»‘å®¢', 'æ”»å‡»', 'è¢«ç›—',\n  \n  // è‹±æ–‡\n  'rumor', 'scam', 'rug', 'hack', 'exploit',\n  'dump', 'crash', 'arrested'\n];\n\nconst hasKeyword = gossipKeywords.some(kw => \n  text.toLowerCase().includes(kw.toLowerCase())\n);\n\nif (!hasKeyword) {\n  return [];\n}\n\n// è®¡ç®—å¯ä¿¡åº¦\nlet credibility = 60; // Telegram åŸºç¡€å¯ä¿¡åº¦\n\n// é¢‘é“ç±»å‹åˆ¤æ–­\nconst isChannel = chat.type === 'channel';\nif (isChannel) credibility += 10; // é¢‘é“æ¯”ç¾¤ç»„å¯ä¿¡åº¦é«˜\n\n// æ¶ˆæ¯é•¿åº¦\nif (text.length > 500) credibility += 10;\nelse if (text.length < 50) credibility -= 10;\n\n// åŒ…å«é“¾æ¥\nif (message.entities?.some(e => e.type === 'url' || e.type === 'text_link')) {\n  credibility += 10;\n}\n\n// åŒ…å«å›¾ç‰‡\nif (message.photo || message.video) {\n  credibility += 5;\n}\n\n// é™åˆ¶èŒƒå›´\ncredibility = Math.max(30, Math.min(100, credibility));\n\nreturn [{\n  json: {\n    messageId: message.message_id,\n    text: text,\n    chatId: chat.id,\n    chatTitle: chat.title || chat.username || 'Private',\n    chatType: chat.type,\n    author: from.username || from.first_name || 'Anonymous',\n    authorId: from.id,\n    timestamp: new Date(message.date * 1000).toISOString(),\n    hasPhoto: !!message.photo,\n    hasVideo: !!message.video,\n    hasLinks: message.entities?.some(e => e.type === 'url' || e.type === 'text_link') || false,\n    credibilityScore: Math.floor(credibility),\n    forwardFrom: message.forward_from?.username || null,\n    replyTo: message.reply_to_message?.message_id || null\n  }\n}];"
      },
      "id": "parse-message",
      "name": "Parse & Filter Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.DIRECTUS_URL || 'http://host.docker.internal:8055' }}/items/news",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.DIRECTUS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"title\": \"{{ $json.text.substring(0, 100).replace(/\"/g, '\\\\\"') }}\",\n  \"summary\": \"{{ $json.text.substring(0, 200).replace(/\"/g, '\\\\\"') }}\",\n  \"content\": \"# Telegram å…«å¦\\n\\n**æ¥æº**: {{ $json.chatTitle }}\\n**ä½œè€…**: @{{ $json.author }}\\n**æ—¶é—´**: {{ $json.timestamp }}\\n{{ $json.hasPhoto ? '\\nğŸ“· åŒ…å«å›¾ç‰‡' : '' }}{{ $json.hasVideo ? '\\nğŸ¬ åŒ…å«è§†é¢‘' : '' }}{{ $json.hasLinks ? '\\nğŸ”— åŒ…å«é“¾æ¥' : '' }}\\n\\n## åŸæ–‡\\n\\n{{ $json.text.replace(/\\n/g, '\\\\n') }}\",\n  \"ai_summary\": \"{{ $json.text.substring(0, 150).replace(/\"/g, '\\\\\"') }}\",\n  \"source\": \"Telegram {{ $json.chatTitle }}\",\n  \"source_type\": \"telegram\",\n  \"url\": \"https://t.me/{{ $json.chatTitle }}/{{ $json.messageId }}\",\n  \"slug\": \"tg-{{ $json.chatId }}-{{ $json.messageId }}\",\n  \"news_type\": \"gossip\",\n  \"credibility_score\": {{ $json.credibilityScore }},\n  \"verification_status\": \"unverified\",\n  \"gossip_tags\": [\"Telegram\", \"{{ $json.chatTitle }}\", \"å®æ—¶çˆ†æ–™\"],\n  \"likes_count\": 0,\n  \"comments_count\": 0,\n  \"status\": \"{{ $json.credibilityScore >= 60 ? 'published' : 'draft' }}\",\n  \"category\": \"crypto-general\",\n  \"content_published_at\": \"{{ $json.timestamp }}\",\n  \"published_at\": \"{{ new Date().toISOString() }}\"\n}",
        "options": {}
      },
      "id": "publish-directus",
      "name": "Publish to Directus",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [650, 300],
      "continueOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\n\nif (item.id || item.data?.id) {\n  console.log(`âœ… å‘å¸ƒæˆåŠŸ: ${item.data?.title || item.title || 'æœªçŸ¥æ ‡é¢˜'}`);\n  return [{ json: { status: 'success', ...item } }];\n} else if (item.error?.message?.includes('duplicate')) {\n  console.log(`âš ï¸  é‡å¤æ¶ˆæ¯: ${item.error.message}`);\n  return [{ json: { status: 'duplicate', ...item } }];\n} else if (item.error) {\n  console.log(`âŒ å‘å¸ƒå¤±è´¥: ${item.error.message}`);\n  return [{ json: { status: 'failed', ...item } }];\n}\n\nreturn [{ json: { status: 'unknown', ...item } }];"
      },
      "id": "log-result",
      "name": "Log Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Parse & Filter Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse & Filter Message": {
      "main": [
        [
          {
            "node": "Publish to Directus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish to Directus": {
      "main": [
        [
          {
            "node": "Log Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-01-06T00:00:00.000Z",
  "versionId": "1"
}
