{
  "name": "Twitter Gossip Collector - å¸åœˆå…«å¦é‡‡é›†å™¨",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule Trigger - æ¯15åˆ†é’Ÿ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "search",
        "text": "={{ $json.searchQuery }}",
        "returnAll": false,
        "limit": 20,
        "additionalFields": {
          "includeEntities": true
        }
      },
      "id": "twitter-search",
      "name": "Twitter Search",
      "type": "n8n-nodes-base.twitter",
      "typeVersion": 2,
      "position": [650, 300],
      "credentials": {
        "twitterOAuth2Api": {
          "id": "1",
          "name": "Twitter OAuth2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å®šä¹‰è¦ç›‘æ§çš„KOLè´¦å·åˆ—è¡¨\nconst kols = [\n  // é¡¶çº§KOL\n  { username: 'VitalikButerin', name: 'Vitalik Buterin', weight: 100 },\n  { username: 'cz_binance', name: 'CZ', weight: 100 },\n  { username: 'elonmusk', name: 'Elon Musk', weight: 95 },\n  { username: 'APompliano', name: 'Anthony Pompliano', weight: 90 },\n  \n  // ä¸­æ–‡KOL\n  { username: 'WuBlockchain', name: 'å´è¯´', weight: 95 },\n  { username: 'cnLedger', name: 'Colin Wu', weight: 90 },\n  { username: 'mhballs', name: 'æ½˜å¿—å½ª', weight: 85 },\n  { username: 'bitquant', name: 'George Cao', weight: 80 },\n  \n  // é“¾ä¸Šä¾¦æ¢\n  { username: 'zachxbt', name: 'ZachXBT', weight: 95 },\n  { username: 'lookonchain', name: 'Lookonchain', weight: 90 },\n  { username: 'whale_alert', name: 'Whale Alert', weight: 85 },\n  { username: 'ArkhamIntel', name: 'Arkham', weight: 85 },\n  { username: 'peckshield', name: 'PeckShield', weight: 90 },\n  \n  // åª’ä½“è´¦å·\n  { username: 'Cointelegraph', name: 'Cointelegraph', weight: 80 },\n  { username: 'CoinDesk', name: 'CoinDesk', weight: 80 },\n  { username: 'TheBlock__', name: 'The Block', weight: 80 },\n  { username: '8btc_official', name: '8BTC', weight: 75 },\n  \n  // å…¶ä»–é‡è¦KOL\n  { username: 'haydenzadams', name: 'Hayden Adams', weight: 85 },\n  { username: 'stani', name: 'Stani Kulechov', weight: 85 },\n  { username: 'MessariCrypto', name: 'Messari', weight: 80 },\n  { username: 'thedefiedge', name: 'The DeFi Edge', weight: 75 },\n  { username: 'cobie', name: 'Cobie', weight: 85 },\n  { username: 'HsakaTrades', name: 'Hsaka', weight: 80 },\n];\n\n// å…«å¦å…³é”®è¯\nconst gossipKeywords = [\n  // ä¸­æ–‡\n  'ä¼ é—»', 'çˆ†æ–™', 'æ®æ‚‰', 'æ¶ˆæ¯äººå£«', 'å†…å¹•', 'ç‹¬å®¶',\n  'è·‘è·¯', 'å·æ¬¾', 'å´©ç›˜', 'ç¦»èŒ', 'å†…è®§', 'è§£æ•£',\n  'è¢«æ•', 'è°ƒæŸ¥', 'è¯‰è®¼', 'æ¸…ä»“', 'æŠ›å”®', 'é€ å‡',\n  \n  // è‹±æ–‡\n  'rumor', 'allegedly', 'sources say', 'insider', 'exclusive',\n  'exit scam', 'rug pull', 'collapse', 'resign', 'fired',\n  'arrested', 'investigation', 'lawsuit', 'dump', 'fake'\n];\n\n// ä¸ºæ¯ä¸ªKOLåˆ›å»ºæœç´¢æŸ¥è¯¢\nconst searchQueries = kols.map(kol => {\n  // æ„å»ºæœç´¢æŸ¥è¯¢: æ¥è‡ªè¯¥ç”¨æˆ· + åŒ…å«å…³é”®è¯\n  const keywordQuery = gossipKeywords.slice(0, 10).join(' OR ');\n  return {\n    kolUsername: kol.username,\n    kolName: kol.name,\n    kolWeight: kol.weight,\n    searchQuery: `from:${kol.username} (${keywordQuery})`,\n    // Twitter API é™åˆ¶\n    timestamp: new Date().toISOString()\n  };\n});\n\nreturn searchQueries.map(query => ({ json: query }));"
      },
      "id": "generate-kol-queries",
      "name": "Generate KOL Queries",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "// è¿‡æ»¤å’Œè¯„åˆ†æ¨æ–‡\nconst items = $input.all();\nconst results = [];\n\n// å…«å¦å…³é”®è¯(ç”¨äºäºŒæ¬¡éªŒè¯)\nconst gossipKeywords = [\n  'ä¼ é—»', 'çˆ†æ–™', 'æ®æ‚‰', 'è·‘è·¯', 'å·æ¬¾', 'ç¦»èŒ', 'å†…è®§',\n  'rumor', 'allegedly', 'scam', 'rug', 'exit', 'dump', 'arrested'\n];\n\nfor (const item of items) {\n  const tweet = item.json;\n  const text = tweet.text || '';\n  \n  // 1. æ£€æŸ¥æ˜¯å¦åŒ…å«å…³é”®è¯\n  const hasKeyword = gossipKeywords.some(keyword => \n    text.toLowerCase().includes(keyword.toLowerCase())\n  );\n  \n  if (!hasKeyword) continue;\n  \n  // 2. è®¡ç®—äº’åŠ¨é‡\n  const engagement = \n    (tweet.public_metrics?.like_count || 0) + \n    (tweet.public_metrics?.retweet_count || 0) + \n    (tweet.public_metrics?.reply_count || 0);\n  \n  // 3. è¿‡æ»¤ä½äº’åŠ¨æ¨æ–‡\n  if (engagement < 50) continue;\n  \n  // 4. åˆæ­¥å¯ä¿¡åº¦è¯„åˆ†(åŸºäºè§„åˆ™)\n  let credibility = 50; // åŸºç¡€åˆ†\n  \n  // æ¥æºæƒé‡åŠ æˆ\n  const kolWeight = tweet.kolWeight || 80;\n  credibility += (kolWeight - 80) * 0.2;\n  \n  // äº’åŠ¨é‡åŠ æˆ\n  if (engagement > 500) credibility += 10;\n  else if (engagement > 200) credibility += 5;\n  \n  // åŒ…å«\"æ®æ‚‰\"ã€\"æ¶ˆæ¯äººå£«\"ç­‰è¯æ±‡é™ä½å¯ä¿¡åº¦\n  if (text.includes('æ®æ‚‰') || text.includes('allegedly') || text.includes('rumor')) {\n    credibility -= 10;\n  }\n  \n  // åŒ…å«é“¾æ¥(è¯æ®)å¢åŠ å¯ä¿¡åº¦\n  if (tweet.entities?.urls?.length > 0) {\n    credibility += 10;\n  }\n  \n  // é™åˆ¶åœ¨0-100\n  credibility = Math.max(0, Math.min(100, credibility));\n  \n  // 5. æ„å»ºè¾“å‡º\n  results.push({\n    json: {\n      tweetId: tweet.id,\n      author: tweet.author_username || tweet.kolUsername,\n      authorName: tweet.kolName || tweet.author_name,\n      text: text,\n      url: `https://twitter.com/${tweet.author_username}/status/${tweet.id}`,\n      createdAt: tweet.created_at,\n      engagement: engagement,\n      likes: tweet.public_metrics?.like_count || 0,\n      retweets: tweet.public_metrics?.retweet_count || 0,\n      replies: tweet.public_metrics?.reply_count || 0,\n      credibilityScore: Math.floor(credibility),\n      kolWeight: kolWeight,\n      needsAIAnalysis: credibility < 70, // ä½äº70åˆ†éœ€è¦AIåˆ†æ\n    }\n  });\n}\n\n// æŒ‰äº’åŠ¨é‡æ’åº\nresults.sort((a, b) => b.json.engagement - a.json.engagement);\n\nreturn results;"
      },
      "id": "filter-and-score",
      "name": "Filter & Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needsAIAnalysis }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-needs-ai",
      "name": "Needs AI Analysis?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "messages": {
          "values": [
            {
              "content": "=ä½ æ˜¯åŠ å¯†è´§å¸è¡Œä¸šçš„ä¸“ä¸šåˆ†æå¸ˆã€‚è¯·åˆ†æä»¥ä¸‹Twitterå…«å¦:\n\nä½œè€…: {{ $json.authorName }} (@{{ $json.author }})\näº’åŠ¨é‡: {{ $json.engagement }}\nå†…å®¹: {{ $json.text }}\n\nè¯·ä»¥JSONæ ¼å¼è¿”å›:\n{\n  \"credibility\": 0-100çš„æ•´æ•°,\n  \"summary\": \"ä¸­æ–‡æ€»ç»“(50å­—å†…)\",\n  \"category\": \"é¡¹ç›®ä¼ é—»/KOLåŠ¨æ€/äº¤æ˜“æ‰€å…«å¦/å›¢é˜Ÿå†…å¹•/èèµ„æ¶ˆæ¯/æŠ€æœ¯äº‰è®®\",\n  \"tags\": [\"æ ‡ç­¾1\", \"æ ‡ç­¾2\", \"æ ‡ç­¾3\"],\n  \"verificationStatus\": \"unverified/verifying/confirmed/debunked\",\n  \"reasoning\": \"è¯„åˆ†ç†ç”±ç®€è¿°\"\n}\n\nè¯„åˆ†æ ‡å‡†:\n90-100: æœ‰æ˜ç¡®è¯æ®\n70-89: å¯ä¿¡æ¥æº\n50-69: å•ä¸€æ¥æº\n30-49: è¯æ®ä¸è¶³\n0-29: æ˜æ˜¾è°£è¨€"
            }
          ]
        },
        "options": {
          "temperature": 0.3
        },
        "responseFormat": "json"
      },
      "id": "openai-analysis",
      "name": "OpenAI Analysis",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [1250, 200],
      "credentials": {
        "openAiApi": {
          "id": "1",
          "name": "OpenAI"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// åˆå¹¶AIåˆ†æç»“æœ\nconst tweet = $('Check-Needs-AI').item.json;\nconst aiResponse = $json.message?.content || '{}';\n\nlet aiAnalysis;\ntry {\n  aiAnalysis = JSON.parse(aiResponse);\n} catch (e) {\n  aiAnalysis = {\n    credibility: tweet.credibilityScore,\n    summary: tweet.text.substring(0, 100),\n    category: 'æœªåˆ†ç±»',\n    tags: ['å¾…å®¡æ ¸'],\n    verificationStatus: 'unverified',\n    reasoning: 'AIåˆ†æå¤±è´¥'\n  };\n}\n\nreturn {\n  json: {\n    ...tweet,\n    credibilityScore: aiAnalysis.credibility,\n    aiSummary: aiAnalysis.summary,\n    category: aiAnalysis.category,\n    tags: aiAnalysis.tags,\n    verificationStatus: aiAnalysis.verificationStatus,\n    aiReasoning: aiAnalysis.reasoning,\n  }\n};"
      },
      "id": "merge-ai-results",
      "name": "Merge AI Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1450, 200]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll"
      },
      "id": "merge-branches",
      "name": "Merge Branches",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [1450, 400]
    },
    {
      "parameters": {
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "method": "POST",
        "url": "={{ $env.DIRECTUS_URL }}/items/news",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.DIRECTUS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $json.aiSummary || $json.text.substring(0, 100) }}"
            },
            {
              "name": "summary",
              "value": "={{ $json.aiSummary || $json.text.substring(0, 200) }}"
            },
            {
              "name": "content",
              "value": "=# Twitterçˆ†æ–™\\n\\n**æ¥æº**: [@{{ $json.author }}]({{ $json.url }})\\n**ä½œè€…**: {{ $json.authorName }}\\n**æ—¶é—´**: {{ $json.createdAt }}\\n**çƒ­åº¦**: {{ $json.engagement }} äº’åŠ¨ (ğŸ‘{{ $json.likes }} | ğŸ”{{ $json.retweets }} | ğŸ’¬{{ $json.replies }})\\n\\n## åŸæ–‡\\n\\n{{ $json.text }}\\n\\n## AIåˆ†æ\\n\\n{{ $json.aiReasoning || 'å¾…äººå·¥å®¡æ ¸' }}"
            },
            {
              "name": "ai_summary",
              "value": "={{ $json.aiSummary }}"
            },
            {
              "name": "source",
              "value": "=Twitter @{{ $json.author }}"
            },
            {
              "name": "source_type",
              "value": "twitter"
            },
            {
              "name": "url",
              "value": "={{ $json.url }}"
            },
            {
              "name": "slug",
              "value": "=twitter-{{ $json.tweetId }}"
            },
            {
              "name": "news_type",
              "value": "gossip"
            },
            {
              "name": "credibility_score",
              "value": "={{ $json.credibilityScore }}"
            },
            {
              "name": "verification_status",
              "value": "={{ $json.verificationStatus || 'unverified' }}"
            },
            {
              "name": "gossip_tags",
              "value": "={{ JSON.stringify($json.tags || [$json.category || 'æœªåˆ†ç±»']) }}"
            },
            {
              "name": "likes_count",
              "value": "={{ Math.floor($json.engagement * 0.3) }}"
            },
            {
              "name": "comments_count",
              "value": "=0"
            },
            {
              "name": "status",
              "value": "={{ $json.credibilityScore >= 60 ? 'published' : 'draft' }}"
            },
            {
              "name": "category",
              "value": "crypto-general"
            },
            {
              "name": "content_published_at",
              "value": "={{ $json.createdAt }}"
            },
            {
              "name": "published_at",
              "value": "={{ $now.toISO() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "publish-to-directus",
      "name": "Publish to Directus",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1650, 400],
      "onError": "continueRegularOutput",
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// ç»Ÿè®¡ç»“æœ\nconst items = $input.all();\n\nconst summary = {\n  total: items.length,\n  published: items.filter(i => i.json.status === 'published').length,\n  draft: items.filter(i => i.json.status === 'draft').length,\n  highCredibility: items.filter(i => i.json.credibilityScore >= 80).length,\n  mediumCredibility: items.filter(i => i.json.credibilityScore >= 60 && i.json.credibilityScore < 80).length,\n  lowCredibility: items.filter(i => i.json.credibilityScore < 60).length,\n  timestamp: new Date().toISOString()\n};\n\nconsole.log('ğŸ“Š é‡‡é›†ç»Ÿè®¡:');\nconsole.log(`   æ€»è®¡: ${summary.total} æ¡`);\nconsole.log(`   å·²å‘å¸ƒ: ${summary.published} æ¡`);\nconsole.log(`   è‰ç¨¿: ${summary.draft} æ¡`);\nconsole.log(`   é«˜å¯ä¿¡åº¦(80+): ${summary.highCredibility} æ¡`);\nconsole.log(`   ä¸­å¯ä¿¡åº¦(60-79): ${summary.mediumCredibility} æ¡`);\nconsole.log(`   ä½å¯ä¿¡åº¦(<60): ${summary.lowCredibility} æ¡`);\n\nreturn [{ json: summary }];"
      },
      "id": "summary-stats",
      "name": "Summary Stats",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1850, 400]
    }
  ],
  "connections": {
    "Schedule Trigger - æ¯15åˆ†é’Ÿ": {
      "main": [
        [
          {
            "node": "Generate KOL Queries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate KOL Queries": {
      "main": [
        [
          {
            "node": "Twitter Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Twitter Search": {
      "main": [
        [
          {
            "node": "Filter & Score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Score": {
      "main": [
        [
          {
            "node": "Needs AI Analysis?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Needs AI Analysis?": {
      "main": [
        [
          {
            "node": "OpenAI Analysis",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge Branches",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Analysis": {
      "main": [
        [
          {
            "node": "Merge AI Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge AI Results": {
      "main": [
        [
          {
            "node": "Merge Branches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Branches": {
      "main": [
        [
          {
            "node": "Publish to Directus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish to Directus": {
      "main": [
        [
          {
            "node": "Summary Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-11-06T00:00:00.000Z",
  "versionId": "1"
}
