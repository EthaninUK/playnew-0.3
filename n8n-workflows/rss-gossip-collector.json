{
  "name": "RSS ÂÖ´Âç¶ÈááÈõÜÂô® - ÂÆåÂÖ®ÂÖçË¥π",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 30
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule Trigger - ÊØè30ÂàÜÈíü",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "// ÂÆö‰πâRSSÊ∫êÂàóË°®\nconst rssSources = [\n  // ‰∏≠ÊñáÂ™í‰Ωì\n  { name: 'Âê¥ËØ¥Âå∫ÂùóÈìæ', url: 'https://www.wublock.com/feed', weight: 95, lang: 'zh' },\n  { name: 'ÂæãÂä®BlockBeats', url: 'https://www.theblockbeats.info/rss', weight: 90, lang: 'zh' },\n  { name: 'PANews', url: 'https://www.panewslab.com/rss.xml', weight: 90, lang: 'zh' },\n  { name: '8BTC', url: 'https://news.8btc.com/rss', weight: 85, lang: 'zh' },\n  { name: 'ÈáëËâ≤Ë¥¢Áªè', url: 'https://www.jinse.com/rss', weight: 80, lang: 'zh' },\n  \n  // Ëã±ÊñáÂ™í‰Ωì\n  { name: 'Cointelegraph', url: 'https://cointelegraph.com/rss', weight: 85, lang: 'en' },\n  { name: 'CoinDesk', url: 'https://www.coindesk.com/arc/outboundfeeds/rss/', weight: 85, lang: 'en' },\n  { name: 'The Block', url: 'https://www.theblock.co/rss.xml', weight: 90, lang: 'en' },\n  { name: 'Decrypt', url: 'https://decrypt.co/feed', weight: 80, lang: 'en' },\n  { name: 'CryptoSlate', url: 'https://cryptoslate.com/feed/', weight: 75, lang: 'en' },\n];\n\nreturn rssSources.map(source => ({\n  json: source\n}));"
      },
      "id": "generate-rss-sources",
      "name": "Generate RSS Sources",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "id": "rss-read",
      "name": "RSS Read Feed",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "jsCode": "// ËøáÊª§ÂíåËØÑÂàÜÊñ∞Èóª\nconst items = $input.all();\nconst results = [];\n\n// ÂÖ´Âç¶ÂÖ≥ÈîÆËØçÂ∫ì\nconst gossipKeywords = {\n  // Âº∫ÂÖ´Âç¶ËØçÔºàÊùÉÈáçÈ´òÔºâ\n  strong: [\n    // ‰∏≠Êñá\n    '‰º†Èóª', 'ÁàÜÊñô', 'ÊçÆÊÇâ', 'Ê∂àÊÅØ‰∫∫Â£´', 'ÂÜÖÂπï', 'Áã¨ÂÆ∂',\n    'Ë∑ëË∑Ø', 'Âç∑Ê¨æ', 'Êö¥Èõ∑', 'Â¥©Áõò', 'Ê∏Ö‰ªì', 'ÊäõÂîÆ',\n    'Ë¢´Êçï', 'Ë∞ÉÊü•', 'ËØâËÆº', 'Ëµ∑ËØâ', 'ÁΩöÊ¨æ',\n    'Á¶ªËÅå', 'ËæûËÅå', 'ÂÜÖËÆß', 'ÂàÜË£Ç', 'Ëß£Êï£',\n    'ÈªëÂÆ¢', 'ÊîªÂáª', 'Ë¢´Áõó', 'ÊºèÊ¥û',\n    \n    // Ëã±Êñá\n    'rumor', 'allegedly', 'sources', 'insider', 'exclusive',\n    'exit scam', 'rug pull', 'collapse', 'crash', 'dump',\n    'arrested', 'investigation', 'lawsuit', 'sued', 'fine',\n    'resign', 'fired', 'dispute', 'split', 'shutdown',\n    'hack', 'exploit', 'breach', 'vulnerability'\n  ],\n  \n  // Âº±ÂÖ´Âç¶ËØçÔºàÊùÉÈáç‰ΩéÔºâ\n  weak: [\n    '‰∫âËÆÆ', 'Ë¥®Áñë', 'ÊâπËØÑ', 'ÂèçÂØπ', 'ÊãÖÂøß',\n    'controversy', 'criticism', 'concern', 'doubt'\n  ]\n};\n\nfor (const item of items) {\n  const entry = item.json;\n  const title = entry.title || '';\n  const description = entry.contentSnippet || entry.description || '';\n  const content = entry.content || '';\n  const fullText = `${title} ${description} ${content}`.toLowerCase();\n  \n  // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´ÂÖ´Âç¶ÂÖ≥ÈîÆËØç\n  const strongMatches = gossipKeywords.strong.filter(kw => \n    fullText.includes(kw.toLowerCase())\n  );\n  const weakMatches = gossipKeywords.weak.filter(kw => \n    fullText.includes(kw.toLowerCase())\n  );\n  \n  // Â¶ÇÊûúÊ≤°Êúâ‰ªª‰ΩïÂÖ´Âç¶ÂÖ≥ÈîÆËØçÔºåË∑≥Ëøá\n  if (strongMatches.length === 0 && weakMatches.length === 0) continue;\n  \n  // ËÆ°ÁÆóÂèØ‰ø°Â∫¶ËØÑÂàÜ\n  let credibility = 50; // Âü∫Á°ÄÂàÜ\n  \n  // Êù•Ê∫êÊùÉÈáçÂä†Êàê\n  const sourceWeight = entry.sourceWeight || 80;\n  credibility += (sourceWeight - 80) * 0.3;\n  \n  // Âº∫ÂÖ´Âç¶ËØçÈôç‰ΩéÂèØ‰ø°Â∫¶ÔºàÂõ†‰∏∫ÊòØ‰º†ÈóªÔºâ\n  credibility -= strongMatches.length * 5;\n  \n  // Âº±ÂÖ´Âç¶ËØçÂΩ±ÂìçËæÉÂ∞è\n  credibility -= weakMatches.length * 2;\n  \n  // Êúâ‰ΩúËÄÖ‰ø°ÊÅØÂ¢ûÂä†ÂèØ‰ø°Â∫¶\n  if (entry.creator || entry.author) credibility += 5;\n  \n  // ÊúâÂèëÂ∏ÉÊó∂Èó¥Â¢ûÂä†ÂèØ‰ø°Â∫¶\n  if (entry.pubDate || entry.isoDate) credibility += 5;\n  \n  // ÂÜÖÂÆπËæÉÈïøÔºàÊúâËØ¶ÁªÜÊèèËø∞ÔºâÂ¢ûÂä†ÂèØ‰ø°Â∫¶\n  if (content.length > 500) credibility += 10;\n  else if (content.length > 200) credibility += 5;\n  \n  // ÈôêÂà∂Âú®0-100\n  credibility = Math.max(30, Math.min(100, credibility));\n  \n  // Âà§Êñ≠Á±ªÂà´\n  let category = 'Êú™ÂàÜÁ±ª';\n  if (fullText.match(/(È°πÁõÆ|project|protocol|token)/i)) category = 'È°πÁõÆ‰º†Èóª';\n  else if (fullText.match(/(‰∫§ÊòìÊâÄ|exchange|binance|coinbase)/i)) category = '‰∫§ÊòìÊâÄÂÖ´Âç¶';\n  else if (fullText.match(/(ËûçËµÑ|investment|funding|raise)/i)) category = 'ËûçËµÑÊ∂àÊÅØ';\n  else if (fullText.match(/(ÈªëÂÆ¢|hack|exploit|breach)/i)) category = 'ÂÆâÂÖ®‰∫ã‰ª∂';\n  else if (fullText.match(/(ÁõëÁÆ°|regulation|sec|cftc)/i)) category = 'ÁõëÁÆ°Âä®ÊÄÅ';\n  \n  // ÊèêÂèñÊ†áÁ≠æ\n  const tags = ['RSSÈááÈõÜ', entry.sourceName || 'Êú™Áü•Êù•Ê∫ê'];\n  if (strongMatches.length > 0) tags.push(strongMatches[0]);\n  if (category !== 'Êú™ÂàÜÁ±ª') tags.push(category);\n  \n  results.push({\n    json: {\n      title: title.substring(0, 200),\n      summary: description.substring(0, 300),\n      content: content || description,\n      url: entry.link || entry.url || '',\n      source: entry.sourceName || 'RSS',\n      sourceLang: entry.sourceLang || 'zh',\n      author: entry.creator || entry.author || entry.sourceName,\n      publishedAt: entry.isoDate || entry.pubDate || new Date().toISOString(),\n      credibilityScore: Math.floor(credibility),\n      category: category,\n      tags: tags,\n      gossipKeywords: [...strongMatches, ...weakMatches].slice(0, 5),\n      matchStrength: strongMatches.length > 0 ? 'strong' : 'weak'\n    }\n  });\n}\n\n// ÊåâÂèØ‰ø°Â∫¶ÊéíÂ∫èÔºàÈ´òÂèØ‰ø°Â∫¶‰ºòÂÖàÔºâ\nresults.sort((a, b) => b.json.credibilityScore - a.json.credibilityScore);\n\n// ÈôêÂà∂Êï∞ÈáèÔºàÊØèÊ¨°ÊúÄÂ§öÂ§ÑÁêÜ20Êù°Ôºâ\nconst limited = results.slice(0, 20);\n\nconsole.log(`üîç ‰ªé ${items.length} Êù°Êñ∞Èóª‰∏≠ÊâæÂà∞ ${results.length} Êù°ÂÖ´Âç¶ÔºåÂ§ÑÁêÜÂâç ${limited.length} Êù°`);\n\nreturn limited;"
      },
      "id": "filter-gossip",
      "name": "Filter & Score Gossip",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "jsCode": "// Ê£ÄÊü•ÊòØÂê¶ÈáçÂ§ç\nconst item = $input.item.json;\nconst url = item.url;\n\n// ÁÆÄÂçïÁöÑURLÂéªÈáçÔºàÂü∫‰∫éURLÔºâ\n// Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂ∫îËØ•Êü•ËØ¢ Directus Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®\n\n// ‰∏∫‰∫ÜÈÅøÂÖçÈáçÂ§çÔºåÊàë‰ª¨‰ΩøÁî®URLÁîüÊàêÂîØ‰∏Äslug\nconst urlHash = url.split('').reduce((a, b) => {\n  a = ((a << 5) - a) + b.charCodeAt(0);\n  return a & a;\n}, 0);\n\nconst slug = `rss-${Math.abs(urlHash)}-${Date.now().toString(36)}`;\n\nreturn {\n  json: {\n    ...item,\n    slug: slug,\n    uniqueCheck: `url:${url}` // ÂèØÁî®‰∫éDirectusÂéªÈáçÊ£ÄÊü•\n  }\n};"
      },
      "id": "check-duplicate",
      "name": "Check Duplicate",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.DIRECTUS_URL || 'http://host.docker.internal:8055' }}/items/news",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.DIRECTUS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"title\": \"{{ $json.title.replace(/\"/g, '\\\\\"') }}\",\n  \"summary\": \"{{ $json.summary.replace(/\"/g, '\\\\\"') }}\",\n  \"content\": \"{{ $json.content.substring(0, 5000).replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n') }}\",\n  \"ai_summary\": \"{{ $json.summary.substring(0, 200).replace(/\"/g, '\\\\\"') }}\",\n  \"source\": \"{{ $json.source }}\",\n  \"source_type\": \"rss\",\n  \"url\": \"{{ $json.url }}\",\n  \"slug\": \"{{ $json.slug }}\",\n  \"news_type\": \"gossip\",\n  \"credibility_score\": {{ $json.credibilityScore }},\n  \"verification_status\": \"unverified\",\n  \"gossip_tags\": {{ JSON.stringify($json.tags) }},\n  \"likes_count\": 0,\n  \"comments_count\": 0,\n  \"status\": \"{{ $json.credibilityScore >= 60 ? 'published' : 'draft' }}\",\n  \"category\": \"crypto-general\",\n  \"content_published_at\": \"{{ $json.publishedAt }}\",\n  \"published_at\": \"{{ new Date().toISOString() }}\"\n}",
        "options": {}
      },
      "id": "publish-directus",
      "name": "Publish to Directus",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1250, 300],
      "continueOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// ÁªüËÆ°ÁªìÊûú\nconst items = $input.all();\n\nconst successful = items.filter(i => \n  (i.json.id || i.json.data?.id) && !i.json.error\n);\n\nconst duplicates = items.filter(i => \n  i.json.error?.message?.includes('duplicate') || \n  i.json.errors?.[0]?.message?.includes('duplicate')\n);\n\nconst failed = items.filter(i => \n  i.json.error && !i.json.error?.message?.includes('duplicate')\n);\n\nconst summary = {\n  total: items.length,\n  successful: successful.length,\n  duplicates: duplicates.length,\n  failed: failed.length,\n  timestamp: new Date().toISOString(),\n  sources: [...new Set(items.map(i => i.json.source || 'unknown'))]\n};\n\nconsole.log('\\nüìä RSS ÈááÈõÜÁªüËÆ°:');\nconsole.log(`   ÊÄªËÆ°: ${summary.total} Êù°`);\nconsole.log(`   ÊàêÂäü: ${summary.successful} Êù°`);\nconsole.log(`   ÈáçÂ§ç: ${summary.duplicates} Êù°`);\nconsole.log(`   Â§±Ë¥•: ${summary.failed} Êù°`);\nconsole.log(`   Êù•Ê∫ê: ${summary.sources.join(', ')}`);\nconsole.log(`   Êó∂Èó¥: ${summary.timestamp}\\n`);\n\nif (successful.length > 0) {\n  console.log('‚úÖ Êñ∞Â¢ûÂÖ´Âç¶:');\n  successful.slice(0, 5).forEach((item, i) => {\n    const data = item.json.data || item.json;\n    console.log(`   ${i + 1}. ${data.title?.substring(0, 50)}...`);\n  });\n}\n\nreturn [{ json: summary }];"
      },
      "id": "summary-stats",
      "name": "Summary Stats",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1450, 300]
    }
  ],
  "connections": {
    "Schedule Trigger - ÊØè30ÂàÜÈíü": {
      "main": [
        [
          {
            "node": "Generate RSS Sources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate RSS Sources": {
      "main": [
        [
          {
            "node": "RSS Read Feed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS Read Feed": {
      "main": [
        [
          {
            "node": "Filter & Score Gossip",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Score Gossip": {
      "main": [
        [
          {
            "node": "Check Duplicate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Duplicate": {
      "main": [
        [
          {
            "node": "Publish to Directus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish to Directus": {
      "main": [
        [
          {
            "node": "Summary Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-01-06T00:00:00.000Z",
  "versionId": "1"
}
