{
  "name": "Twitter Gossip Collector - å¸åœˆå…«å¦é‡‡é›†å™¨ (ä¿®å¤ç‰ˆ)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "// å®šä¹‰è¦ç›‘æ§çš„KOLè´¦å·åˆ—è¡¨ (ç®€åŒ–ç‰ˆï¼Œæµ‹è¯•ç”¨5ä¸ª)\nconst kols = [\n  { username: 'VitalikButerin', name: 'Vitalik Buterin', weight: 100 },\n  { username: 'WuBlockchain', name: 'å´è¯´åŒºå—é“¾', weight: 95 },\n  { username: 'zachxbt', name: 'ZachXBT', weight: 95 },\n  { username: 'lookonchain', name: 'Lookonchain', weight: 90 },\n  { username: 'whale_alert', name: 'Whale Alert', weight: 85 },\n];\n\n// å…«å¦å…³é”®è¯\nconst gossipKeywords = [\n  'rumor', 'scam', 'rug', 'dump', 'hack', \n  'ä¼ é—»', 'çˆ†æ–™', 'è·‘è·¯', 'æš´é›·'\n];\n\n// ä¸ºæ¯ä¸ªKOLåˆ›å»ºæœç´¢æŸ¥è¯¢\nconst results = kols.map(kol => ({\n  json: {\n    kolUsername: kol.username,\n    kolName: kol.name,\n    kolWeight: kol.weight,\n    searchQuery: `from:${kol.username} (${gossipKeywords.slice(0, 5).join(' OR ')})`,\n    timestamp: new Date().toISOString()\n  }\n}));\n\nreturn results;"
      },
      "id": "generate-queries",
      "name": "Generate Queries",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "resource": "tweet",
        "operation": "search",
        "searchText": "={{ $json.searchQuery }}",
        "returnAll": false,
        "limit": 10,
        "additionalFields": {}
      },
      "id": "twitter-search",
      "name": "Twitter Search",
      "type": "n8n-nodes-base.twitter",
      "typeVersion": 2,
      "position": [650, 300],
      "credentials": {
        "twitterOAuth2Api": {
          "id": "PLACEHOLDER",
          "name": "Twitter OAuth2 API account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// è¿‡æ»¤å’Œè¯„åˆ†æ¨æ–‡\nconst items = $input.all();\nconst results = [];\n\n// å…«å¦å…³é”®è¯(ç”¨äºäºŒæ¬¡éªŒè¯)\nconst gossipKeywords = ['rumor', 'scam', 'rug', 'dump', 'hack', 'ä¼ é—»', 'çˆ†æ–™', 'è·‘è·¯'];\n\nfor (const item of items) {\n  const tweet = item.json;\n  const text = tweet.text || tweet.full_text || '';\n  \n  // æ£€æŸ¥æ˜¯å¦åŒ…å«å…³é”®è¯\n  const hasKeyword = gossipKeywords.some(keyword => \n    text.toLowerCase().includes(keyword.toLowerCase())\n  );\n  \n  if (!hasKeyword) continue;\n  \n  // è®¡ç®—äº’åŠ¨é‡ (å…¼å®¹ä¸åŒçš„Twitter APIå“åº”æ ¼å¼)\n  const metrics = tweet.public_metrics || {};\n  const engagement = \n    (metrics.like_count || tweet.favorite_count || 0) + \n    (metrics.retweet_count || tweet.retweet_count || 0) + \n    (metrics.reply_count || tweet.reply_count || 0);\n  \n  // è¿‡æ»¤ä½äº’åŠ¨æ¨æ–‡ (æµ‹è¯•æ—¶é™ä½é˜ˆå€¼)\n  if (engagement < 10) continue;\n  \n  // åˆæ­¥å¯ä¿¡åº¦è¯„åˆ†\n  let credibility = 50;\n  \n  // KOLæƒé‡åŠ æˆ\n  const kolWeight = tweet.kolWeight || 80;\n  credibility += (kolWeight - 80) * 0.2;\n  \n  // äº’åŠ¨é‡åŠ æˆ\n  if (engagement > 500) credibility += 10;\n  else if (engagement > 100) credibility += 5;\n  \n  // åŒ…å«\"æ®æ‚‰\"ã€\"allegedly\"ç­‰è¯æ±‡é™ä½å¯ä¿¡åº¦\n  if (text.match(/(æ®æ‚‰|allegedly|rumor)/i)) {\n    credibility -= 10;\n  }\n  \n  // åŒ…å«é“¾æ¥(è¯æ®)å¢åŠ å¯ä¿¡åº¦\n  const hasUrls = (tweet.entities?.urls?.length || 0) > 0;\n  if (hasUrls) credibility += 10;\n  \n  // é™åˆ¶åœ¨0-100\n  credibility = Math.max(0, Math.min(100, credibility));\n  \n  // æ„å»ºè¾“å‡º\n  results.push({\n    json: {\n      tweetId: tweet.id_str || tweet.id || Date.now().toString(),\n      author: tweet.user?.screen_name || tweet.author_username || 'unknown',\n      authorName: tweet.user?.name || tweet.author_name || 'Unknown',\n      text: text.substring(0, 500),\n      url: `https://twitter.com/${tweet.user?.screen_name || 'i'}/status/${tweet.id_str || tweet.id}`,\n      createdAt: tweet.created_at || new Date().toISOString(),\n      engagement: engagement,\n      likes: metrics.like_count || tweet.favorite_count || 0,\n      retweets: metrics.retweet_count || tweet.retweet_count || 0,\n      replies: metrics.reply_count || tweet.reply_count || 0,\n      credibilityScore: Math.floor(credibility),\n      kolWeight: kolWeight,\n      hasUrls: hasUrls\n    }\n  });\n}\n\n// æŒ‰äº’åŠ¨é‡æ’åº\nresults.sort((a, b) => b.json.engagement - a.json.engagement);\n\nconsole.log(`ğŸ” æ‰¾åˆ° ${results.length} æ¡ç¬¦åˆæ¡ä»¶çš„å…«å¦`);\n\nreturn results;"
      },
      "id": "filter-score",
      "name": "Filter & Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.DIRECTUS_URL || 'http://host.docker.internal:8055' }}/items/news",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.DIRECTUS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"title\": \"{{ $json.text.substring(0, 100).replace(/\"/g, '\\\\\"') }}\",\n  \"summary\": \"{{ $json.text.substring(0, 200).replace(/\"/g, '\\\\\"') }}\",\n  \"content\": \"# Twitter çˆ†æ–™\\n\\n**æ¥æº**: [@{{ $json.author }}]({{ $json.url }})\\n**ä½œè€…**: {{ $json.authorName }}\\n**æ—¶é—´**: {{ $json.createdAt }}\\n**çƒ­åº¦**: {{ $json.engagement }} äº’åŠ¨\\n\\n## åŸæ–‡\\n\\n{{ $json.text }}\",\n  \"ai_summary\": \"{{ $json.text.substring(0, 150).replace(/\"/g, '\\\\\"') }}\",\n  \"source\": \"Twitter @{{ $json.author }}\",\n  \"source_type\": \"twitter\",\n  \"url\": \"{{ $json.url }}\",\n  \"slug\": \"twitter-{{ $json.tweetId }}\",\n  \"news_type\": \"gossip\",\n  \"credibility_score\": {{ $json.credibilityScore }},\n  \"verification_status\": \"unverified\",\n  \"gossip_tags\": [\"Twitterå…«å¦\", \"{{ $json.authorName }}\"],\n  \"likes_count\": {{ Math.floor($json.engagement * 0.3) }},\n  \"comments_count\": 0,\n  \"status\": \"{{ $json.credibilityScore >= 60 ? 'published' : 'draft' }}\",\n  \"category\": \"crypto-general\",\n  \"content_published_at\": \"{{ $json.createdAt }}\",\n  \"published_at\": \"{{ new Date().toISOString() }}\"\n}",
        "options": {}
      },
      "id": "publish-directus",
      "name": "Publish to Directus",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1050, 300],
      "onError": "continueRegularOutput",
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// ç»Ÿè®¡ç»“æœ\nconst items = $input.all();\n\nconst successful = items.filter(i => i.json.id || i.json.data?.id);\nconst failed = items.filter(i => i.json.error);\n\nconst summary = {\n  total: items.length,\n  successful: successful.length,\n  failed: failed.length,\n  timestamp: new Date().toISOString()\n};\n\nconsole.log('\\nğŸ“Š é‡‡é›†ç»Ÿè®¡:');\nconsole.log(`   æ€»è®¡: ${summary.total} æ¡`);\nconsole.log(`   æˆåŠŸ: ${summary.successful} æ¡`);\nconsole.log(`   å¤±è´¥: ${summary.failed} æ¡`);\nconsole.log(`   æ—¶é—´: ${summary.timestamp}\\n`);\n\nif (failed.length > 0) {\n  console.log('âŒ å¤±è´¥åŸå› :');\n  failed.forEach((item, i) => {\n    console.log(`   ${i + 1}. ${item.json.error?.message || 'æœªçŸ¥é”™è¯¯'}`);\n  });\n}\n\nreturn [{ json: summary }];"
      },
      "id": "summary-stats",
      "name": "Summary Stats",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Generate Queries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Queries": {
      "main": [
        [
          {
            "node": "Twitter Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Twitter Search": {
      "main": [
        [
          {
            "node": "Filter & Score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Score": {
      "main": [
        [
          {
            "node": "Publish to Directus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish to Directus": {
      "main": [
        [
          {
            "node": "Summary Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-01-06T00:00:00.000Z",
  "versionId": "1"
}
