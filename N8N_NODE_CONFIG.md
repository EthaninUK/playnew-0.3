# n8n èŠ‚ç‚¹é…ç½®è¯¦ç»†è¯´æ˜

## âœ… è¿æ¥æµ‹è¯•å·²é€šè¿‡!

ä» n8n å®¹å™¨åˆ° Directus çš„è¿æ¥æµ‹è¯•**æˆåŠŸ**:
- âœ… å¥åº·æ£€æŸ¥: OK
- âœ… ç™»å½•æµ‹è¯•: æˆåŠŸè·å– access_token
- âœ… ç½‘ç»œé…ç½®: n8n å’Œ Directus åœ¨åŒä¸€ç½‘ç»œ

---

## ğŸ”§ "Login to Directus" èŠ‚ç‚¹æ­£ç¡®é…ç½®

### åŸºæœ¬è®¾ç½®

| å­—æ®µ | å€¼ |
|------|---|
| **èŠ‚ç‚¹åç§°** | Login to Directus |
| **èŠ‚ç‚¹ç±»å‹** | HTTP Request |

### Parameters (å‚æ•°) æ ‡ç­¾

#### 1. Method (è¯·æ±‚æ–¹æ³•)
```
POST
```

#### 2. URL (è¯·æ±‚åœ°å€)
```
http://directus:8055/auth/login
```

**âš ï¸ é‡è¦**:
- âœ… ä½¿ç”¨ `http://directus:8055` (æœåŠ¡å)
- âŒ ä¸è¦ä½¿ç”¨ `http://127.0.0.1:8055`
- âŒ ä¸è¦ä½¿ç”¨ `http://localhost:8055`

#### 3. Authentication (è®¤è¯)
```
None (æ— éœ€è®¤è¯)
```

#### 4. Send Query Parameters (å‘é€æŸ¥è¯¢å‚æ•°)
```
OFF (å…³é—­)
```

#### 5. Send Headers (å‘é€è¯·æ±‚å¤´)
```
å¯é€‰: å¯ä»¥å¼€å¯å¹¶æ·»åŠ  Content-Type

å¦‚æœå¼€å¯:
Header Name: Content-Type
Value: application/json
```

#### 6. Send Body (å‘é€è¯·æ±‚ä½“) â­ é‡è¦
```
ON (å¿…é¡»å¼€å¯!)
```

ç‚¹å‡» "Send Body" å¼€å…³ï¼Œå±•å¼€ä»¥ä¸‹é€‰é¡¹:

**Body Content Type**:
```
JSON
```

**Specify Body**: é€‰æ‹© `Using JSON`

**Body (JSON)**: ç‚¹å‡» "Add Parameter" æˆ–ç›´æ¥åœ¨ JSON ç¼–è¾‘å™¨ä¸­è¾“å…¥:

```json
{
  "email": "the_uk1@outlook.com",
  "password": "Mygcdjmyxzg2026!"
}
```

**æ³¨æ„**: å¦‚æœ n8n æä¾›äº†å¯è§†åŒ–ç¼–è¾‘å™¨:
- æ·»åŠ å‚æ•° `email`: `the_uk1@outlook.com`
- æ·»åŠ å‚æ•° `password`: `Mygcdjmyxzg2026!`

#### 7. Options (é€‰é¡¹)

å¯é€‰æ·»åŠ è¶…æ—¶è®¾ç½®:

ç‚¹å‡» "Add Option" â†’ é€‰æ‹© "Timeout"
```
Timeout: 10000 (10ç§’)
```

---

## ğŸ“¸ é…ç½®ç¤ºä¾‹ (æ–‡æœ¬å½¢å¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Login to Directus                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”    â”‚
â”‚                                                    â”‚
â”‚  Parameters  Settings  Docs â†—                     â”‚
â”‚                                                    â”‚
â”‚  Method                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ POST                              â–¼      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                    â”‚
â”‚  URL                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ http://directus:8055/auth/login          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                    â”‚
â”‚  Authentication                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ None                              â–¼      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                    â”‚
â”‚  Send Query Parameters          [OFF]             â”‚
â”‚  Send Headers                   [OFF]             â”‚
â”‚  Send Body                      [ON] â—„â”€ å¿…é¡»å¼€å¯   â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€ Body â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                              â”‚  â”‚
â”‚  â”‚  Body Content Type: JSON                    â”‚  â”‚
â”‚  â”‚                                              â”‚  â”‚
â”‚  â”‚  {                                           â”‚  â”‚
â”‚  â”‚    "email": "the_uk1@outlook.com",          â”‚  â”‚
â”‚  â”‚    "password": "Mygcdjmyxzg2026!"           â”‚  â”‚
â”‚  â”‚  }                                           â”‚  â”‚
â”‚  â”‚                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                    â”‚
â”‚  Options                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Timeout: 10000                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                    â”‚
â”‚  [Execute Node]                     [Save]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æµ‹è¯•èŠ‚ç‚¹

### æ­¥éª¤ 1: æ‰§è¡Œå•ä¸ªèŠ‚ç‚¹æµ‹è¯•

1. é…ç½®å®Œæˆåï¼Œç‚¹å‡» **"Execute Node"** æŒ‰é’®
2. ç­‰å¾…æ‰§è¡Œå®Œæˆ

### æ­¥éª¤ 2: æ£€æŸ¥è¾“å‡º

æˆåŠŸçš„è¾“å‡ºåº”è¯¥ç±»ä¼¼:

```json
{
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires": 900000,
    "refresh_token": "..."
  }
}
```

### æ­¥éª¤ 3: éªŒè¯ Token

ç¡®è®¤è¾“å‡ºä¸­åŒ…å«:
- âœ… `data` å¯¹è±¡
- âœ… `access_token` å­—æ®µ
- âœ… Token æ˜¯ä¸€ä¸ªé•¿å­—ç¬¦ä¸² (ä»¥ eyJ å¼€å¤´)

---

## ğŸ”— åœ¨å…¶ä»–èŠ‚ç‚¹ä¸­ä½¿ç”¨ Token

åœ¨å·¥ä½œæµçš„åç»­èŠ‚ç‚¹ä¸­ï¼ˆå¦‚ "Save to Directus"ï¼‰ï¼Œä½¿ç”¨ä»¥ä¸‹è¡¨è¾¾å¼å¼•ç”¨ token:

### æ–¹æ³• 1: åœ¨ Headers ä¸­æ·»åŠ 

åœ¨ HTTP Request èŠ‚ç‚¹çš„ "Send Headers" ä¸­:

**Header Name**: `Authorization`

**Value**:
```
Bearer {{ $node["Login to Directus"].json["data"]["access_token"] }}
```

**æ³¨æ„**: "Login to Directus" å¿…é¡»ä¸èŠ‚ç‚¹åç§°å®Œå…¨ä¸€è‡´!

### æ–¹æ³• 2: ä½¿ç”¨è¡¨è¾¾å¼ç¼–è¾‘å™¨

1. ç‚¹å‡» Value å­—æ®µå³ä¾§çš„è¡¨è¾¾å¼å›¾æ ‡ (fx æˆ– =)
2. è¾“å…¥è¡¨è¾¾å¼:
```javascript
Bearer {{ $node["Login to Directus"].json["data"]["access_token"] }}
```

---

## ğŸ› å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: "ECONNREFUSED 127.0.0.1:8055"

**åŸå› **: URL ä½¿ç”¨äº† 127.0.0.1

**è§£å†³**: æ”¹ä¸º `http://directus:8055/auth/login`

---

### é”™è¯¯ 2: "Invalid payload"

**åŸå› **: JSON æ ¼å¼é”™è¯¯æˆ–å­—æ®µç¼ºå¤±

**æ£€æŸ¥**:
- âœ… email å’Œ password å­—æ®µæ‹¼å†™æ­£ç¡®
- âœ… JSON æ ¼å¼æ­£ç¡®ï¼ˆä½¿ç”¨åŒå¼•å·ï¼‰
- âœ… Send Body å·²å¼€å¯

**æ­£ç¡®æ ¼å¼**:
```json
{
  "email": "the_uk1@outlook.com",
  "password": "Mygcdjmyxzg2026!"
}
```

---

### é”™è¯¯ 3: "Invalid credentials"

**åŸå› **: é‚®ç®±æˆ–å¯†ç é”™è¯¯

**éªŒè¯**: åœ¨æµè§ˆå™¨ä¸­ç™»å½• Directus
```
URL: http://localhost:8055
Email: the_uk1@outlook.com
Password: Mygcdjmyxzg2026!
```

---

### é”™è¯¯ 4: "Cannot read property 'access_token' of undefined"

**åŸå› **: Login èŠ‚ç‚¹æ²¡æœ‰æˆåŠŸæ‰§è¡Œ

**è§£å†³**:
1. å…ˆå•ç‹¬æµ‹è¯• Login èŠ‚ç‚¹
2. ç¡®è®¤ Login èŠ‚ç‚¹æˆåŠŸè¿”å›æ•°æ®
3. ç„¶åå†æ‰§è¡Œå®Œæ•´å·¥ä½œæµ

---

## ğŸ“‹ å®Œæ•´é…ç½®æ£€æŸ¥æ¸…å•

- [ ] Method è®¾ç½®ä¸º `POST`
- [ ] URL æ˜¯ `http://directus:8055/auth/login` (ä¸æ˜¯ 127.0.0.1)
- [ ] Authentication è®¾ç½®ä¸º `None`
- [ ] Send Body å·²å¼€å¯ (ON)
- [ ] Body Content Type æ˜¯ `JSON`
- [ ] Body åŒ…å«æ­£ç¡®çš„ email å’Œ password
- [ ] ç‚¹å‡» "Execute Node" æµ‹è¯•
- [ ] è¾“å‡ºåŒ…å« access_token
- [ ] åç»­èŠ‚ç‚¹æ­£ç¡®å¼•ç”¨ token

---

## ğŸ¯ å¿«é€ŸéªŒè¯å‘½ä»¤

å¦‚æœä»æœ‰é—®é¢˜ï¼Œåœ¨ç»ˆç«¯è¿è¡Œ:

```bash
# æµ‹è¯•è¿æ¥
./test-n8n-directus-connection.sh

# åº”è¯¥çœ‹åˆ°:
# âœ… å¥åº·æ£€æŸ¥: {"status":"ok"}
# âœ… ç™»å½•æˆåŠŸ: "access_token":"..."
```

---

## ğŸ’¡ æç¤º

1. **èŠ‚ç‚¹åç§°å¾ˆé‡è¦**: å¦‚æœä½ çš„èŠ‚ç‚¹ä¸å« "Login to Directus"ï¼Œåç»­å¼•ç”¨è¦æ”¹æˆå®é™…åç§°
2. **å…ˆæµ‹è¯•å•ä¸ªèŠ‚ç‚¹**: ä¸è¦ç›´æ¥æ‰§è¡Œæ•´ä¸ªå·¥ä½œæµ
3. **æ£€æŸ¥è¾“å‡º**: æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåéƒ½æŸ¥çœ‹è¾“å‡º
4. **ä¿å­˜å·¥ä½œæµ**: é…ç½®æ­£ç¡®åè®°å¾—ä¿å­˜

---

## ğŸ“ éœ€è¦å¸®åŠ©?

å¦‚æœé…ç½®åä»ç„¶å¤±è´¥:

1. æŸ¥çœ‹è¯¦ç»†æ’æŸ¥æŒ‡å—: [N8N_TROUBLESHOOTING.md](./N8N_TROUBLESHOOTING.md)
2. è¿è¡Œè¿æ¥æµ‹è¯•: `./test-n8n-directus-connection.sh`
3. æ£€æŸ¥ n8n æ—¥å¿—: `docker-compose logs n8n --tail=50`
4. æ£€æŸ¥ Directus æ—¥å¿—: `docker-compose logs directus --tail=50`

---

**é…ç½®å®Œæˆåï¼Œç‚¹å‡» "Execute Node" æµ‹è¯•ï¼** âœ¨
